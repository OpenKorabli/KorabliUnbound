(def element ModalWindowOpenLootboxesByTypeConfirmation (_lootboxEntityId:number)
	(macro MODAL_WINDOW_INIT)
	(macro MODAL_WINDOW_BG)
	(scope
		(var lootboxConfigEntity:dhEntity = "getSingleEntity(CC.lootboxConfigComponent)")
		(var lootboxesInStorage:number = "lootboxConfigEntity.lootboxStorageComponent.inStorage ?: 0" (event "lootboxConfigEntity.lootboxStorageComponent.evUpdate"))

		(var lootboxOpeningState:dhComponent = "getSingleComponent(CC.lootboxOpeningState)")

		(var lootboxEntity:dhEntity = "getPrimaryEntity(CC.lootboxTypeInfoComponent, _lootboxEntityId)")
		(var lootboxComponent:dhComponent = "lootboxEntity.lootboxTypeInfoComponent")

		(var isLootboxPremium:bool = "lootboxComponent.isPremium")
		(var imageUrl:str = "'url:../reward_icons/' + lootboxComponent.subtype + '.png'")
		(var amount:number = "lootboxComponent.amount ?: 0" (event "lootboxComponent.evAmountChanged"))
	)
	(bindcall externalCall 'sound.playSetSoundDirect' "['window', 'openScreen']" init=false watch=false (event "lootboxOpeningState.evLootboxesOpenStarted"))
	(bindcall externalCall 'inputMapping.onRequest' "['closeConfirmationModal', { }]" (bind trigger "lootboxesInStorage"))

	(name = 'ModalWindowOpenLootboxesByTypeConfirmation')
	(class $Fullsize)
	(style (align = "center|middle"))

	(block
		(style
			(width = "DEFAULT_MODAL_WINDOW_WIDTH")
			(align = "center")
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
			(style
				(width = 100%)
				(marginBottom = "M")
			)
			(element ModalWindowShortHeader
				_header = 'IDS_WINDOW_HEADER_CONFIRMATION'
			)
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1.5)
			(style
				(width = 100%)
				(align = "center")
				(paddingTop = "XS")
				(paddingLeft = "SXS")
				(paddingRight = "SXS")
				(paddingBottom = "M")
			)

			(controller $Tooltip
				(renderer = 'LootboxContainerTooltip')
				(args
					_lootboxEntityId = "lootboxEntity.id"
				)
				(macro DEFAULT_TOOLTIP_BEHAVIOUR)
			)

			(element ModalWindowSystemExpendableIconWithHeaderAndSubheader
				_headerIconType =	"MODAL_WINDOW_SYSTEM_PURCHASABLE_ITEM_ICON.LOOTBOXES"
				_imageUrl =			"imageUrl"
				_imageWidth =		80px
				_imageHeight =		80px
				_maxWidth =			376px
				_headerText =		"'IDS_REWARD_LOOTBOX_' + toUpper(lootboxComponent.subtype) + '_TITLE_SHORT'"
				_subheaderText =	"isLootboxPremium ? 'IDS_LOOTBOX_PREMIUM' : 'IDS_LOOTBOX'"
				_data =				"{ imageUrl: imageUrl }"
			)
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
			(style (width = 100%))
			(element HorizontalDividerTwoPx)
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
			(style
				(marginBottom = "MS")
				(marginTop = "MS")
			)
			(tf
				(class $TextDefault26NM)
				(style (alpha = "TA"))
				(bind text "subst('IDS_SUBST_PL_OPEN_N_CONTAINERS_QUESTION', [], { count: amount }, amount)")
			)
		)

		(hblock
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)

			(element ModalWindowSystemYesNoButtons
				_btnOkName = 'btn_ok'
				_btnOkMethods = "[	{	type: 'inputMapping.onAction', name: 'LootboxProxy.openLootboxesByType', args: { lootboxType: lootboxComponent.containerType, count: amount}}]"
			)
		)
	)
)