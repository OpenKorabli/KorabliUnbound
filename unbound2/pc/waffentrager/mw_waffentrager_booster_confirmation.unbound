(def element ModalWindowWaffentragerBoosterConfirmation (boosterTitle:str, boosterEntityId:number, typeMW:number, boosterType:str)
	(macro MODAL_WINDOW_INIT)
	(macro MODAL_WINDOW_BG)
	(scope
		(struct waffentragerBooster = PULL_WAFFENTRAGER_BOOSTER(_entityId = "boosterEntityId"))

		(var waffentragerBoosters:dhCollection = "getCollectionByPath(CC.waffentragerBooster, 'byType.' + boosterType)")
		(var activeBoosters:dhCollection = "waffentragerBoosters.child('active')")

		(var waffentragerEvent:dhComponent = "getSingleComponent(CC.waffentragerEvent)")
		(var relay:number = "waffentragerEvent.relay" (event "waffentragerEvent.evChanged"))

		(var isPurchaseMW:bool = "typeMW == SC.Common.WAFFENTRAGER_BOOSTER_PURCHASE_STATE.NOT_PURCHASED")
		(var price:number = "isPurchaseMW	? waffentragerBooster.cost
											: waffentragerBooster.upgradeCost")
		(var question:str = "isPurchaseMW	? 'IDS_WT_BUREAU_CARD_BUTTON_PURCHASE_CONFIRM_QUESTION'
											: 'IDS_QUESTION_SKILL_UPGRADE_FOR'")
		(var actionName:str = "isPurchaseMW	? 'WaffentragerProxyUSS.buyWaffentragerBooster'
											: 'WaffentragerProxyUSS.upgradeWaffentragerBooster'")
		(var priceInfo:dict = "{ currency: SC.Common.CURRENCIES.WAFFENTRAGER_RELAY, finalPrice: relay, priceSum: (relay-price) }")
		(var deficit:number = "price - relay")
		(var isDeficit:bool = "deficit > 0 ")
	)

	(block
		(class $EyeLevelAligned)
		(style
			(width = 400px)
			(align = "center")
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
			(style (width = 100%))
			(element ModalWindowShortHeader
				_header = 'IDS_CONFIRMATION'
				_hasDivider = false
			)
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1.5)
			(style
				(width = 100%)
				(marginBottom = "L")
			)
			(element CurrenciesPanel
				_priceInfo = "[priceInfo]"
				_width = 400px
			)
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 2.5)
			(style
				(width = 360px)
				(marginBottom = "MS")
			)

			(tf
				(class $TextDefaultBold20NM)
				(style
					(width = 100%)
					(marginBottom = "M")
					(textAlign = "center")
					(alpha = "TA")
				)
				(bind text "boosterTitle")
			)

			(hblock
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
				(style
					(width = 100%)
					(align = "center")
				)

				(controller $Instance renderer='WaffentragerBoosterUpgradePanel'
					(bind enabled "!isPurchaseMW")
					(args
						_entityId = "boosterEntityId"
					)
				)

				(controller $Instance renderer='WaffentragerLevelBoosterList'
					(bind enabled "isPurchaseMW")
					(args
						_entityId = "boosterEntityId"
						_level = "SC.Common.WAFFENTRAGER_BOOSTER_PURCHASE_STATE.BASE"
					)
				)
			)
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 4)
			(style
				(width = 100%)
				(marginBottom = "MS")
			)
			(element HorizontalDividerTwoPx)
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 4.5)
			(style (marginBottom = "MS"))
			(element ModalWindowSystemPurchaseItemPriceAndInfo
				_priceInfo = "{ currency: SC.Common.CURRENCIES.WAFFENTRAGER_RELAY, finalPrice: price }"
				_questionString = "question"
				_additionalInfoUnifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.ATTENTION"
				_additionalInfoStr = "toBool(activeBoosters.length) ? 'IDS_WT_BUREAU_PURCHASE_BOOSTER_CONFIRMATION_WARNING' : ''"
				_isWarningText = "isDeficit"
				_isDeficit = "isDeficit"
				_deficit = "deficit"
			)
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 5)
			(element ModalWindowSystemPurchaseItemYesNoCloseButtons
				_isDeficit = "isDeficit"
				_okMethods = "[{	type: 'inputMapping.onAction',
									name: actionName,
									args: { boosterID: waffentragerBooster.boosterID } }]"
			)
		)
	)
)

(def element WaffentragerBoosterUpgradePanel (_entityId:number = 0)
	(style
		(backgroundColor = 0x1FFFFFFF)
		(borderRadius = "XS")
	)

	(block
		(style
			(paddingTop = "SXS")
			(paddingBottom = "SXS")
			(paddingLeft = "L")
			(paddingRight = 21px)
			(align = "center")
		)

		(element WaffentragerBoosterUpgradeItem
			_level = "SC.Common.WAFFENTRAGER_BOOSTER_PURCHASE_STATE.BASE"
			_entityId = "_entityId"
		)

		(block
			(style
				(hitTest = false)
				(marginTop = "S")
				(marginBottom = "XXS")
				(height = 18px)
				(width = 12px)
				(rotation = 90)
				(marginLeft = 18px)
				(backgroundImage = 'url:../service_kit/buttons/carousel_arrows/arrow_right.png')
			)
		)

		(element WaffentragerBoosterUpgradeItem
			_level = " SC.Common.WAFFENTRAGER_BOOSTER_PURCHASE_STATE.UPGRADED"
			_entityId = "_entityId"
		)
	)
)

(def element WaffentragerBoosterUpgradeItem (_entityId:number = 0, _level:number = 0)
	(style
		(flow = "horizontal")
		(align = "middle")
		(hgap = "SXS")
	)

	(tf
		(class $TextDefaultNM)
		(style (bind alpha "_level == 1 ? TC : TA"))
		(bind text "subst('IDS_WT_BUREAU_TECH_LEVEL', [], { _level: _level })")
	)

	(block
		(style (bind alpha "_level == 1 ? 0.75 : 1"))

		(element WaffentragerLevelBoosterList
			_entityId = "_entityId"
			_level = "_level"
		)
	)
)
