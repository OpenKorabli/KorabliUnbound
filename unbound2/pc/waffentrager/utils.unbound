(def struct PULL_WAFFENTRAGER_EVENT_TIMER (_component:dhComponent)
	(var mainProgressionUntil:number = "_component.mainProgressionUntil ?: 0" (event "_component.evChanged"))
	(var rewardsClaimUntil:number = "_component.rewardsClaimUntil ?: 0" (event "_component.evChanged"))
	(var eventFinishReminderUntil:number = "_component.eventFinishReminderUntil ?: 0" (event "_component.evChanged"))
)

(def struct PULL_WAFFENTRAGER_EVENT_STATE (_component:dhComponent)
	(var state:number = "_component.state" (event "_component.evChanged"))
	(var isActive:bool = "state == SC.Common.WAFFENTRAGER_EVENT_STATE.ACTIVE")
	(var isFinalStatsTimeReached:bool = "state == SC.Common.WAFFENTRAGER_EVENT_STATE.FINAL_STATS_TIME_REACHED")
	(var isFinalTimeReached:bool = "state == SC.Common.WAFFENTRAGER_EVENT_STATE.FINISH_TIME_REACHED")

	(var waffentragerRewardChoiceThreshold:dhCollection = "getCollectionByPath(CC.waffentragerThreshold, 'hasAvailableRewards')")
	(var hasAvailableRewards:bool = "waffentragerRewardChoiceThreshold.length > 0")
)

(def struct PULL_WAFFENTRAGER_PROGRESSION (_component:dhComponent)
	(var progressPoints:number = "_component.progressPoints" (event "_component.evChanged"))

	(var collection:dhCollection = "getCollection(CC.waffentragerThreshold)")
	(var mainProgression:dhCollection = "collection.getChildByPath('byThresholdType.' + SC.Common.WAFFENTRAGER_THRESHOLD_TYPE.MAIN_PROGRESSION)")
	(var mainProgressionLen:number = "mainProgression.length ?: 0")

	(var currentThresholdEntity:dhEntity = "collection.getChildByPath('active').getEntityAtIndex(0)")
	(var currentThresholdComponent:dhComponent = "currentThresholdEntity.waffentragerThreshold")
	(var currentThresholdId:number = "currentThresholdComponent.thresholdId ?: 0" (event "currentThresholdComponent.evChanged"))
	(var unlockAtPoints:number = "currentThresholdComponent.unlockAt ?: 0" (event "currentThresholdComponent.evChanged"))
	(var pointsTillNext:number = "(unlockAtPoints - progressPoints) ?: 0")
	(var currentThreshold:number = "currentThresholdId + 1")  

	(var lastThresholdEntity:dhEntity = "mainProgression.getEntityAtIndex(mainProgressionLen-1)")
	(var maxPoints:number = "lastThresholdEntity.waffentragerThreshold.unlockAt ?: 0" (event "lastThresholdEntity.waffentragerThreshold.evChanged"))
	(var lastThresholdState:number = "lastThresholdEntity.waffentragerThreshold.state" (event "lastThresholdEntity.waffentragerThreshold.evChanged"))
	(var isCompleted:bool = "lastThresholdState == SC.Common.WAFFENTRAGER_THRESHOLD_STATE.PASSED")

	(var isParticipated:bool = "currentThresholdId > 0 && !isCompleted")
)

(def struct PULL_WAFFENTRAGER_BOOSTER (_entityId:number)
	(var entity:dhEntity = "getEntity(_entityId)")
	(var component:dhComponent = "entity.waffentragerBooster")
	(var boosterID:number = "component.id" (event "component.evChanged"))
	(var cost:number = "component.cost ?: 0" (event "component.evChanged"))
	(var upgradeCost:number = "component.upgradeCost ?: 0" (event "component.evChanged"))
	(var state:number = "component.state" (event "component.evChanged"))
)

(def struct PULL_WAFFENTRAGER_THRESHOLD (_component:dhComponent)
	(var progressRatio:number = "_component.progressRatio" (event "_component.evChanged"))
	(var thresholdId:number = "_component.thresholdId" (event "_component.evChanged"))
	(var thresholdState:number = "_component.state" (event "_component.evChanged"))
	(var rewards:array = "_component.rewards" (event "_component.evChanged"))
	(var rewardsState:array = "_component.rewardsState" (event "_component.evChanged"))
	(var isWaffentragerRewardsContainer:bool = "_component.isComplex" (event "_component.evChanged"))
	(var isCurrent:bool = "thresholdState == SC.Common.WAFFENTRAGER_THRESHOLD_STATE.ACTIVE")
	(var isPassed:bool = "thresholdState == SC.Common.WAFFENTRAGER_THRESHOLD_STATE.PASSED")
)

(def struct PULL_WAFFENTRAGER_ATTRIBUTES (_entityId:number)
	(var entity:dhEntity = "getEntity(_entityId)")
	(var component:dhComponent = "entity.attributes")
	(var negative:array = "component.negative ?: []" (event "component.evChanged"))
	(var positive:array = "component.positive ?: []" (event "component.evChanged"))
	(var neutral:array = "component.neutral ?: []" (event "component.evChanged"))
	(var hasActiveBoosters:bool = "	negative.length > 0 ||
									positive.length > 0 ||
									neutral.length > 0")
)

(def struct PULL_WAFFENTRAGER_TOTAL_ACTIVE_BOOSTERS ()
	(var waffentragerBoosterTotalsEntity:dhEntity = "getSingleEntity(CC.waffentragerBoosterTotals)")
	(struct attributes = PULL_WAFFENTRAGER_ATTRIBUTES(_entityId="waffentragerBoosterTotalsEntity.id"))
)

(def struct PULL_WAFFENTRAGER_SHIP (_playerShipId:number)
	(var waffentragerEventShip:dhComponent = "getSingleComponent(CC.waffentragerEventShip)")
	(var waffentragerShipId:number = "waffentragerEventShip.shipId" (event "waffentragerEventShip.evChanged"))
	(var isSelected:bool = "_playerShipId == waffentragerShipId")
)
