(def constant DOCK_MAIN_TAB_BUTTON_LABEL_ALPHA "{
	SC.Ui_styles.BUTTON_STATE.DISABLED:	0.25,
	SC.Ui_styles.BUTTON_STATE.SELECTED:	1,
	SC.Ui_styles.BUTTON_STATE.DOWN:		0.7,
	SC.Ui_styles.BUTTON_STATE.OVER:		0.9,
	SC.Ui_styles.BUTTON_STATE.UP:		0.75
}")

(def constant DOCK_SECONDARY_TAB_BUTTON_LABEL_ALPHA "{
	SC.Ui_styles.BUTTON_STATE.DISABLED:	0.25,
	SC.Ui_styles.BUTTON_STATE.SELECTED:	0.9,
	SC.Ui_styles.BUTTON_STATE.DOWN:		0.7,
	SC.Ui_styles.BUTTON_STATE.OVER:		0.9,
	SC.Ui_styles.BUTTON_STATE.UP:		0.75
}")

(def constant DOCK_MAIN_TAB_BUTTON_GLOW_ALPHA "{
	SC.Ui_styles.BUTTON_STATE.DISABLED:	{ alpha: 0,		offsetY: -20px },
	SC.Ui_styles.BUTTON_STATE.SELECTED:	{ alpha: 0.4,	offsetY: 0px },
	SC.Ui_styles.BUTTON_STATE.DOWN:		{ alpha: 0,		offsetY: -8px },
	SC.Ui_styles.BUTTON_STATE.OVER:		{ alpha: 0,		offsetY: -5px },
	SC.Ui_styles.BUTTON_STATE.UP:		{ alpha: 0,		offsetY: 0px }
}")

(def element DockMainTabButtonWrapper (_route:str, _routeLen:number)
	(bind name "ROUTE_MAIN_TAB_ELEMENTS[_route]")

	(controller $Instance
		(bind renderer "ROUTE_MAIN_TAB_ELEMENTS[_route]")
		(args
			_sidePaddings = "	$index == _routeLen - 1		?	{	left:	DOCK_TAB_PADDINGS.SIDE_LEFT,
																	right:	DOCK_TAB_PADDINGS.DEFAULT } :
								$index == 0					?	{	left:	DOCK_TAB_PADDINGS.DEFAULT,
																	right:	DOCK_TAB_PADDINGS.SIDE_RIGHT }
															:	{	left:	DOCK_TAB_PADDINGS.DEFAULT,
																	right:	DOCK_TAB_PADDINGS.DEFAULT }"
		)
	)
)

(def element MainTabButtonActivities (_sidePaddings:dict)
	(scope
		(struct routeMenuData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.ACTIVITIES"))
		(struct markerData = PULL_MARKER_NEW(_groupName = "SC.Ui_common.CONTENT_MARKER_GROUPS.ACTIVITIES"))

		(struct activeTip =			PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =		SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.NEW_ACTIVITY_AVAILABLE,
																												SC.Context_guiding_tip.TIP_TYPE.LOOTBOXES_ACTIVITIES_TAB,
																												SC.Context_guiding_tip.TIP_TYPE.LOOTBOXES_ACTIVITIES_TAB_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.CAMPAIGN_MAIN_TAB ]"))
	)

	(element DockMainTabButton
		_label = 'IDS_MAIN_TAB_BUTTON_ACTIVITIES'
		_isEnabled = "routeMenuData.isEnabled"
		_isSelected = "routeMenuData.isActive"
		_markerType = "markerData.markerType"
		_markerNewCounter = "markerData.markerCounter"
		_methods = "[{ type: 'inputMapping.onAction', name: 'menuItemClicked', args: { menuId: SC.Ui_common.MENU.PORT_MENU, itemId: SC.Ui_windows.ROUTE.ACTIVITIES } }]"
		_sidePaddings = "_sidePaddings"
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_BOTTOM"
			_pointerOffset =		-34
			_alongPointerOffset =	-100
			_screenOffsetLeft =		10
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
		)
	)
)

(def element MainTabButtonShip (_sidePaddings:dict)
	(scope
		(struct routeMenuData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.SHIP"))
		(struct markerData = PULL_MARKER_NEW(_groupName = "SC.Ui_common.CONTENT_MARKER_GROUPS.SHIP"))

		(struct activeTip =			PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =		SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.EXTERIOR_INTRO,
																												SC.Context_guiding_tip.TIP_TYPE.EXTERIOR_INTRO_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.BATTLE_BONUS_INTRO,
																												SC.Context_guiding_tip.TIP_TYPE.BATTLE_BONUS_INTRO_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.FREE_XP_SHIP_MAIN_TAB,
																												SC.Context_guiding_tip.TIP_TYPE.FREE_XP_SHIP_MAIN_TAB_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.ECO_BONUS_SHIP_MAIN_TAB,
																												SC.Context_guiding_tip.TIP_TYPE.ECO_BONUS_SHIP_MAIN_TAB_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.CREW_HAS_CREW,
																												SC.Context_guiding_tip.TIP_TYPE.CREW_NO_CREW,
																												SC.Context_guiding_tip.TIP_TYPE.CREW_HAS_CREW_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.CREW_NO_CREW_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.MODERNIZATION_INTRO,
																												SC.Context_guiding_tip.TIP_TYPE.MODERNIZATION_INTRO_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.PORT_BUFF_FOR_EVENT_GO_TO_SHIP_TAB ]"))

		
		(var playerShips:dhCollection = "getCollection(CC.ownShip)")
		(var tabLockedReason:str = "playerShips.length == 0 && !routeMenuData.isActive 	? SC.Ui_common.DOCK_TAB_LOCKED_REASON.NO_SHIPS
																						: SC.Ui_common.DOCK_TAB_LOCKED_REASON.NO_REASON")
	)

	(element DockMainTabButton
		_label = 'IDS_MAIN_TAB_BUTTON_SHIP'
		_isEnabled = "routeMenuData.isEnabled"
		_isSelected = "routeMenuData.isActive"
		_markerType = "markerData.markerType"
		_markerNewCounter = "markerData.markerCounter"
		_methods = "[{ type: 'inputMapping.onAction', name: 'menuItemClicked', args: { menuId: SC.Ui_common.MENU.PORT_MENU, itemId: SC.Ui_windows.ROUTE.SHIP } }]"
		_sidePaddings = "_sidePaddings"
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value")
		(args
			_tipId =			"checkedTipId.value"
			_tipPositioning =	"TIP_POSITION_BOTTOM"
			_pointerOffset =	-34
			_modalWindowName =	"SC.Ui_windows.WINDOWS.DOCK"
		)
	)

	(controller $Tooltip
		(renderer ='SimpleStatusTooltip')
		(bind enabled "tabLockedReason != SC.Ui_common.DOCK_TAB_LOCKED_REASON.NO_REASON")
		(args
			_text = "tr('IDS_DOCK_TAB_LOCKED_REASON_TOOLTIP_' + tabLockedReason)"
			_unifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.WARNING"
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)
)

(def element MainTabButtonResearch (_sidePaddings:dict)
	(scope
		(struct routeMenuData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.RESEARCH"))
		(struct markerData = PULL_MARKER_NEW(_groupName = "SC.Ui_common.CONTENT_MARKER_GROUPS.RESEARCH"))

		(struct activeTip =			PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =		SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.RESEARCH_INTRO,
																												SC.Context_guiding_tip.TIP_TYPE.RESEARCH_INTRO_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.SHIP_CLASSES_RESEARCH_TAB,
																												SC.Context_guiding_tip.TIP_TYPE.SHIP_FEATURES_RESEARCH_DOCK,
																												SC.Context_guiding_tip.TIP_TYPE.SUPERSHIPS,
																												SC.Context_guiding_tip.TIP_TYPE.PARAGONS_INTRO ]"))
	)

	(element DockMainTabButton
		_label = 'IDS_MAIN_TAB_BUTTON_RESEARCH'
		_isEnabled = "routeMenuData.isEnabled"
		_isSelected = "routeMenuData.isActive"
		_markerType = "markerData.markerType"
		_markerNewCounter = "markerData.markerCounter"
		_methods = "[	{ type: 'inputMapping.onAction', name: 'menuItemClicked', args: { menuId: SC.Ui_common.MENU.PORT_MENU, itemId: SC.Ui_windows.ROUTE.RESEARCH } },
						{ type: markerData.isVisible ? 'inputMapping.onAction' : '', name: 'featureSeen', args: { featureIndex: SC.Common.ACCOUNT_FEATURE.NATIONS_TREE } }]"
		_sidePaddings = "_sidePaddings"
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value")
		(args
			_tipId =			"checkedTipId.value"
			_tipPositioning =	"TIP_POSITION_BOTTOM"
			_pointerOffset =	-34
			_modalWindowName =	"SC.Ui_windows.WINDOWS.DOCK"
		)
	)
)

(def element MainTabButtonClan (_sidePaddings:dict)
	(scope
		(struct routeMenuData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.CLAN"))
		(struct markerData = PULL_MARKER_NEW(_groupName = "SC.Ui_common.CONTENT_MARKER_GROUPS.CLAN"))

		(var selfPlayerEntity:dhEntity = "getSingleEntity(CC.accountSelf)")
		(var playerComponentClanman:dhComponent = "selfPlayerEntity.clanman")

		(var clanId:number = "playerComponentClanman.clanId" (event "playerComponentClanman.evClanIdChanged"))
		(var clanEntity:dhEntity = "getPrimaryEntity(CC.clan, clanId)")
		(var clanTag:str = "clanEntity.clan.tag" (event "clanEntity.clan.evTagChanged"))

		(var clanLabel:str = "toBool(playerComponentClanman) ? '[' + clanTag + ']' : 'IDS_MAIN_TAB_BUTTON_CLAN'")

		(struct activeTip =			PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =		SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.CLANS_INTRO,
																												SC.Context_guiding_tip.TIP_TYPE.CLANS_INTRO_REPEAT ]"))
	)

	(element DockMainTabButton
		_label = "clanLabel"
		_isEnabled = "routeMenuData.isEnabled"
		_isSelected = "routeMenuData.isActive"
		_markerType = "markerData.markerType"
		_markerNewCounter = "markerData.markerCounter"
		_methods =		"[	{ type: 'inputMapping.onAction', name: 'menuItemClicked', args: { menuId: SC.Ui_common.MENU.PORT_MENU, itemId: SC.Ui_windows.ROUTE.CLAN } },
							{ type: markerData.isVisible ? 'inputMapping.onAction' : '', name: 'featureSeen', args: { featureIndex: SC.Common.ACCOUNT_FEATURE.CLAN_BATTLE } } ]"
		_sidePaddings = "_sidePaddings"
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value")
		(args
			_tipId =			"checkedTipId.value"
			_tipPositioning =	"TIP_POSITION_BOTTOM"
			_pointerOffset =	-34
			_modalWindowName =	"SC.Ui_windows.WINDOWS.DOCK"
		)
	)
)

(def element MainTabButtonArmory (_sidePaddings:dict)
	(scope
		(struct eventsRouteData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(struct routeMenuData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.ARMORY"))
		(struct markerData = PULL_MARKER_NEW(_groupName = "SC.Ui_common.CONTENT_MARKER_GROUPS.ARMORY"))

		(struct clanRoute = PULL_ROUTE(_id = "SC.Ui_windows.ROUTE.CLAN"))

		(struct activeTip =			PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =		SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.METASHOP,
																												SC.Context_guiding_tip.TIP_TYPE.METASHOP_INTRO,
																												SC.Context_guiding_tip.TIP_TYPE.METASHOP_INTRO_REPEAT ]"))
	)

	(element DockMainTabButton
		_label = 'IDS_MAIN_TAB_BUTTON_ARMORY'
		_iconPath = 'url:../service_kit/tabs/main/icon_armory.png'
		_isEnabled = "routeMenuData.isEnabled"
		_markerType = "markerData.markerType"
		_markerNewCounter = "markerData.markerCounter"
		_methods = "[	{ type: 'inputMapping.onAction', name: 'menuItemClicked', args: { menuId: SC.Ui_common.MENU.PORT_MENU, itemId: SC.Ui_windows.ROUTE.ARMORY } },
						{ type: markerData.isVisible ? 'inputMapping.onAction' : '', name: 'featureSeen', args: { featureIndex: SC.Common.ACCOUNT_FEATURE.METASHOP } }]"
		_sidePaddings = "_sidePaddings"
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && !eventsRouteData.isActive")
		(args
			_tipId =			"checkedTipId.value"
			_tipPositioning =	"TIP_POSITION_BOTTOM"
			_pointerOffset =	-34
			_modalWindowName =	"SC.Ui_windows.WINDOWS.DOCK"
		)
	)
)

(def element DockMainTabButton	(	_label:str = '',
									_isSelected:bool = false,
									_isEnabled:bool = true,
									_markerType:number = "SC.Ui_common.CONTENT_MARKER_TYPE.NONE",
									_markerNewCounter:number = 0,
									_sidePaddings:dict = "{ left: M, right: M }",
									_iconPath:str = '',
									_dispatchedEv:str = '',
									_dispatchParams:dict = {},
									_methods:array = [] )
	(scope
		(macro MOUSE_HANDLER_SCOPE)
		(struct stageSize = STAGE_SIZE())
		(var isSmallScreen:bool = "stageSize.width < 1520")

		(var state:number = "	!_isEnabled	? SC.Ui_styles.BUTTON_STATE.DISABLED :
								_isSelected	? SC.Ui_styles.BUTTON_STATE.SELECTED :
								mouseDown	? SC.Ui_styles.BUTTON_STATE.DOWN :
								rollOver	? SC.Ui_styles.BUTTON_STATE.OVER
											: SC.Ui_styles.BUTTON_STATE.UP")

		(var textColor:number = "!_isEnabled	? SC.Ui_styles.SERVICE_COLORS.WHITE :
								_isSelected		? SC.Ui_styles.SERVICE_COLORS.ACCENT_BLUE
												: SC.Ui_styles.SERVICE_COLORS.WHITE")

		(var textAlpha:number = "DOCK_MAIN_TAB_BUTTON_LABEL_ALPHA[state]")
		(var glowAlpha:number = "DOCK_MAIN_TAB_BUTTON_GLOW_ALPHA[state].alpha")
		(var glowOffset:number = "DOCK_MAIN_TAB_BUTTON_GLOW_ALPHA[state].offsetY")

		(var newMarkerElement:str = "MARKER_ELEMENT[_markerType] ?: ''")
		(var isNew:bool = "_isEnabled && newMarkerElement && !_isSelected")
	)
	(style
		(align = "center")
		(height = "DOCK_HEADER_HEIGHT")
		(backgroundColor = "NO_COLOR")
	)

	
	(block
		(style
			(height = 100%)
			(bind paddingLeft "_sidePaddings.left")
			(bind paddingRight "_sidePaddings.right")
		)

		(block
			(style
				(height = 100%)
				(align = "middle")
				(hitTest = false)
			)

			(block
				(class $FullsizeAbsolute)
				(style
					(paddingLeft = "-XL")
					(paddingRight = "-XL")
				)

				(block
					(class $Fullsize)
					(style
						(backgroundImage = 'url:../service_kit/tabs/main/tab_glow.png')
						(backgroundSize = "fill")
						(visualOffsetY = "glowOffset")
						(alpha = "glowAlpha")
					)

					(controller $Animation
						(bindcall play
							duration = 0.15
							to = "{ visualOffsetY: glowOffset, alpha: glowAlpha }"
							easing = "Easing.quad_in"
							(bind trigger "state")
						)
					)
				)
			)

			(hblock
				(style
					(alpha = "textAlpha")
					(align = "middle")
				)

				(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
					_trigger = "state"
					_alpha = "textAlpha"
				)

				(block
					(bind visible "toBool(_iconPath) && !isSmallScreen")
					(style
						(marginRight = "XS")
						(height = 1px)
						(paddingTop = -11px)
					)

					(block
						(style
							(width = 24px)
							(height = 24px)
							(bind backgroundImage "_iconPath")
							(backgroundSize = "cover")
						)
					)
				)

				(tf
					(bind class "!isSmallScreen ? '$TextDefaultBold18NM' : '$TextDefaultBoldNM'")
					(style (bind textColor "textColor"))
					(bind text "toUpper(tr(_label))")
				)
			)
		)

		(block
			(macro DEFAULT_CONTROL_MARKER_ANIMATION "isNew")
			(style
				(position = "absolute")
				(top = 7px)
				(bind right "	_markerType == SC.Ui_common.CONTENT_MARKER_TYPE.NEW			? 20px :
								_markerType == SC.Ui_common.CONTENT_MARKER_TYPE.NEW_COUNT	? { 1280: SXS , 1920: S }
																							: { 1280: S , 1920: XXS }")
			)

			(controller $Instance
				(bind enabled "newMarkerElement")
				(bind renderer "newMarkerElement")
				(args
					_newContentCounter = "_markerNewCounter"
				)
			)
		)
	)

	(block
		(class $FullsizeAbsolute)
		(style
			(backgroundColor = "NO_COLOR")
			(bind hitTest "_isEnabled && !_isSelected")
		)

		(macro MOUSE_EVENTS_DISPATCHER)
		(macro SOUND_HANDLER "'button_tab'")
		(macro MOUSE_LMB_EXTERNAL_CALL_REPEAT "_methods")
		(macro DISPATCH_HANDLER _dispatchedEv = "_dispatchedEv" _dispatchParams = "_dispatchParams")
	)
)