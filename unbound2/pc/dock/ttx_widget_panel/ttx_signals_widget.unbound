(def element SignalsWidget ()
	(scope
		(var slotsCollection:dhCollection =					"getCollection(CC.equipmentSlot).getChildByPath('bySlotType.' + SC.Ships.SHIP_SLOT_TYPES.SIGNAL)")
		(var installedSignalsCollection:dhCollection =		"getCollection(CC.signal).getChildByPath('installedSignals')")
		(var preinstalledSignalsCollection:dhCollection =	"getCollection(CC.signal).getChildByPath('installedSignals.expired')")
	)

	(class $TTXWidgetContainer)

	(element TTXWidgetCommon
		_type =				"WIDGET_TYPE.SIGNAL"
		_slotsCollection =	"slotsCollection"
		_curItemsCount =	"installedSignalsCollection.length - preinstalledSignalsCollection.length"
	)
)

(def element TTXWidgetSlotItemSignal (_slotEntity:dhEntity)
	(scope
		(var slot:dhComponent =			"_slotEntity.equipmentSlot")
		(var installedEntityId:number =	"slot.installedEntityId"	(event "slot.evInstalledEntityIdChanged"))

		(var signalEntity:dhEntity =	"getEntity(installedEntityId)")
		(var signal:dhComponent =		"signalEntity.signal")
		(var rarity:number =			"signal.rarity ?: WIDGET_ITEM_RARITY.NONE")
		(var amount:number =			"signalEntity.countComponent.value ?: 0"	(event "signalEntity.countComponent.evChanged"))

		(var itemStateIndex:number =	"rarity >= 0	? amount > 0	? rarity - 1
																		: WIDGET_ITEM_RARITY.PREINSTALLED
														: WIDGET_ITEM_RARITY.NONE")
	)

	(element TTXWidgetSlotItemView
		_state = "itemStateIndex"
	)
)

(def element TTXCommonWidgetSignalTooltipItem (_installedEntityId:number)
	(scope
		(var signalEntity:dhEntity =	"getEntity(_installedEntityId)")
		(var signal:dhComponent =		"signalEntity.signal")

		(var name:str =				"signal.name")
		(var rarity:number =		"signal.rarity ?: 0")
		(var signalTitle:str =		"tr('IDS_' + toUpper(name) + '_' + rarity)")

		(var amount:number =		"signalEntity.countComponent.value ?: 0"	(event "signalEntity.countComponent.evChanged"))
		(var hasAnySignals:bool =	"amount > 0")
	)

	(style
		(flow = "horizontal")
		(align = "middle")
		(width = 100%)
		(height = 76px)
		(paddingTop = "S")
		(paddingBottom = "S")
		(paddingLeft = "SXS")
		(paddingRight = "SXS")
	)

	(block
		(style
			(width = 60px)
			(height = 60px)
			(marginRight = "S")
		)

		(block
			(class $FullsizeAbsolute)
			(style
				(bind backgroundImage "'url:../signal_flags/' + name + '.png'")
				(bind alpha "hasAnySignals ? 1 : 0.5")
			)
		)

		(block
			(style
				(position = "absolute")
				(left = 11px)
				(top = "S")
			)

			(controller $Instance renderer='MarkerAttention'
				(bind enabled "!hasAnySignals")
				(args
					_size = "SIZE.MEDIUM"
				)
			)
		)
	)

	(block
		(style (width = 100%))

		(tf
			(class $TextDefaultBoldNM)
			(style
				(width = 100%)
				(leading = -2)
				(alpha = "TA")
			)

			(bind text "signalTitle")
		)

		(block
			(bind name "'AmountOfBought_' + name")

			(style (marginTop = "SXS"))

			(tf
				(bind visible "hasAnySignals")
				(class $TextDefaultNM)
				(style (alpha = "TC"))
				(bind text "tr('IDS_IN_WAREHOUSE') + ' ' + formatSeparator(amount)")
			)

			(tf
				(bind visible "!hasAnySignals")
				(class $TextDefaultNM)
				(style (alpha = "TC"))
				(text = 'IDS_OUT_OF_STOCK')
			)
		)
	)
)