(def element ModernizationsWidget ()
	(scope
		(var slotsCollection:dhCollection =						"getCollection(CC.equipmentSlot).getChildByPath('bySlotType.' + SC.Ships.SHIP_SLOT_TYPES.MODERNIZATION)")
		(var slotsWithInstalledModsCollection:dhCollection =	"getCollection(CC.equipmentSlot).getChildByPath('bySlotType.' + SC.Ships.SHIP_SLOT_TYPES.MODERNIZATION + '.withInstalledItems')")
	)
	(class $TTXWidgetContainer)

	(element TTXWidgetCommon
		_type =				"WIDGET_TYPE.MODERNIZATION"
		_slotsCollection =	"slotsCollection"
		_curItemsCount =	"slotsWithInstalledModsCollection.length"
	)
)

(def element TTXWidgetSlotItemModernization (_slotEntity:dhEntity)
	(scope
		(var slot:dhComponent =				"_slotEntity.equipmentSlot")
		(var installedEntityId:number =		"slot.installedEntityId"	(event "slot.evInstalledEntityIdChanged"))

		(var modEntity:dhEntity =			"getEntity(installedEntityId)")
		(var modernization:dhComponent =	"modEntity.modernization")
		(var rarity:number =				"modernization.rarity")

		(var itemStateIndex:number = "rarity > 0 ? rarity - 1 : WIDGET_ITEM_RARITY.NONE")
	)

	(element TTXWidgetSlotItemView
		_state = "itemStateIndex"
	)
)

(def element TTXCommonWidgetModernizationTooltipItem (_installedEntityId:number)
	(scope
		(var modernizationEntity:dhEntity =			"getEntity(_installedEntityId)")
		(var modernizationComponent:dhComponent =	"modernizationEntity.modernization")

		(var name:str = "modernizationComponent.name ?: ''")
	)

	(style
		(flow = "horizontal")
		(align = "middle")
		(width = 100%)
		(height = 76px)
		(paddingTop = "S")
		(paddingBottom = "S")
		(paddingLeft = "SXS")
		(paddingRight = "SXS")
	)

	(block
		(style
			(width = 60px)
			(height = 60px)
			(marginRight = "S")
			(bind backgroundImage "'url:../modernization_icons/icon_modernization_' + name + '.png'")
			(backgroundSize = "cover")
		)
	)

	(block
		(style (width = 100%))

		(tf
			(class $TextDefaultBoldNM)
			(style
				(width = 100%)
				(leading = -2)
				(alpha = "TA")
			)

			(bind text "'IDS_TITLE_' + toUpper(name)")
		)

		(block
			(style (marginTop = "SXS"))

			(tf
				(class $TextDefaultNM)
				(style (alpha = "TC"))
				(text = 'IDS_IN_WAREHOUSE_NO_COLON')
			)
		)
	)
)