(def element TTXShipUpperTitleWidget (_shipId:number)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct activitiesRoute = PULL_ROUTE(_id = "SC.Ui_windows.ROUTE.ACTIVITIES"))

		(var shipEntity:dhEntity =				"getPrimaryEntity(CC.ship, _shipId)")
		(var shipInfo:dhComponent =				"shipEntity.ship")
		(var currentComplexityLevel:number =	"shipInfo.currentComplexityLevel")
		(var maxComplexityLevel:number =		"shipInfo.maxComplexityLevel")

		(var ownShip:dhComponent =		"shipEntity.ownShip")
		(var isOwned:bool =				"ownShip != null")
		(var ownShipExp:number =		"ownShip.exp ?: 0"	(event "ownShip.evUpdateConfig"))

		(var bgState:number = " mouseDown	? SC.Ui_styles.BUTTON_STATE.DOWN :
								rollOver	? SC.Ui_styles.BUTTON_STATE.OVER
											: SC.Ui_styles.BUTTON_STATE.UP")

		(var shipGroup:str = "shipInfo.group")
		(var isNotEventGroup:bool = "shipGroup != SC.Ships.SHIP_GROUPS.EVENT")

		(var shipRole:str = "shipEntity.ship.shipRole ?: ''")
		(var hasShipRole:bool = "!shipRole.empty")

		(struct shipMasteryRoute = PULL_ROUTE(_id = "SC.Ui_windows.ROUTE.SHIP_MASTERY"))
		(var isShipExpVisible:bool = "isOwned && !shipMasteryRoute.isActive")

		(struct activeTip =			PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =		SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.RESEARCH_EXP,
																												SC.Context_guiding_tip.TIP_TYPE.RESEARCH_EXP_REPEAT,
																												SC.Context_guiding_tip.TIP_TYPE.TUTORIAL_TTX_SHIPS_ROLES ]"))
	)

	(class $TTXWidgetContainer)

	(block
		(class $FullsizeAbsolute)
		(element DockWidgetBackground)
	)

	(macro MOUSE_HANDLER
		_methods =		"activitiesRoute.isActive	? [	{ type: 'inputMapping.onAction', name: 'navigateTo', args: { route: SC.Ui_windows.ROUTE.OVERVIEW } } ]
													: [	{ type: 'inputMapping.onAction', name: 'navigateTo', args: { route: SC.Ui_windows.ROUTE.OVERVIEW } },
														{ type: 'inputMapping.onAction', name: 'selectShip', args: { shipId: _shipId } } ]"
		_soundSet =		"'default_button'"
	)

	(controller $Tooltip
		(renderer = 'ShipExtendedTooltip')
		(args
			_shipId = "_shipId"
			_isFromTTX = true
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)

	(block
		(style
			(width = 100%)
			(hitTest = false)
			(padding = "M")
		)

		(element ShipLineItemNM
			_shipId =		"_shipId"
			_fontClass =	'$TextDefaultBold22NM'
			_withFlag =		true
		)

		(block
			(bind visible "hasShipRole")
			(style
				(width = 100%)
				(paddingTop = "M")
			)

			(controller $Instance renderer='ShipRole'
				(bind enabled "hasShipRole")
				(args
					_shipRole = "shipRole"
					_size = "SIZE.LARGE"
				)
			)

			(controller $Instance renderer='GuidingTipHub'
				(bind enabled "hasShipRole && checkedTipId.value == SC.Context_guiding_tip.TIP_TYPE.TUTORIAL_TTX_SHIPS_ROLES")
				(args
					_tipId =				"SC.Context_guiding_tip.TIP_TYPE.TUTORIAL_TTX_SHIPS_ROLES"
					_tipPositioning =		"TIP_POSITION_LEFT"
					_offsetX =				30px
					_offsetY =				40px
					_alongPointerOffset =	-40px
					_pointerOffset =		50px
					_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
				)
			)
		)

		(block
			(style
				(width = 100%)
				(bind paddingTop "hasShipRole ? SXS : M")
			)

			(controller $Instance renderer='ComplexityLevel'
				(bind enabled "isNotEventGroup")
				(args
					_complexityLevel =		"currentComplexityLevel"
					_maxComplexityLevel =	"maxComplexityLevel"
					_complexityType =		"COMPLEXITY_TYPE.SHIP"
					_size =					"SIZE.MEDIUM"
					_alpha =				"TA"
				)
			)
		)

		(block
			(macro TTX_WIDGET_CONTROL_VISIBLE_ANIMATION _trigger = "isShipExpVisible")
			(style (width = 100%))

			(block
				(style
					(width = 100%)
					(paddingTop = "SXS")
				)

				(element PriceTagWithLabel
					_label =		'IDS_SHIP_EXPERIENCE_COLON'
					_size =			"SIZE.MEDIUM"
					_priceInfo =	"{ finalPrice: ownShipExp, currency: SC.Common.CURRENCIES.XP, id: 'shipExp'}"
				)

				(controller $Instance renderer='GuidingTipHub'
					(bind enabled "checkedTipId.value && checkedTipId.value != SC.Context_guiding_tip.TIP_TYPE.TUTORIAL_TTX_SHIPS_ROLES")
					(args
						_tipId =			"checkedTipId.value"
						_tipPositioning =	"TIP_POSITION_LEFT"
						_offsetX =			20px
						_pointerOffset =	84px
						_hasNextButton =	true
						_modalWindowName =	"SC.Ui_windows.WINDOWS.DOCK"
					)
				)
			)
		)
	)

	(element DockTTXWidgetMenuItemBackground
		_state = "bgState"
	)
)