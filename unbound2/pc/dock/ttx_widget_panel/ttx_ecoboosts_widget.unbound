(def element EcoboostsWidget (_shipId:number)
	(scope
		(var shipEntity:dhEntity = "getPrimaryEntity(CC.ownShip, _shipId)")
		(var shipInfo:dhComponent = "shipEntity.ship")

		(var slotsCollection:dhCollection =					"getCollection(CC.equipmentSlot).getChildByPath('commonEcoBoostsSlots')")
		(var installedEcoBoostsCollection:dhCollection =	"getCollection(CC.ecoBoost).getChildByPath('availableToUser.byType.' + SC.Common.ECOBOOST_TYPES.COMMON + '.installed')")
		(var preinstalledEcoBoostsCollection:dhCollection =	"getCollection(CC.ecoBoost).getChildByPath('availableToUser.byType.' + SC.Common.ECOBOOST_TYPES.COMMON + '.preinstalled')")


		(var multiBoostSlotEntity:dhEntity =	"getPrimaryEntity(CC.equipmentSlot, SC.Ships.SHIP_SLOT_TYPES.PERMANENT + DEFAULT_EQUIP_SLOT_PK)")
		(var installedMultiBoostId:number =		"multiBoostSlotEntity.equipmentSlot.installedEntityId"		(event "multiBoostSlotEntity.equipmentSlot.evInstalledEntityIdChanged"))

		(var purchasableMultiboostEntity:dhEntity =	"getSingleEntity(CC.ecoBoost, 'availableToUser.' + 'byType.' + SC.Common.ECOBOOST_TYPES.LINKABLE + '.purchasableMultiboost')")
		(var multiBoostEntity:dhEntity =			"getEntity(installedMultiBoostId ?: purchasableMultiboostEntity.id)")
		(var isLinkedToShip:bool =					"multiBoostEntity.ecoBoost.isLinkedToShip"		(event "multiBoostEntity.ecoBoost.evUpdated"))
		(var multiboostsAmount:number =				"multiBoostEntity.countComponent.value"			(event "multiBoostEntity.countComponent.evChanged"))

		(var isSuitableShip:bool = "shipInfo.group == SC.Ships.SHIP_GROUPS.UPGRADEABLE ||
									shipInfo.group == SC.Ships.SHIP_GROUPS.EARLY_ACCESS ||
									shipInfo.group == SC.Ships.SHIP_GROUPS.DEMO_WITH_STATS ||
									shipInfo.group == SC.Ships.SHIP_GROUPS.SUPER_SHIP ||
									isLinkedToShip")

		(var isMultiBoostInteractionAvailiable:bool = "multiBoostEntity && isSuitableShip")
	)

	(class $TTXWidgetContainer)

	(element TTXWidgetCommon
		_type =					"WIDGET_TYPE.ECOBOOST"
		_slotsCollection =		"slotsCollection"
		_curItemsCount =		"installedEcoBoostsCollection.length - preinstalledEcoBoostsCollection.length"
		_multiBoostSlotEntity =	"multiBoostSlotEntity"
		_multiboostEntity =		"isMultiBoostInteractionAvailiable ? multiBoostEntity : null"
		_isMultiboostLinked =	"isLinkedToShip"
	)
)

(def element TTXWidgetSlotItemEcoBoost (_slotEntity:dhEntity)
	(scope
		(var slot:dhComponent =			"_slotEntity.equipmentSlot")
		(var installedEntityId:number =	"slot.installedEntityId"	(event "slot.evInstalledEntityIdChanged"))

		(var ecoBoostEntity:dhEntity =	"getEntity(installedEntityId)")
		(var ecoBoost:dhComponent =		"ecoBoostEntity.ecoBoost")
		(var rarity:number =			"ecoBoost.rarity ?: WIDGET_ITEM_STATE.NONE")
		(var amount:number =			"ecoBoostEntity.countComponent.value ?: 0"	(event "ecoBoostEntity.countComponent.evChanged"))

		(var itemStateIndex:number =	"rarity > 0		? amount > 0	? rarity
																		: WIDGET_ITEM_STATE.PREINSTALLED
														: WIDGET_ITEM_STATE.NONE")
	)

	(element TTXWidgetSlotItemView
		_state = "itemStateIndex"
	)
)

(def element TTXWidgetSlotItemMultiBoost (_slotEntity:dhEntity)
	(scope
		(var slot:dhComponent =			"_slotEntity.equipmentSlot")
		(var installedEntityId:number =	"slot.installedEntityId"	(event "slot.evInstalledEntityIdChanged"))

		(var purchasableMultiboostEntity:dhEntity =	"getSingleEntity(CC.ecoBoost, 'availableToUser.' + 'byType.' + SC.Common.ECOBOOST_TYPES.LINKABLE + '.purchasableMultiboost')")
		(var multiBoostEntity:dhEntity =			"getEntity(installedEntityId ?: purchasableMultiboostEntity.id)")
		(var multiBoost:dhComponent =				"multiBoostEntity.ecoBoost")
		(var isLinkedToShip:bool =					"multiBoost.isLinkedToShip"		(event "multiBoost.evUpdated"))
		(var itemStateIndex:number =				"isLinkedToShip ? WIDGET_ITEM_STATE.LEGENDARY : WIDGET_ITEM_STATE.NONE")
	)

	(element TTXWidgetSlotItemView
		_state = "itemStateIndex"
	)
)

(def element TTXCommonWidgetEcoboostTooltipItem (_installedEntityId:number)
	(scope
		(var ecoBoostEntity:dhEntity =	"getEntity(_installedEntityId)")
		(var ecoBoost:dhComponent =		"ecoBoostEntity.ecoBoost")

		(var name:str =		"ecoBoost.name")
		(var subType:str =	"ecoBoost.subType ?: ''")

		(var amount:number =		"ecoBoostEntity.countComponent.value ?: 0"		(event "ecoBoostEntity.countComponent.evChanged"))
		(var hasAnyBoosts:bool =	"amount > 0")

		(var attributesPositive:array =	"ecoBoostEntity.attributes.positive ?: []"	(event "ecoBoostEntity.attributes.evChanged"))
		(var boostInfluence:str =		"attributesPositive[0]['measuredValue'] + attributesPositive[0]['measure']")
		(var boostTitle:str =			"tr('IDS_ECONOMIC_BOOST_TYPE_' + toUpper(subType) + '_SIMPLE_SUMMARY_TOOLTIP') + tr('IDS_TOOLTIP_SPACE') + boostInfluence")
	)

	(style
		(flow = "horizontal")
		(align = "middle")
		(width = 100%)
		(height = 96px)
		(paddingTop = "S")
		(paddingBottom = "S")
		(paddingLeft = "SXS")
		(paddingRight = "SXS")
	)

	(block
		(style
			(width = 80px)
			(height = 80px)
			(marginRight = "S")
		)

		(block
			(class $FullsizeAbsolute)
			(style
				(bind backgroundImage "'url:../eco_boosts/common/' + name + '.png'")
				(bind alpha "hasAnyBoosts ? 1 : 0.5")
			)
		)

		(block
			(style
				(position = "absolute")
				(left = 21px)
				(top = 21px)
			)

			(controller $Instance renderer='MarkerAttention'
				(bind enabled "!hasAnyBoosts")
				(args
					_size = "SIZE.MEDIUM"
				)
			)
		)
	)

	(block
		(style (width = 100%))

		(tf
			(class $TextDefaultBoldNM)
			(style
				(width = 100%)
				(leading = -2)
				(alpha = "TA")
			)

			(bind text "boostTitle")
		)

		(block
			(bind name "'AmountOfBought_' + name")

			(style (marginTop = "SXS"))

			(tf
				(bind visible "hasAnyBoosts")
				(class $TextDefaultNM)
				(style (alpha = "TC"))
				(bind text "tr('IDS_IN_WAREHOUSE') + ' ' + formatSeparator(amount)")
			)

			(tf
				(bind visible "!hasAnyBoosts")
				(class $TextDefaultNM)
				(style (alpha = "TC"))
				(text = 'IDS_OUT_OF_STOCK')
			)
		)
	)
)