(def element GuidingTipsBattleTypeHub (	_tipId:number, _chainId:number, _battleTypeEntity:dhEntity, _isSmallScreenSize:bool, _scrollToIndex:number,
										_battleTypeStatus:number, _battleType:str)
	(scope
		(event evBattleTypeChosen)

		
		(var rankSeasonEntity:dhEntity = "getSingleEntity(CC.rankSeason)")
		(var rankSeasonComponent:dhComponent = "rankSeasonEntity.rankSeason")
		(var isDivisionAllowedInRanked:bool = "rankSeasonComponent.isDivisionAllowed" (event "rankSeasonComponent.evChanged"))

		
		(var isTrialBattletype:bool = "_battleType == SC.Common.BATTLE_TYPES.TRIAL_BATTLE")
		(var isRankedBattle:bool = "_battleType == SC.Common.BATTLE_TYPES.RANKED_BATTLE")
		(var isTrainingBattle:bool = "_battleType == SC.Common.BATTLE_TYPES.TRAINING_BATTLE")
		(var isTournamentBattle:bool = "_battleType == SC.Common.BATTLE_TYPES.TOURNAMENT_BATTLE")
		(var isCustomBattle:bool = "isTrainingBattle || isTournamentBattle")
		(var isRatingBattle:bool = "_battleType == SC.Common.BATTLE_TYPES.RATING_BATTLE")

		(var shallDeactivateChain:bool = "_tipId && !isIn(_tipId, [ SC.Context_guiding_tip.TIP_TYPE.PVE_FINAL, SC.Context_guiding_tip.TIP_TYPE.PVE_FINAL_REPEAT ])")

		
		(var divisionDataEntity:dhEntity = "getSingleEntity(CC.division)")
		(var isDivisionsAvailableInThisBattleType:bool = "!isCustomBattle && (!isRankedBattle || isDivisionAllowedInRanked)")

		(var isNewRankedFinishTip:bool =	"_battleTypeStatus == SC.Common.BATTLE_TYPE_STATE.DISABLED && isRankedBattle")
		(var isRankedBattleInactive:bool =	"_battleTypeStatus == SC.Common.BATTLE_TYPE_STATE.INACTIVE_BY_PRIMETIME && isRankedBattle")
		(var isRatingBattleInactive:bool =	"_battleTypeStatus == SC.Common.BATTLE_TYPE_STATE.INACTIVE_BY_PRIMETIME && isRatingBattle")
		(var isSelectableBattleType:bool =	"_battleTypeStatus != SC.Common.BATTLE_TYPE_STATE.DISABLED && (!divisionDataEntity || isDivisionsAvailableInThisBattleType)")

		(var chainId:number = "shallDeactivateChain ? _chainId : SC.Context_guiding_tip.TIP_CHAIN_ID.NONE")

		(var hasFinishButton:bool = "isRankedBattleInactive || isRatingBattleInactive || !isSelectableBattleType")
		(var onDeactivateTipChain:bool = "chainId && !isNewRankedFinishTip")

		(var isGuidingLeftByCard:bool = "isTrainingBattle || isTrialBattletype")
		(var guidingTipPosition:str = "isGuidingLeftByCard ? TIP_POSITION_LEFT : TIP_POSITION_RIGHT")
		(var pointerOffset:number = 40px)
		(var guidingPointerOffset:number = "isGuidingLeftByCard ? pointerOffset : -pointerOffset")
		(var extendedGuidingSmallPadding:number = "BATTLE_TYPE_CAROUSEL_PADDING_SMALL + pointerOffset")
		(var extendedGuidingPadding:number = "BATTLE_TYPE_CAROUSEL_PADDING + pointerOffset")
		(var screenOffsetRight:number = "isGuidingLeftByCard	?	_isSmallScreenSize	?	extendedGuidingSmallPadding
																						:	extendedGuidingPadding
																:	_isSmallScreenSize	?	BATTLE_TYPE_CAROUSEL_PADDING_SMALL
																						:	BATTLE_TYPE_CAROUSEL_PADDING")
		(var screenOffsetLeft:number = "isGuidingLeftByCard	?	_isSmallScreenSize	?	BATTLE_TYPE_CAROUSEL_PADDING_SMALL
																					:	BATTLE_TYPE_CAROUSEL_PADDING
															:	_isSmallScreenSize	?	extendedGuidingSmallPadding
																					:	extendedGuidingPadding")
	)
	(bindcall externalCall 'inputMapping.onAction' "[onDeactivateTipChain ? 'deactivateTipChain' : '', { tip_chain_id: chainId }]" watch=false (event "evBattleTypeChosen"))

	(dispatch "'evScrollToIndex'" dir="EventDirection.UP" args="{_scrollToIndex: _scrollToIndex}" on='addedToStage')

	(style (width = 100%))

	(element GuidingTipHub
		_tipId =				"_tipId"
		_tipPositioning =		"guidingTipPosition"
		_offsetY =				"BATTLE_TYPE_COMMON_CARD_HEIGHT / 2"
		_offsetX =				"M"
		_pointerOffset =		"guidingPointerOffset"
		_hasFinishButton =		"hasFinishButton"
		_modalWindowName =		"SC.Ui_windows.MODAL.BATTLE_TYPE_CHOOSER"
		_isHideOnBounds =		true
		_screenOffsetRight =	"screenOffsetRight"
		_screenOffsetLeft =		"screenOffsetLeft"
		_hasAssistant =			true
	)
)

(def macro DESATURATION_BATTLE_TYPE(_isNotDesaturated:expression)
	(filters
		(colorMatrix
			(bind matrix "_isNotDesaturated ? [0, 0, 0, 0] : [-15, 10, -100, -50]")
		)
	)
)

(def element BattleTypeCard (_cardHeight:number, _cardWidth:number, _cardEventHeight:number, _size:number, _battleTypeEntity:dhEntity)
	(scope
		(event evBattleTypeSelected)

		(struct mouseHandler = MOUSE_HANDLER())

		(var isSmallScreenSize:bool = "_size == SIZE.SMALL")

		
		(var battleSeasonInfoComponent:dhComponent = "_battleTypeEntity.battleSeasonInfo")
		(var battleTypeComponent:dhComponent = "_battleTypeEntity.battleType")
		(var battleType:str = "battleTypeComponent.type")
		(var isAccentCard:bool = "battleTypeComponent.isFullSizeIcon" (event "battleTypeComponent.evIsFullSizeIconChanged"))

		(var battleTypeStatus:number = "battleTypeComponent.status" (event "battleTypeComponent.evStatusChanged"))
		(var battleTypeGameParamId:number = "battleTypeComponent.battleTypeGameParamId" (event "battleTypeComponent.evStatusChanged") (event "battleTypeComponent.evSelectionChanged"))
		(var isBattleTypeSelected:bool = "battleTypeComponent.selected" (event "battleTypeComponent.evStatusChanged") (event "battleTypeComponent.evSelectionChanged"))

		

		(var isNewBattle:bool = "_battleTypeEntity.hasComponent(CC.newItem)")
		(var isPVEBattle:bool = "battleType == SC.Common.BATTLE_TYPES.PVE_BATTLE")
		(var isEventBattle:bool = "battleType == SC.Common.BATTLE_TYPES.EVENT_BATTLE")

		
		(var isTrainingBattletype:bool = "battleType == SC.Common.BATTLE_TYPES.TRAINING_BATTLE")

		(var isInDivision:bool = "getSingleEntity(CC.division) != null")
		(var isInBalancer:bool = "getSingleEntity(CC.balancerInfo) != null")

		
		(var rankSeasonComponent:dhComponent = "getSingleComponent(CC.rankSeason)")
		(var isDivisionAllowedInRanked:bool = "rankSeasonComponent.isDivisionAllowed" (event "rankSeasonComponent.evChanged"))

		(var isAvailableInPrimeTime:bool = "battleTypeStatus != SC.Common.BATTLE_TYPE_STATE.INACTIVE_BY_PRIMETIME")
		(var isAvailableTrainingRoom:bool = "!isTrainingBattletype || isDivisionAllowedInRanked || !isInDivision")
		(var isSelectableBattleType:bool = "battleTypeStatus != SC.Common.BATTLE_TYPE_STATE.DISABLED && isAvailableInPrimeTime && isAvailableTrainingRoom")

		
		(var eventBattleComponent:dhComponent = "_battleTypeEntity.eventBattleState") 
		(var eventBattleName:str = "eventBattleComponent.name ?: SC.Common.BATTLE_TYPES.EVENT_BATTLE" (event "eventBattleComponent.evChanged")) 
		(var operationBattleComponent:dhComponent =	"_battleTypeEntity.operation")
		(var operationIconName:str = "operationBattleComponent.customIconName ?: battleType" (event "operationBattleComponent.evStatusChanged"))

		(var battleName:str = "isEventBattle ? eventBattleName : operationIconName")

		
		(var battleHeaderIDS:str = "isEventBattle	?	'IDS_' + eventBattleName:
									isPVEBattle		?	'IDS_' + operationBattleComponent.gpName + '_NAME'
													:	'IDS_' + battleType")

		(var battleTypeSubheader:str = "isEventBattle	?	'IDS_' + eventBattleName + '_SUBHEADER' :
										isPVEBattle		?	'IDS_' + operationIconName + '_SUBHEADER'
														:	'IDS_' + battleType + '_SUBHEADER'")

		
		(struct serverTime = SERVER_TIME())
		(var finishTime:number = "_battleTypeEntity.timeOfBattleEvent.finishTime ?: 0" (event "_battleTypeEntity.timeOfBattleEvent.evChanged"))

		
		(var backgroundState:number = "	isBattleTypeSelected && mouseHandler.mouseDown		?	SC.Ui_styles.BUTTON_STATE.SELECTED_DOWN :
										isSelectableBattleType && mouseHandler.mouseDown	?	SC.Ui_styles.BUTTON_STATE.DOWN :
										isBattleTypeSelected && mouseHandler.rollOver		?	SC.Ui_styles.BUTTON_STATE.SELECTED_OVER :
										isBattleTypeSelected								?	SC.Ui_styles.BUTTON_STATE.SELECTED :
										mouseHandler.rollOver && isSelectableBattleType		?	SC.Ui_styles.BUTTON_STATE.OVER :
										!isSelectableBattleType								?	SC.Ui_styles.BUTTON_STATE.DISABLED
																							:	SC.Ui_styles.BUTTON_STATE.UP")

		
		(var isTrialBattletype:bool = "battleType == SC.Common.BATTLE_TYPES.TRIAL_BATTLE")
		(var trialGPName:str = "_battleTypeEntity.trial.gpName ?: 'PCVT004_MANEUVER_PRIME'")

		
		(var cardActiveHoverAlpha:number = "BATTLETYPE_CARD_HOVER_ALPHA[backgroundState] ?: 0")
		(var cardRulesAndRestrictionsAlpha:number = "BATTLETYPE_CARD_RULES_ALPHA[backgroundState]")
		(var cardBackgroundColorfulAlpha:number = "	!isSelectableBattleType	?	0 :
													isBattleTypeSelected	?	0.3
																			:	0.1")

		
		(var battleTypeDenyReasons:array = "battleTypeComponent.battleTypeReasons" (event "battleTypeComponent.evDisableReasonChanged"))
		(var reasonText:str = "battleTypeDenyReasons.length ? battleTypeDenyReasons[0] : ''")

		
		(struct trainingFeature = FEATURES(_state="SC.Common.ACCOUNT_FEATURE.TRAINING_BATTLE"))

		
		(struct markerData = PULL_MARKER_NEW(_groupName = "SC.Ui_common.CONTENT_MARKER_GROUPS.TRIAL_BATTLE_TYPE_CHOOSER"))
		(var isMarkerNewVisible:bool = "isTrialBattletype		?	markerData.isVisible && isSelectableBattleType :
										isTrainingBattletype	?	trainingFeature.state == 'new'
																:	isNewBattle && isSelectableBattleType")

		
		(var lockedBattletypeText:str = "	isInBalancer												?	'IDS_UNABLE_TO_SET_WHILE_IN_BALANCER_EVENT_BATTLES' :
											isTrainingBattletype && trainingFeature.state == 'locked'	?	'IDS_ACCESS_LEVEL_TOO_LOW_TO_PARTICIPATE_IN_BATTLE' :
											isTrainingBattletype && isInDivision						?	'IDS_UNABLE_TO_CREATE_TRAINING_WHEN_IN_DIVISION' :
											reasonText													?	reasonText
																										:	'IDS_TOOLTIP_ACCESS_PRIME_TIME'")

		
		(var colorTransformName:str = "isPVEBattle	?	operationIconName != SC.Common.BATTLE_TYPES.PVE_BATTLE	?	SC.Common.BATTLE_TYPES.EVENT_BATTLE
																												:	battleName
													:	battleType")

		(var isFirstRollOverActive:bool = false)
		(bind isFirstRollOverActive "true" init=false watch=false (bind enabled "mouseHandler.rollOver"))

		
		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct activeTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.PVP_FINAL,
																											SC.Context_guiding_tip.TIP_TYPE.PVP_FINAL_REPEAT,
																											SC.Context_guiding_tip.TIP_TYPE.PVE_CHOOSE,
																											SC.Context_guiding_tip.TIP_TYPE.PVE_CHOOSE_REPEAT,
																											SC.Context_guiding_tip.TIP_TYPE.PVE_FINAL,
																											SC.Context_guiding_tip.TIP_TYPE.PVE_FINAL_REPEAT,
																											SC.Context_guiding_tip.TIP_TYPE.COMPETITIVE_FINAL,
																											SC.Context_guiding_tip.TIP_TYPE.COMPETITIVE_FINAL_REPEAT,
																											SC.Context_guiding_tip.TIP_TYPE.TRIALS_ONBOARDING_CHOOSE_BATTLE_TYPE ]"))
	)

	(bind name "isTrialBattletype		?	'typeItemTrial'
										:	'typeItem' + battleType")

	
	(dispatch evBattleTypeChosen dir="EventDirection.DOWN" (bind enabled "isSelectableBattleType && !isTrialBattletype") (event "evBattleTypeSelected"))

	(style
		(bind width "_cardWidth")
		(bind height "isAccentCard ? _cardEventHeight : _cardHeight")
	)

	(macro STRUCT_MOUSE_DISPATCHER _mouseHandler = "mouseHandler")

	(macro STRUCT_SOUND_HANDLER
		_enabled =		"isSelectableBattleType"
		_mouseHandler =	"mouseHandler"
		_soundSet =		"isBattleTypeSelected ? 'button_secondary' : 'battle_type_choose'"
		_soundClick =	"isBattleTypeSelected ? SoundEvent.CLICK : battleType + '_click'"
	)

	(macro STRUCT_DISPATCH_HANDLER
		_enabled =		"isSelectableBattleType"
		_mouseHandler =	"mouseHandler"
		_dispatchedEv =	"'evBattleTypeSelected'"
	)

	(macro STRUCT_CLICK_HANDLER
		_enabled = "isSelectableBattleType"
		_mouseHandler = "mouseHandler"
		_methods = "[{	type: !isTrialBattletype && !isTrainingBattletype ? 'inputMapping.onAction' : '',
						name: 'setBattleType',
						args: { battleType: battleType, battleTypeGameParamId: battleTypeGameParamId }},
					{	type: !isBattleTypeSelected ? 'inputMapping.onAction' : '',
						name: 'PVEScriptsProxy.changeEnterMatchmaker',
						args: { enterMatchmaker: true } },
					{	type: !isBattleTypeSelected ? 'inputMapping.onRequest' : '',
						name: 'setSplashScreenViewed',
						args: { clickedButtonType: 'ingame' }},
					# Training
					{	type: isTrainingBattletype ? 'inputMapping.onRequest' : '',
						name: 'showTrainingRoomsList',
						args: {}},
					{	type: 'inputMapping.onAction',
						name: 'featureSeen',
						args: { featureIndex: battleTypeComponent.featureId }},
					# Trials
					{	type: isTrialBattletype ? 'inputMapping.onAction' : '',
						name: 'navigateTo',
						args: { route: SC.Ui_windows.MODAL.TRIALS }},
					{	type: isNewBattle ? 'inputMapping.onAction' : '',
						name: 'makeSeen',
						args: { entityId: _battleTypeEntity.id }},
					# Close battlechooser
					{	type: !isTrialBattletype && !isTrainingBattletype ? 'inputMapping.onRequest' : '',
						name: 'closeModalSelectBattleType',
						args: {}} ]"
	)

	
	(element BattletypeControlBackground
		_mouseDown = "mouseHandler.mouseDown"
		_mouseOver = "mouseHandler.rollOver"
		_selected = "isBattleTypeSelected"
		_isLocked = "!isSelectableBattleType"
	)

	
	(block
		(class $FullsizeAbsolute)
		(style
			(alpha = "cardBackgroundColorfulAlpha")
			(borderRadius = "S")
			(backgroundColor = "SC.Ui_styles.SERVICE_COLORS.WHITE")
		)

		(bind colorTransform "BATTLE_TYPES_CT[colorTransformName]")

		(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
			_duration = "0.15"
			_trigger = "cardBackgroundColorfulAlpha"
			_alpha = "cardBackgroundColorfulAlpha"
		)
	)

	
	(block
		(class $FullsizeAbsolute)

		(controller $Instance renderer = 'BattleTypeCardBackgroundImage'
			(bind enabled "isEventBattle && isAccentCard")
			(args
				_imageStr = "'url:../service_kit/battle_types/card_backgrounds/' + battleName + '.png'"
			)
		)
	)

	
	(element BattleTypeCardColorfulGradient
		_alpha = "!isSelectableBattleType ? 0 : 1"
		_colorTransform = "BATTLE_TYPES_CT[colorTransformName]"
	)

	
	(block
		(class $FullsizeAbsolute)
		(controller $Instance renderer='BattleTypeCardSpineAnimation'
			(bind enabled "isBattleTypeSelected")
			(args
				_isSmallScreenSize = "isSmallScreenSize"
				_isMouseOver = "mouseHandler.rollOver"
			)
		)
	)

	
	(element BattleTypeCardBackgroundCorner
		_isSelectableBattleType = "isSelectableBattleType"
		_battletype = "battleType"
		_cardHeight = "_cardHeight"
		_colorTransform = "BATTLE_TYPES_CT[colorTransformName]"
	)

	
	(block
		(style
			(hitTest = false)
			(position = "absolute")
			(backgroundSize = "cover")
			(bind height "isSmallScreenSize ? 100px : 120px")
			(bind width "isSmallScreenSize ? 100px : 120px")
			(bind right "isSmallScreenSize ? SXS : MS")
			(bind bottom "isSmallScreenSize ? SXS : MS")
			(bind backgroundImage "'url:../service_kit/battle_types/' + battleName + '_big.png'")
			(macro DESATURATION_BATTLE_TYPE "isSelectableBattleType")
		)
	)

	
	(block
		(class $FullsizeAbsolute)
		(controller $Instance renderer='BattleTypeCardBlurPanel'
			(bind enabled "isFirstRollOverActive")
			(args
				_cardActiveHoverAlpha = "cardActiveHoverAlpha"
				_isSmallScreenSize = "isSmallScreenSize"
				_isBattleTypeSelected = "isBattleTypeSelected"
				_isSelectableBattleType = "isSelectableBattleType"
				_buttonText = "isTrainingBattletype || isTrialBattletype ? 'IDS_GOTO' : 'IDS_CHOOSE'"
			)
		)
	)

	
	(block
		(class $FullsizeAbsolute)
		(style
			(bind paddingTop "isSmallScreenSize ? 18px : MS")
			(bind paddingLeft "isSmallScreenSize ? 18px : MS")
			(bind paddingRight "isSmallScreenSize ? 18px : MS")
		)

		
		(hblock
			(style
				(width = 100%)
				(bind marginBottom "isTrialBattletype && isBattleTypeSelected	?	isSmallScreenSize	?	6px
																										:	11px
																				:	isSmallScreenSize	?	S
																										:	M
									")
			)

			(block
				(style
					(width = 100%)
					
					(bind paddingLeft "isSmallScreenSize ? 0px : 1px")
				)

				(tf
					(bind class "isSmallScreenSize ? '$TextDefaultBold22NM' : '$TextDefaultBold26NM'")
					(style
						(width = 100%)
						(alpha = "TA")
					)
					(bind text "toUpper(tr(battleHeaderIDS))")
				)
			)

			(block
				(bind visible "finishTime > 0")

				(style
					(padding = "-XS")
					(bind marginTop "isSmallScreenSize ? -1px : 1px")
				)

				(controller $Instance renderer='RentTimerIcon'
					(bind enabled "finishTime > 0")
					(args
						_rentUntil = "finishTime"
						_size = "SIZE.MEDIUM"
					)
				)
			)
		)

		
		(block
			(style
				(width = 100%)
				(bind marginBottom "isSmallScreenSize ? SXS : MS")
			)

			
			(block
				(bind visible "!(isTrialBattletype && isBattleTypeSelected)")
				(style (width = 100%))

				(tf
					(bind class "isSmallScreenSize ? '$TextDefaultNM' : '$TextDefault20NM'")
					(style
						(width = 100%)
						(alpha = "TC")
					)
					(bind text "battleTypeSubheader")
				)
			)

			
			(hblock
				(bind visible "isTrialBattletype && isBattleTypeSelected")
				(style
					(align = "middle")
					(height = 24px)
					(width = 100%)
					(paddingLeft  = "-XS")
				)

				(block
					(style
						(height = 24px)
						(width = 24px)
						(marginRight = "S")
						(backgroundSize = "cover")
						(bind backgroundImage "'url:../events/battle_challenges/modal_chooser/' + trialGPName + '_BIG.png'")
					)
				)

				(tf
					(bind class "isSmallScreenSize ? '$TextDefaultNM' : '$TextDefault20NM'")
					(style
						(width = 100%)
						(alpha = "TC")
					)

					(bind text "'IDS_' + trialGPName + '_NAME'")
				)
			)
		)

		(block
			(style
				(width = 100%)
				(alpha = 0.9)
			)

			(controller $Instance renderer='StatusLine'
				(bind enabled "!isSelectableBattleType")
				(args
					_unifiedStatus =	"SC.Ui_styles.UNIFIED_STATUS.LOCK"
					_text =				"lockedBattletypeText"
					_textClass =		"isSmallScreenSize ? '$TextDefault14NM' : '$TextDefaultNM'"
					_width =			100%
				)
			)
		)

		
		(block
			(style (width = 100%))

			(controller $Instance renderer='BattleTypeCardDescriptionWithModifiers'
				(bind enabled "isFirstRollOverActive && isSelectableBattleType")
				(args
					_backgroundState = "backgroundState"
					_battleTypeComponent = "battleTypeComponent"
					_battleSeasonInfoComponent = "battleSeasonInfoComponent"
					_battleName = "battleName"
					_isSmallScreenSize = "isSmallScreenSize"
					_isTrainingBattletype = "isTrainingBattletype"
					_isTrialBattleType = "isTrialBattletype"
					_isPVEBattleType = "isPVEBattle"
				)
			)
		)
	)

	
	(block
		(class $FullsizeAbsolute)

		(controller $Instance renderer='BattleTypeCardRestrictionInfo'
			(bind enabled "isSelectableBattleType")
			(args
				_backgroundState = "backgroundState"
				_battleTypeComponent = "battleTypeComponent"
				_battleSeasonInfoComponent = "battleSeasonInfoComponent"
				_battleName = "battleName"
				_isSmallScreenSize = "isSmallScreenSize"
			)
		)
	)

	
	(block
		(macro DEFAULT_CONTROL_MARKER_ANIMATION "isMarkerNewVisible")
		(style
			(position = "absolute")
			(top = "-XS")
			(right = 40px)
		)
		(element MarkerNew)
	)

	
	(block
		(class $FullsizeAbsolute)
		(controller $Instance renderer='GuidingTipsBattleTypeHub'
			(bind enabled "activeTipId.value && activeTip.targetId == battleType")
			(args
				_tipId = "activeTipId.value"
				_chainId = "activeTip.chainId"
				_battleTypeEntity = "_battleTypeEntity"
				_isSmallScreenSize = "isSmallScreenSize"
				_scrollToIndex = "$index"
				_battleTypeStatus = "battleTypeStatus"
				_battleType = "battleType"
			)
		)
	)

	
	(controller $Tooltip
		(bind renderer "BATTLETYPE_CARD_TOOLTIP[battleType]")
		(args
			_battleTypeEntityId = "_battleTypeEntity.id"
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)
)

(def element BattleTypeCardRestrictionInfo (	_backgroundState:number,
												_battleTypeComponent:dhComponent,
												_battleSeasonInfoComponent:dhComponent,
												_isSmallScreenSize:bool,
												_battleName:str)
	(scope
		(var restrictionEntity:dhEntity = "getEntity(_battleTypeComponent.restrictionEntityId)" (event "_battleTypeComponent.evRestrictionEntityIdChanged"))
		(var battleTypeShipListRestrictions:dhComponent = "restrictionEntity.shipListRestrictions")
		(var isShipListRestricted:bool = "!battleTypeShipListRestrictions.levelString.empty || !battleTypeShipListRestrictions.selectedFilters.empty" (event "battleTypeShipListRestrictions.evUpdate"))

		(var battleType:str = "_battleTypeComponent.type")
		(var isTrainingBattletype:bool = "battleType == SC.Common.BATTLE_TYPES.TRAINING_BATTLE")
		(var isTrialBattletype:bool = "battleType == SC.Common.BATTLE_TYPES.TRIAL_BATTLE")
		(var isPVEBattle:bool = "battleType == SC.Common.BATTLE_TYPES.PVE_BATTLE")
	)
	(class $Fullsize)
	(style
		(align = "left|bottom")
		(alpha = "BATTLETYPE_CARD_RULES_ALPHA[_backgroundState]")
		(bind paddingLeft "_isSmallScreenSize ? 18px : MS")
		(bind paddingBottom "_isSmallScreenSize ? 18px : MS")
	)

	(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
		_duration = "0.15"
		_trigger = "_backgroundState"
		_alpha = "BATTLETYPE_CARD_RULES_ALPHA[_backgroundState]"
	)

	
	(block
		(bind visible "isShipListRestricted && !isTrainingBattletype && !isTrialBattletype")
		(style (bind marginBottom "_isSmallScreenSize ? M : MS"))

		(tf
			(bind class "_isSmallScreenSize ? '$TextDefault14NM' : '$TextDefaultNM'")
			(style
				(alpha = "TA")
				(bind marginBottom "_isSmallScreenSize ? S : SXS")
			)
			(text = 'IDS_BATTLETYPE_ALLOWED_SHIPS_COLON')
		)

		(block
			(controller $Instance renderer='ShipRestrictions'
				(bind enabled "isShipListRestricted && !isTrainingBattletype")
				(args
					_restrictionsEntityId = "restrictionEntity.id"
					_isFromTooltip = true
				)
			)
		)
	)

	
	(element BattleTypeCardRestrictionCommonInfo
		_battleTypeComponent = "_battleTypeComponent"
		_battleSeasonInfoComponent = "_battleSeasonInfoComponent"
		_restrictionEntity = "restrictionEntity"
		_isSmallScreenSize = "_isSmallScreenSize"
		_battleName = "_battleName"
	)
)

(def element BattleTypeCardRestrictionCommonInfo (	_battleTypeComponent:dhComponent,
													_battleSeasonInfoComponent:dhComponent,
													_restrictionEntity:dhEntity,
													_isSmallScreenSize:bool,
													_battleName:str)
	(scope
		(macro DIVISION_RESTRICTIONS_SCOPE "_restrictionEntity")

		(macro PULL_SHIP_ID)
		(var ownShipEntity:dhEntity = "getPrimaryEntity(CC.ownShip, playerShipId)")
		(var levelIndex:number = "ownShipEntity.ship.level ?: 0" (event "ownShipEntity.ship.evUpdate"))
		(var battleType:str = "_battleTypeComponent.type")
		(var teamSize:number = "	battleType == SC.Common.BATTLE_TYPES.COOPERATIVE_BATTLE	?	levelIndex < 4	?	6
																												:	9 :
									battleType == SC.Common.BATTLE_TYPES.RANDOM_BATTLE		?	levelIndex < 4	?	6 :
																								levelIndex == 4	?	9
																												:	12
																							:	maxPlayers")
		(var isEventBattle:bool = "battleType == SC.Common.BATTLE_TYPES.EVENT_BATTLE")
		(var isTrainingBattletype:bool = "battleType == SC.Common.BATTLE_TYPES.TRAINING_BATTLE")
		(var isTrialBattleType:bool = "battleType == SC.Common.BATTLE_TYPES.TRIAL_BATTLE")
		(var isPVEBattleType:bool = "battleType == SC.Common.BATTLE_TYPES.PVE_BATTLE")
	)

	(style (width = 100%))

	(block
		(style (bind marginBottom "_isSmallScreenSize ? S : SXS"))

		(tf
			(bind class "_isSmallScreenSize ? '$TextDefault14NM' : '$TextDefaultNM'")
			(style (alpha = "TA"))
			(text = 'IDS_BATTLETYPE_FEATURES_COLON')
		)
	)

	(hblock
		(style
			(align = "middle")
			(height = "BATTLETYPE_MODIFIER_ICON")
			(width = 100%)
		)

		
		(tf
			(bind visible "!isTrainingBattletype && !isPVEBattleType && !isTrialBattleType")
			(bind class "_isSmallScreenSize ? '$TextDefaultBold14NM' : '$TextDefaultBoldNM'")
			(style (alpha = "TA"))
			(bind text "isEventBattle ? 'IDS_FORMAT_EVENTBATTLE_' + _battleName : teamSize + 'Ã—' + teamSize")
		)

		
		(block
			(style (bind marginLeft "_battleSeasonInfoComponent.battleItemTreeGpId > 0 ? S : 0px"))

			(controller $Instance renderer='BattleModeSpecificsModifierItem'
				(bind enabled "_battleSeasonInfoComponent.battleItemTreeGpId > 0")
				(args
					_type = "BATTLE_SPECIFICS.MODIFIERS"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(style (bind marginLeft "_battleTypeComponent.hasCustomSlotsSettings ? S : 0px"))

			(controller $Instance renderer='BattleModeSpecificsModifierItem'
				(bind enabled "_battleTypeComponent.hasCustomSlotsSettings")
				(args
					_type = "BATTLE_SPECIFICS.CUSTOM_SETTINGS"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(style (bind marginLeft "_battleSeasonInfoComponent.isFogOfWar ? S : 0px"))

			(controller $Instance renderer='BattleModeSpecificsModifierItem'
				(bind enabled "_battleSeasonInfoComponent.isFogOfWar")
				(args
					_type = "BATTLE_SPECIFICS.FOG_OF_WAR"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			
			(controller $Instance renderer='BattleModeSpecificsModifierItem'
				(bind enabled "isTrainingBattletype")
				(args
					_type = "BATTLE_SPECIFICS.RESOURCE_NO_WASTE"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			
			(controller $Instance renderer='BattleModeSpecificsModifierItem'
				(bind enabled "isTrialBattleType")
				(args
					_type = "BATTLE_SPECIFICS.TUTORIAL_HINTS"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			
			(controller $Instance renderer='BattleModeSpecificsModifierItem'
				(bind enabled "isPVEBattleType")
				(args
					_type = "BATTLE_SPECIFICS.UNIQUE_SCENARIO"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(style (bind marginLeft "isPVEBattleType ? S : 0px"))

			(block
				(controller $Instance renderer='BattleModeSpecificsModifierItem'
					(bind enabled "isPVEBattleType")
					(args
						_type = "BATTLE_SPECIFICS.BIGGER_REWARD"
						_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
					)
				)
			)
		)

		
		(block
			(style (bind marginLeft "_battleSeasonInfoComponent.achievementsUI.length > 0 ? S : 0px"))

			(controller $Instance renderer='BattleModeSpecificsModifierItem'
				(bind enabled "_battleSeasonInfoComponent.achievementsUI.length > 0")
				(args
					_type = "BATTLE_SPECIFICS.HAS_ACHIEVEMENTS"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)
	)
)

(def element BattleTypeCardDescriptionWithModifiers (	_backgroundState:number,
														_battleTypeComponent:dhComponent,
														_battleSeasonInfoComponent:dhComponent,
														_isSmallScreenSize:bool,
														_battleName:str)
	(scope
		(var battleType:str = "_battleTypeComponent.type")
		(var isTrainingBattletype:bool = "battleType == SC.Common.BATTLE_TYPES.TRAINING_BATTLE")
		(var isTrialBattleType:bool = "battleType == SC.Common.BATTLE_TYPES.TRIAL_BATTLE")
		(var isPVEBattleType:bool = "battleType == SC.Common.BATTLE_TYPES.PVE_BATTLE")
	)

	(style
		(width = 100%)
		(alpha = "BATTLETYPE_CARD_HOVER_ALPHA[_backgroundState]")
	)

	(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
		_duration = "0.15"
		_trigger = "_backgroundState"
		_alpha = "BATTLETYPE_CARD_HOVER_ALPHA[_backgroundState]"
	)

	(block
		(style
			(width = 100%)
			(bind marginBottom "_isSmallScreenSize ? SXS : M")
		)

		(tf
			(bind class "_isSmallScreenSize ? '$TextDefault14NM' : '$TextDefaultNM'")
			(style
				(width = 100%)
				(alpha = "TC")
			)
			(bind text "'IDS_' + _battleName + '_DESCRIPTION'")
		)
	)

	(block
		(style
			(width = 100%)
			(bind vgap "_isSmallScreenSize ? 10px : SXS")
		)

		
		(block
			(bind visible "_battleSeasonInfoComponent.battleItemTreeGpId > 0")
			(style (width = 100%))

			(controller $Instance renderer='BattleModeSpecificsModifierLineItem'
				(bind enabled "_battleSeasonInfoComponent.battleItemTreeGpId > 0")
				(args
					_type = "BATTLE_SPECIFICS.MODIFIERS"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(bind visible "_battleTypeComponent.hasCustomSlotsSettings")
			(style (width = 100%))

			(controller $Instance renderer='BattleModeSpecificsModifierLineItem'
				(bind enabled "_battleTypeComponent.hasCustomSlotsSettings")
				(args
					_type = "BATTLE_SPECIFICS.CUSTOM_SETTINGS"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(bind visible "_battleSeasonInfoComponent.isFogOfWar")
			(style (width = 100%))

			(controller $Instance renderer='BattleModeSpecificsModifierLineItem'
				(bind enabled "_battleSeasonInfoComponent.isFogOfWar")
				(args
					_type = "BATTLE_SPECIFICS.FOG_OF_WAR"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(bind visible "isTrainingBattletype")
			(style (width = 100%))

			(controller $Instance renderer='BattleModeSpecificsModifierLineItem'
				(bind enabled "isTrainingBattletype")
				(args
					_type = "BATTLE_SPECIFICS.RESOURCE_NO_WASTE"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(bind visible "isTrialBattleType")
			(style (width = 100%))

			(controller $Instance renderer='BattleModeSpecificsModifierLineItem'
				(bind enabled "isTrialBattleType")
				(args
					_type = "BATTLE_SPECIFICS.TUTORIAL_HINTS"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(bind visible "isPVEBattleType")
			(style (width = 100%))

			(controller $Instance renderer='BattleModeSpecificsModifierLineItem'
				(bind enabled "isPVEBattleType")
				(args
					_type = "BATTLE_SPECIFICS.UNIQUE_SCENARIO"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(bind visible "isPVEBattleType")
			(style (width = 100%))

			(controller $Instance renderer='BattleModeSpecificsModifierLineItem'
				(bind enabled "isPVEBattleType")
				(args
					_type = "BATTLE_SPECIFICS.BIGGER_REWARD"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)

		
		(block
			(bind visible "_battleSeasonInfoComponent.achievementsUI.length > 0")
			(style (width = 100%))

			(controller $Instance renderer='BattleModeSpecificsModifierLineItem'
				(bind enabled "_battleSeasonInfoComponent.achievementsUI.length > 0")
				(args
					_type = "BATTLE_SPECIFICS.HAS_ACHIEVEMENTS"
					_size = "_isSmallScreenSize ? SIZE.SMALL : SIZE.MEDIUM"
				)
			)
		)
	)
)