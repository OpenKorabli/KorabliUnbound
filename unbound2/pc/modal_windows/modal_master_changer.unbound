(def element ModalMasterChanger ()
	(macro MODAL_WINDOW_INIT)
	(macro MODAL_WINDOW_BG)
	(scope
		(var masterChanger:dhComponent = "getSingleComponent(CC.masterChanger)")
		(var countBattles:number = "masterChanger.countBattles ?: 0" (event "masterChanger.evCountBattlesChanged"))
		(var lastBattleTimestamp:number = "masterChanger.lastBattleTimestamp ?: 0" (event "masterChanger.evLastBattleTimestampChanged"))
		(struct serverTime = SERVER_TIME())
		(struct countdownText = COUNTDOWN(_time = "lastBattleTimestamp" _serverTime = "serverTime.value" _format = 'mm:ss'))
	)
	(class $Fullsize)

	(block
		(class $EyeLevelAligned)
		(style (width = 540px))

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
			(style (width = 100%))

			(element ModalWindowShortHeader
				_header = 'IDS_SERVER_SWITCH'
			)
		)

		(block
			(style (width = 100%))

			(block
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
				(style
					(width = 100%)
					(marginTop = "M")
					(marginBottom = "M")
				)

				(tf
					(class $TextDefault18NM)
					(style
						(width = 100%)
						(textAlign = "center")
						(alpha = "TC")
					)
					(text = 'IDS_INSTRUCTION_SERVER_SWITCH')
				)
			)
			(element HorizontalDividerTwoPx)

			(block
				(style
					(width = 100%)
					(height = 150px)
				)

				
				(block
					(visible = "countBattles > 0")
					(style
						(alpha = "countBattles > 0 ? 1 : 0")
						(width = 100%)
						(align = "center")
					)

					(controller $Animation
						(bindcall play
							duration = 0.07
							to = "countBattles > 0	? { alpha: 1, visible: true }
													: { alpha: 0, visible: false }"
							watch = false
							(bind trigger "countBattles")
						)
					)

					(block
						(name = 'waiting_time')
						(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
						(style
							(width = 100%)
							(align = "center")
							(marginTop = "SXS")
							(marginBottom = "MS")
						)

						(tf
							(class $TextDefaultBold60NM)
							(style (alpha = "TA"))
							(bind text "countdownText.value")
						)

						(controller $Tooltip
							(renderer='SimpleStatusTooltip')
							(args
								_text = 'IDS_HINT_SERVER_SWITCH_TIMER'
							)
							(macro DEFAULT_TOOLTIP_BEHAVIOUR)
						)
					)


					(hblock
						(name = 'battles_to_end')
						(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
						(style
							(width = 100%)
							(align = "center")
							(marginBottom = "M")
						)
						(tf
							(class $TextDefault26NM)
							(style
								(alpha = "TA")
								(marginRight = "S")
							)
							(text = 'IDS_UNFINISHED_BATTLES_COLON')
						)

						(tf
							(class $TextDefaultBold26NM)
							(style (alpha = "TA"))
							(bind text "countBattles")
						)

						(controller $Tooltip
							(renderer='SimpleStatusTooltip')
							(args
								_text = 'IDS_HINT_SERVER_SWITCH_BATTLES'
							)
							(macro DEFAULT_TOOLTIP_BEHAVIOUR)
						)
					)
				)

				
				(block
					(visible = "countBattles == 0")
					(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
					(class $Fullsize)
					(style
						(alpha = "countBattles == 0 ? 1 : 0")
						(visualOffsetY = "countBattles == 0 ? 0px : 10px")
						(align = "center|middle")
					)

					(controller $Animation
						(bindcall play
							delay = 0.15
							duration = 0.3
							to = "countBattles == 0 ? { alpha: 1, visualOffsetY: 0px, visible: true }
													: { alpha: 0, visualOffsetY: 10px, visible: false }"
							easing = "Easing.quad_in_out"
							watch = false
							(bind trigger "countBattles == 0")
						)
					)
					(tf
						(class $TextDefault26NM)
						(style (textColor = "SC.Ui_styles.SERVICE_COLORS.WHITE"))
						(text = 'IDS_TRANSFER_IN_PROGRESS')
					)
				)
			)
		)
	)
	(block
		(style
			(position = "absolute")
			(right = 20px)
			(top = 20px)
		)

		(element ModalWindowCloseIcon)
	)
)