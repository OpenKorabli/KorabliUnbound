(def constant EVENT_RULES {
	'arc_event': [
					{	_imagePath: 'url:../modal_event_rules/arc_event/lore.png',
						_textTypes: [
							{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" },
							{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" }
						]
					},
					{	_imagePath: 'url:../modal_event_rules/arc_event/tasks.png',
						_textTypes: [
							{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" },
							{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" }
						]
					},
					{	_imagePath: 'url:../modal_event_rules/arc_event/restrictions.png',
						_textTypes: [
							{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" },
							{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" }
						]
					}
				],

	'strategic_actions': [
							{	_imagePath: 'url:../modal_event_rules/strategic_actions/icon_rules_StrategicActions_paragraph_1.png',
								_textTypes: [
									{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" }
								]
							},
							{	_imagePath: 'url:../modal_event_rules/strategic_actions/icon_rules_StrategicActions_paragraph_2.png',
								_textTypes: [
									{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" }
								]
							},
							{	_imagePath: 'url:../modal_event_rules/strategic_actions/icon_rules_StrategicActions_paragraph_3.png',
								_textTypes: [
									{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" }
								]
							}
						],

	'ship_mastery': [
						{	_imagePath: 'url:../modal_event_rules/ship_mastery/ship_mastery.png',
							_textTypes: [
								{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" },
								{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" }
							]
						},
						{	_imagePath: 'url:../modal_event_rules/ship_mastery/leagues.png',
							_textTypes: [
								{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" },
								{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" }
							]
						},
						{	_imagePath: 'url:../modal_event_rules/ship_mastery/rules.png',
							_textTypes: [
								{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" },
								{	_type: "SC.Ui_common.MODAL_RULES_TEXT_TYPE.PARAGRAPH" }
							]
						}
					],
})

(def element ModalWindowEventRules (_rulesType:str)
	(macro MODAL_WINDOW_INIT)
	(scope
		(var rulesBgName:str = "_rulesType in BG_CONFIG_EVENT_RULES	? _rulesType
																	: 'Default'")
		(var rulesCount:number = "EVENT_RULES[_rulesType].length")

		
		(var strategicActionsEvent:dhComponent = "getSingleComponent(CC.strategicActionsEvent)")
		(var isOnboardingSeen:bool = "strategicActionsEvent.isOnboardingSeen" (event "strategicActionsEvent.evIsOnboardingSeenChanged"))

		(macro PULL_SHIP_ID)
		(var shipOwnComponent:dhComponent = "getPrimaryComponent(CC.ownShip, playerShipId)")
		(var isShipReadyForBattle:bool = "shipOwnComponent.lock == SC.Common.OWN_SHIP_LOCK.DIVISION_IS_READY" (event "shipOwnComponent.evUpdateLock"))
		(var isInBalancer:bool = "getSingleEntity(CC.balancerInfo) != null")

		(var buttonShowTutorTooltipStatus:dict = "	isInBalancer 			? { unifiedStatus: SC.Ui_styles.UNIFIED_STATUS.WARNING,
																				text: 'IDS_NEWBIE_QUESTS_WARNING_BALANCER' } :
													isShipReadyForBattle	? { unifiedStatus: SC.Ui_styles.UNIFIED_STATUS.WARNING,
																				text: 'IDS_NEWBIE_QUESTS_DIVISION_READY_BUTTON_HINT' }
																			: null")
		(var hasButton:bool = "_rulesType == 'strategic_actions'")
	)
	(bindcall externalCall
		"isOnboardingSeen ? '' : 'inputMapping.onAction'"
		"[	'StrategicActionsProxyUSS.setStrategicActionsFlag',
			{strategicActionsFlag: SC.Common.STRATEGIC_ACTIONS_FLAGS.ONBOARDING_SEEN}]"
		(event "startHide")
	)

	(bind name "'ModalWindowEventRules_' + _rulesType")

	(class $Fullsize)

	(block
		(class $FullsizeAbsolute)
		(element ModalWindowAnimatedBackground
			_selectedCategory = "rulesBgName"
			_type = "SC.Ui_styles.ANIMATED_BG.EVENT_RULES"
			_hideTime = 0.15
			_hideDelay = 0.3
		)
	)

	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 0)
		(style (width = 100%))

		(element ModalWindowHeaderFullSize
			_windowName = "'IDS_MODAL_WINDOW_' + _rulesType + '_RULES_HEADER'"
		)
	)

	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
		(class $Fullsize)
		(style
			(align = "center")
			(paddingTop = "{ 720:XL, 1080:XLL}")
			(paddingBottom = "{ 720:XLM, 1080:XXL}")
		)

		(scrollArea
			(style
				(width = 760px)
				(height = 100%)
			)

			(macro DEFAULT_VERTICAL_SCROLL_PARAMS
				_singleStep = "150"
				_wheelScrollAcceleration = "0.8"
			)

			(content
				(style
					(width = 100%)
					(paddingBottom = "XS")
					(paddingTop = "XS")
				)

				(controller $Repeat renderer='RulesCardItem' name='rulesCardContainer'
					(bind count "rulesCount")
					(args
						_rulesName = "_rulesType"
						_rulesList = "EVENT_RULES[_rulesType]"
					)
				)
			)
			(bindcall scrollToBegin animated=false on='addedToStage')
		)

		(block
			(bind visible "hasButton")

			(macro DEFAULT_MODAL_WINDOW_ANIMATION 4)
			(style
				(marginTop = "MS")
				(marginBottom = "{720:L, 1080:XL}")
			)

			(controller $Tooltip
				(bind enabled "hasButton && buttonShowTutorTooltipStatus != null")
				(renderer = 'SimpleStatusTooltip')
				(args
					_unifiedStatus = "buttonShowTutorTooltipStatus.unifiedStatus"
					_text = "buttonShowTutorTooltipStatus.text"
				)
				(macro DEFAULT_TOOLTIP_BEHAVIOUR)
			)

			(controller $Instance renderer='DefaultButton'
				(bind enabled "hasButton")
				(args
					_focusIndex = 0
					_defaultFocused = true
					_name = 'btn_cancel'
					_enabled = "buttonShowTutorTooltipStatus == null"
					_width = 170px
					_label = 'IDS_MODAL_WINDOW_STRATEGIC_ACTIONS_RULES_BUTTON'
					_methods = "[
									{
										type: 'inputMapping.onAction',
										name: 'activateTipChain',
										args: { tip_chain_id : SC.Context_guiding_tip.TIP_CHAIN_ID.STRATEGIC_ACTIONS_ONBOARDING_REPEAT }
									},
									{
										type: 'inputMapping.onAction',
										name: 'deactivateTipChain',
										args: { tip_chain_id : SC.Context_guiding_tip.TIP_CHAIN_ID.STRATEGIC_ACTIONS_ONBOARDING }
									}
								]"
				)
			)
		)
	)
)
