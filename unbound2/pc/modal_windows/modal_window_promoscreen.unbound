(def constant PROMOSCREEN3_IMAGE_TINT_ALPHA {
	SC.Ui_styles.BUTTON_STATE.DOWN	: 0.3,
	SC.Ui_styles.BUTTON_STATE.OVER	: 1,
	SC.Ui_styles.BUTTON_STATE.UP	: 0.3
})

(def struct PROMOSCREEN_TEMPLATE (_image:str='')
	(struct stageSize = STAGE_SIZE())
	(var widthCoef:number = "1920 / stageSize.width")
	(var heightCoef:number = "1080 / stageSize.height")
	(var scaleCoef:number = "max(widthCoef, heightCoef)")
	(var imageEntity:dhEntity = "getPrimaryEntity(CC.externalImage, _image)")
	(var imageUrl:str = "imageEntity.externalImage.isLoaded	? 'img://embedded:byteImage?url=' + imageEntity.externalImage.url
															: ''" (event "imageEntity.externalImage.evIsLoadedChanged"))
	

	(var scaleFactor:number = 1.25)
	(var isSmallResolution:bool = "scaleCoef >= scaleFactor")
)

(def element ModalWindowPromoscreen (data:dict)
	(macro MODAL_WINDOW_INIT)
	(macro MODAL_WINDOW_BG)
	(scope
		(macro MOUSE_HANDLER_SCOPE)
		(var splashButtonStatusEntity:dhEntity = "getSingleEntity(CC.splashButtonStatus)")
		(var isSplashButtonEnabled:bool = "splashButtonStatusEntity.splashButtonStatus.enabled" (event "splashButtonStatusEntity.splashButtonStatus.evChanged"))
		(var reasonText:str = "splashButtonStatusEntity.splashButtonStatus.reason" (event "splashButtonStatusEntity.splashButtonStatus.evChanged"))
		(var buttonReasonData:dict = "{enabled: isSplashButtonEnabled, reason: reasonText ?: ''}")
































		(var rendererPromoScreen:array = "[	'PromoscreenTemplate0',
											'PromoscreenTemplate1',
											'PromoscreenTemplate2',
											'PromoscreenTemplate3']")
	)

	(name = 'window_ModalWindowPromoScreen')

	
	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
		(class $FullsizeAbsolute)

		(controller $Instance
			(bind renderer "rendererPromoScreen[data.template_id]")
			(args
				_data = "data.content"
				_buttonReasonData = "buttonReasonData"
			)
		)

		







	)

	
	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
		(style
			(position = "absolute")
			(align = "right")
			(width = 100%)
			(paddingRight = { 1280:20px, 1920:46px })
			(paddingLeft = { 1280:20px, 1920:46px })
			(paddingTop = { 720:20px, 2160:100px })
		)

		(block
			(controller $Instance renderer='ModalWindowCloseIcon'
				(bind enabled "!data.is_escape_blocked")
				(args
					_name = 'escButtonPromoScreen'
				)
			)
		)

		(block
			(bind visible "data.is_escape_blocked")
			(style
				(align = "center|middle")
				(width = 40px)
				(height = 40px)
				(backgroundColor = "NO_COLOR")
			)

			(block
				(element CloseButton
					_name = 'btn_close_promo'
					_isGUIEventLocked = false
				)
			)
		)
	)
)

(def element PromoscreenTemplate0 (_data:dict, _buttonReasonData:dict)
	(macro DEFAULT_MODAL_WINDOW_SCOPE_EVENTS)
	(scope
		(struct promoscreen = PROMOSCREEN_TEMPLATE(_image="_data.image"))
	)
	(name = 'promoScreenTemplate0')
	(class $Fullsize)
	(style (align = "center|bottom"))

	(block
		(name = 'promoScreenBackgroundImage0')
		(class $FullsizeAbsolute)
		(style
			(backgroundSize = "cover")
			(bind backgroundImage "promoscreen.imageUrl")
		)
	)

	 
	(block
		(style
			(align = "center")
			(width = 600px)
			(paddingBottom = "{ 720:MS, 1080:LS }")
		)

		
		(tf
			(name = 'promoScreenHeaderZeroTemplate')
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
			(bind visible "_data.title")
			(bind class "promoscreen.isSmallResolution ? '$TextDefaultBold24NM' : '$TextDefaultBold30NM'")
			(style
				(width = 100%)
				(alpha = "TA")
				(textAlign = "center")
			)
			(bind text "toUpper(tr(_data.title))")
		)

		
		(tf
			(name = 'promoScreenDescriptionZeroTemplate')
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
			(bind visible "_data.description")
			(style
				(width = 100%)
				(marginTop = "L")
				(alpha = "TC")
				(textAlign = "center")
			)
			(bind class "promoscreen.isSmallResolution ? '$TextDefault18NM' : '$TextDefault20NM'")
			(bind text "_data.description")
		)

		
		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
			(style (marginTop = "{ 720:L, 1080:LS }"))
			(element PromoscreenButtonSet
				_data = "_data.button_set"
				_buttonReasonData = "_buttonReasonData"
			)
		)
	)
)

(def element PromoscreenTemplate1 (_data:dict, _buttonReasonData:dict)
	(macro DEFAULT_MODAL_WINDOW_SCOPE_EVENTS)
	(scope
		(struct promoscreen = PROMOSCREEN_TEMPLATE(_image="_data.image"))
	)
	(name = 'promoScreenTemplate1')
	(class $Fullsize)
	(style (align = "center|middle"))

	(block
		(style
			(marginTop = "-L")
			(bind width "promoscreen.isSmallResolution ? 950px : 1200px")
		)

		
		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
			(style (width = 100%))
			(element PromoscreenHeader
				_isSmallResolution = "promoscreen.isSmallResolution"
				_header = "_data.header_text_1"
				_subHeader = "_data.header_text_2"
			)
		)

		
		(block
			(name = 'promoScreenBackgroundImage1')
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
			(style
				(backgroundSize = "cover")
				(bind width "promoscreen.isSmallResolution ? 950px : 1200px")
				(bind height "promoscreen.isSmallResolution ? 355px : 450px")
				(bind marginTop "promoscreen.isSmallResolution ? L : LS")
				(bind backgroundImage "promoscreen.imageUrl")
			)
		)

		(block
			(style
				(width = 100%)
				(bind marginTop "promoscreen.isSmallResolution ? L : LS")
			)

			
			(block
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
				(style (width = 100%))
				(controller $Instance renderer='PromoscreenTimer'
					(bind enabled "_data.date_start == null && _data.date_end != null")
					(args
						_data = "_data"
					)
				)
			)

			
			(block
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
				(style (width = 100%))
				(controller $Instance renderer='PromoscreenTimeRange'
					(bind enabled "_data.date_start && _data.date_end")
					(args
						_isSmallResolution = "promoscreen.isSmallResolution"
						_data = "_data"
					)
				)
			)

			
			(block
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 4)
				(style
					(width = 100%)
					(bind marginTop "	!toBool(_data.date_end)		? 0px :
										promoscreen.isSmallResolution	? M
																	: MS")
				)
				(element PromoscreenDescr
					_isSmallResolution = "promoscreen.isSmallResolution"
					_descrText = "_data.description"
				)
			)
			
			(block
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 5)
				(style (bind marginTop "promoscreen.isSmallResolution ? LS : LM"))
				(element PromoscreenButtonSet
					_data = "_data.button_set"
					_buttonReasonData = "_buttonReasonData"
				)
			)
		)
	)
)

(def element PromoscreenTemplate2 (_data:dict, _buttonReasonData:dict)
	(macro DEFAULT_MODAL_WINDOW_SCOPE_EVENTS)
	(scope
		(struct promoscreen = PROMOSCREEN_TEMPLATE(_image="_data.image"))
	)
	(name = 'promoScreenTemplate2')
	(class $Fullsize)
	(style (align = "center|middle"))

	(hblock
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
		(style (marginTop = "-L"))

		
		(block
			(name = 'promoScreenBackgroundImage2')
			(style
				(backgroundSize = "cover")
				(bind width "promoscreen.isSmallResolution ? 420px : 500px")
				(bind height "promoscreen.isSmallResolution ? 560px : 665px")
				(bind backgroundImage "promoscreen.imageUrl")
			)
		)

		(block
			(style
				(marginTop = 20%)
				(bind width "promoscreen.isSmallResolution ? 500px : 600px")
				(bind marginLeft "promoscreen.isSmallResolution ? LM : XL")
			)

			
			(block
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
				(style (width = 100%))
				(element PromoscreenHeader
					_isSmallResolution = "promoscreen.isSmallResolution"
					_header = "_data.header_text_1"
					_subHeader = "_data.header_text_2"
				)
			)
			(block
				(style
					(width = 100%)
					(bind marginTop "promoscreen.isSmallResolution ? LM : XL")
				)
				(block
					(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
					(style (width = 100%))
					(controller $Instance renderer='PromoscreenTimer'
						(bind enabled "_data.date_start == null && _data.date_end")
						(args
							_data = "_data"
						)
					)
				)

				
				(block
					(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
					(style (width = 100%))
					(controller $Instance renderer='PromoscreenTimeRange'
						(bind enabled "_data.date_start && _data.date_end")
						(args
							_isSmallResolution = "promoscreen.isSmallResolution"
							_data = "_data"
						)
					)
				)

				
				(block
					(macro DEFAULT_MODAL_WINDOW_ANIMATION 4)
					(style
						(width = 100%)
						(bind marginTop "	_data.date_end == null		? 0px :
											promoscreen.isSmallResolution	? M
																		: MS")
					)
					(element PromoscreenDescr
						_isSmallResolution = "promoscreen.isSmallResolution"
						_descrText = "_data.description"
					)
				)

				
				(block
					(macro DEFAULT_MODAL_WINDOW_ANIMATION 5)
					(style (bind marginTop "promoscreen.isSmallResolution ? XL : XLL"))
					(element PromoscreenButtonSet
						_data = "_data.button_set"
						_buttonReasonData = "_buttonReasonData"
					)
				)
			)
		)
	)
)

(def element PromoscreenTemplate3 (_data:dict, _buttonReasonData:dict)
	(macro DEFAULT_MODAL_WINDOW_SCOPE_EVENTS)
	(scope
		(macro MOUSE_HANDLER_SCOPE)
		(struct promoscreen = PROMOSCREEN_TEMPLATE(_image="_data.image"))
		(var state:number = "	rollOver	? SC.Ui_styles.BUTTON_STATE.OVER :
								mouseDown	? SC.Ui_styles.BUTTON_STATE.DOWN
											: SC.Ui_styles.BUTTON_STATE.UP")

		(var imageTintAlpha:number = "PROMOSCREEN3_IMAGE_TINT_ALPHA[state]")
	)
	(name = 'promoScreenTemplate3')
	(class $Fullsize)
	(style (align = "center|middle"))

	(block
		(style (bind width "promoscreen.isSmallResolution ? 650px : 800px"))

		
		(block
			(name = 'promoScreenBackgroundImage3')
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
			(style
				(width = 100%)
				(backgroundSize = "cover")
				(bind width "promoscreen.isSmallResolution ? 650px : 800px")
				(bind height "promoscreen.isSmallResolution ? 365px : 450px")
				(bind backgroundImage "promoscreen.imageUrl")
			)
			(bindcall externalCall 'sound.playSetSoundDirect' "['window', 'open_muted']" watch=false on='leftClick')
			(bindcall externalCall "_data.imageUrl ? 'inputMapping.onAction' : ''" "['navigateTo', {route: SC.Ui_windows.ROUTE.ARMORY, _data: {url: _data.imageUrl, isPrmp: true, authorization: ''}}]" watch=false on='leftClick')
			(bindcall externalCall "_data.imageUrl ? 'inputMapping.onAction' : ''" "['setPromoViewed', {clickedButtonType: 'image'}]" watch=false on='leftClick')

			(block
				(bind visible "_data.imageUrl")
				(class $FullsizeAbsolute)
				(macro MOUSE_EVENTS_DISPATCHER)
				(style
					(backgroundImage = 'url:../service_kit/panel_backgrounds/hint_panel.png')
					(scale9grid = 3)
					(alpha = "imageTintAlpha")
				)

				(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
					_trigger	= "state"
					_alpha		= "imageTintAlpha"
				)
			)
		)

		
		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
			(style
				(width = 100%)
				(bind marginTop "promoscreen.isSmallResolution ? MS : L")
			)

			(element PromoscreenHeader
				_isSmallResolution = "promoscreen.isSmallResolution"
				_header = "_data.header_text_1"
				_subHeader = "_data.header_text_2"
			)
		)

		(block
			(style
				(width = 100%)
				(bind marginTop "promoscreen.isSmallResolution ? L : LS")
			)

			
			(block
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
				(style (width = 100%))
				(controller $Instance renderer='PromoscreenTimer'
					(bind enabled "_data.date_start == null && _data.date_end")
					(args
						_data = "_data"
					)
				)
			)

			
			(block
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
				(style (width = 100%))
				(controller $Instance renderer='PromoscreenTimeRange'
					(bind enabled "_data.date_start && _data.date_end")
					(args
						_isSmallResolution = "promoscreen.isSmallResolution"
						_data = "_data"
					)
				)
			)

			
			(block
				(style
					(width = 100%)
					(bind marginTop "	_data.date_end == null		? 0px :
										promoscreen.isSmallResolution	? M
																	: MS")
				)
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 4)
				(element PromoscreenDescr
					_isSmallResolution = "promoscreen.isSmallResolution"
					_descrText = "_data.description"
				)
			)

			
			(block
				(style (bind marginTop "promoscreen.isSmallResolution ? LM : XL"))
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 5)
				(element PromoscreenButtonSet
					_data = "_data.button_set"
					_buttonReasonData = "_buttonReasonData"
				)
			)
		)
	)
)

(def element PromoscreenHeader (_header:str, _subHeader:str='', _isSmallResolution:bool=false)
	(style (width = 100%))

	(tf
		(name = 'promoScreenHeader')
		(bind class "_isSmallResolution ? '$TextDefaultBold30NM' : '$TextDefaultBold40NM'")
		(style
			(width = 100%)
			(alpha = "TA")
		)
		(bind text "toUpper(tr(_header))")
	)

	(tf
		(name = 'promoScreenSecondHeader')
		(bind visible "_subHeader")
		(bind class "_isSmallResolution ? '$TextDefault22NM' : '$TextDefault26NM'")
		(style
			(width = 100%)
			(alpha = "TA")
			(bind marginTop "_isSmallResolution ? '14px' : '20px'")
		)
		(bind text "_subHeader")
	)
)

(def element PromoscreenTimer (_data:dict = null)
	(scope
		(struct serverTime = SERVER_TIME())
		(struct formattedTimeLeft = COUNTDOWN(_time = "_data.date_end" _serverTime = "serverTime.value" _format = 'HIGHEST,WITH_DAYS'))
	)
	(style (flow = "horizontal"))

	(element StatusLine
		_unifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.DATE_ATTENTION"
		_text = "formattedTimeLeft.value"
		_textClass = '$TextDefaultBold20NM'
	)
)

(def element PromoscreenTimeRange (_data:dict, _isSmallResolution:bool=false)
	(style (flow = "horizontal"))

	(tf
		(bind class "_isSmallResolution ? '$TextDefaultBold20NM' : '$TextDefaultBold24NM'")
		(style (alpha = "TA"))
		(bind text "tr(formatTime(_data.date_start, 'dd.MM', '', false) + ' â€” ')")
	)

	(tf
		(bind class "_isSmallResolution ? '$TextDefaultBold20NM' : '$TextDefaultBold24NM'")
		(style (alpha = "TA"))
		(bind text "formatTime(_data.date_end, 'dd.MM', '', false)")
	)
)

(def element PromoscreenDescr (_descrText:str, _isSmallResolution:bool=false)
	(style (width = 100%))
	(tf
		(name = 'promoScreenDescription')
		(style
			(width = 100%)
			(alpha = "TC")
		)
		(bind class "_isSmallResolution ? '$TextDefault18NM' : '$TextDefault20NM'")
		(bind text "_descrText")
	)
)

(def element PromoscreenButtonSet (_data:dict, _buttonReasonData:dict)
	(scope
		(var PROMOSCREEN_BUTTON_TYPES:dict = "{SEE_MORE: 'see_more', INGAME: 'ingame', BUY: 'buy'}")
		(var hasSeeMoreButton:bool = "PROMOSCREEN_BUTTON_TYPES.SEE_MORE in _data")
		(var hasIngameButton:bool = "PROMOSCREEN_BUTTON_TYPES.INGAME in _data")
		(var hasBuyButton:bool = "PROMOSCREEN_BUTTON_TYPES.BUY in _data")
	)
	(style
		(flow = "horizontal")
		(hgap = "MS")
	)

	
	(block
		(bind visible "hasSeeMoreButton")
		(controller $Instance
			(renderer = 'DefaultButton')
			(bind enabled "hasSeeMoreButton")
			(args
				_width = 200px
				_name = 'btn_promo_1'
				_isTransactionBtn = true
				_methods = "[	{	type: 'inputMapping.onAction',
									name: 'setPromoViewed',
									args: { clickedButtonType: PROMOSCREEN_BUTTON_TYPES.SEE_MORE }},
								{	type: 'inputMapping.onRequest',
									name: 'gotoUrlByPRMP',
									args: { url: _data.see_more.link, isIngameUrl: _data.see_more.ingame, authorization: '' }}]"
				_label = "_data.see_more.text"
				_focusIndex = 1
				_isExternal = "!_data.see_more.ingame"
			)
		)
	)

	
	(block
		(bind visible "hasIngameButton")
		(controller $Tooltip
			(bind renderer "'SimpleStatusTooltip'")
			(args
				_text = "tr(_buttonReasonData.reason)"
				_unifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.WARNING"
			)
			(bind enabled "hasIngameButton && _buttonReasonData.reason")
			(macro DEFAULT_TOOLTIP_BEHAVIOUR)
		)

		(controller $Instance
			(renderer = 'DefaultButton')
			(bind enabled "hasIngameButton")
			(args
				_width = 200px
				_enabled = "_buttonReasonData.enabled"
				_name = 'btn_promo_2'
				_isTransactionBtn = true
				_methods = "[	{	type: 'inputMapping.onAction',
									name: 'setPromoViewed',
									args: { clickedButtonType: PROMOSCREEN_BUTTON_TYPES.INGAME }},
								{	type: 'inputMapping.onRequest',
									name: 'navigateFromWeb',
									args: { route: _data.ingame.route }}]"
				_label = "_data.ingame.text"
				_focusIndex = 2
				_isExternal = "!_data.ingame.ingame"
			)
		)
	)

	
	(block
		(bind visible "hasBuyButton")
		(controller $Instance
			(bind renderer 'DefaultButton')
			(bind enabled "hasBuyButton")
			(args
				_width = 200px
				_type = "SC.Ui_styles.BUTTON_TYPE.ACCENT"
				_focusIndex = 0
				_defaultFocused = true
				_name = 'btn_promo_3'
				_methods = "[	{	type: 'inputMapping.onAction',
									name: 'setPromoViewed',
									args: { clickedButtonType: PROMOSCREEN_BUTTON_TYPES.BUY }},
								{	type: 'inputMapping.onRequest',
									name: 'gotoUrlByPRMP',
									args: { url: _data.buy.link, isIngameUrl: _data.buy.ingame, authorization: '' }}]"
				_label = "_data.buy.text"
				_isExternal = "!_data.buy.ingame"
			)
		)
	)
)
