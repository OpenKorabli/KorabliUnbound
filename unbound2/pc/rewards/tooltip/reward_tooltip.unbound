(def element RewardShipContainerTooltipItem (_rewardItem:dict)
	(scope
		(var rentDuration:number = "'rentDuration' in _rewardItem.params ? _rewardItem.params.rentDuration : null")
		(var rentUntil:number = "'rentUntil' in _rewardItem.params ? _rewardItem.params.rentUntil : null")
		(var isRentShip:bool = "rentDuration || rentUntil")
	)
	(style (width = 100%) (flow = "horizontal") (align = "middle"))

	(element RewardShip
		_rewardItem =	"_rewardItem"
		_isRentHidden =	"isRentShip"
	)
)

(def element RewardCrewContainerTooltipItem (_rewardItem:dict)
	(scope
		(var shipId:number = "toNumber(_rewardItem.params.specializationID)")
		(var crewNation:str = "_rewardItem.params.nation")
		(var isEmptyCrew:bool = "crewNation == SC.Common.NATION.COMMON")
		(var isCrewSpecialization:bool = "shipId > 0")
		(var isCrewNationSpecialization:bool = "!isCrewSpecialization && !isEmptyCrew")
	)
	(style (width = 100%) (minHeight = 74px) (flow = "horizontal") (align = "middle"))

	(block
		(style (height = 100%) (align = "top") (marginRight = "M"))
		(element CrewStereotype
			_crewHistoryId = "_rewardItem.params.primaryKey"
			_size = "SC.Ui_styles.SIZE.SMALL"
		)
	)
	(block
		(style (width = 100%))

		(element CrewNameWithIcon
			_crewHistoryId = "_rewardItem.params.primaryKey"
		)

		(block
			(style (width = 100%) (bind marginTop "isCrewSpecialization ? SXS : XXS"))
			(controller $Instance renderer='ShipLineItemNM'
				(bind enabled "isCrewSpecialization")
				(args
					_shipId = "shipId"
					_withFlag = "true"
				)
			)
			(controller $Instance renderer='NationFlagsTiny'
				(bind enabled "isCrewNationSpecialization")
				(args
					_shipCountry = "crewNation"
				)
			)
		)
	)
)

(def element RewardCampaignStarTooltip (_rewardItem:dict)
	(style (width = 340px))
	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element RewardCampaignStarTooltipItem
			_rewardItem = "_rewardItem"
		)
	)
)


(def element RewardResourcesTooltip (_rewardItem:dict)
	(scope
		(var isAmountVisible:bool = "(_rewardItem.type == SC.Common.REWARD_TYPE.ABILITY || _rewardItem.subtype == SC.Common.REWARD_SUBTYPE.SLOTS) && !_rewardItem.isPRMP")
	)
	(style (width = 340px))
	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER

		(block
			(style (width = 100%) (paddingTop = "-S") (paddingBottom = "-S"))
			
			(element RewardContainerTooltipItem
				_reward = "_rewardItem"
			)
		)

		(block
			(style (width = 100%))
			(controller $Instance renderer='TooltipSystemHorizontalDivider' (bind enabled "isAmountVisible"))
		)
		(block
			(style (width = 100%))
			(controller $Instance renderer='TooltipSystemDescriptionText'
				(bind enabled "isAmountVisible")
				(args
					_descriptionText = "subst('IDS_REWARD_EARNED_COLON', [], {_count: toString(_rewardItem.amount)})"
				)
			)
		)
	)
)

(def element RewardResourcesCommonTooltip (_rewardItem:dict)
	(scope
		(var isLootbox:bool = "_rewardItem.type == SC.Common.REWARD_TYPE.LOOTBOX")
		(var isResource:bool = "_rewardItem.type == SC.Common.REWARD_TYPE.RESOURCE")
		(var isEventumReward:bool = "_rewardItem.subtype in SC.Common.CURRENCIES.IS_EVENT_CURRENCY")
		(var isLootboxPremium:bool = "_rewardItem.params.isPremium")
		(var lootboxType:str = "isLootbox	? isLootboxPremium	? 'IDS_LOOTBOX_PREMIUM_PARAMETERIZED'
																: 'IDS_LOOTBOX_PARAMETERIZED'
											: ''")
		(var imageUrl:str = "'url:../reward_icons/' + _rewardItem.subtype + '.png'")
		(var headerText:str = "!isLootbox	? 'IDS_REWARD_' + toUpper(_rewardItem.subtype) + '_TITLE'
											: toUpper(_rewardItem.subtype) == 'PCL005_EPIC'	? 'IDS_REWARD_LOOTBOX_PCL005_EPIC_TITLE'
																							: subst(lootboxType, [], {_lootboxName: tr('IDS_REWARD_LOOTBOX_' + _rewardItem.subtype + '_TITLE_QUOTES')})")
		(var subheaderText:str = "	isLootbox						? 'IDS_LOOTBOX' :
		 							isEventumReward && isResource	? 'IDS_CURRENCY_EVENTUM_SUBTYPE' :
		 							!isEventumReward && isResource	? 'IDS_CURRENCY_SUBTYPE'
		 															: ''")
		(var isPriceTagVisible:bool = "_rewardItem.subtype != SC.Common.REWARD_SUBTYPE.SLOTS")
		(var priceInfo:dict = "{ currency: _rewardItem.subtype, finalPrice: _rewardItem.amount }")
	)
	(style (width = 340px))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderWithIconAndText
			_imageUrl = "imageUrl"
			_imageWidth = 80px
			_imageHeight = 80px
			_headerText = "headerText"
			_subheaderText = "subheaderText"
		)
		(element TooltipSystemHorizontalDivider)

		(block
			(style (width = 100%))
			(controller $Instance renderer='TooltipSystemPriceTagLine'
				(bind enabled "isPriceTagVisible")
				(args
					_title = 'IDS_COUNT'
					_priceInfo = "priceInfo"
					_isAutoWidth = true
				)
			)
			(controller $Instance renderer='TooltipSystemCounterLine'
				(bind enabled "!isPriceTagVisible")
				(args
					_title = 'IDS_COUNT'
					_count = "_rewardItem.amount"
					_isAutoWidth = true
				)
			)
		)
	)
)

(def element RewardResourceCoeffTooltip (_rewardItem:dict)
	(scope
		(var imageUrl:str = "'url:../reward_icons/' + _rewardItem.subtype + '.png'")
		(var isResMulCoeffPositive:bool = "_rewardItem.amount > 0")
		(var resMulCoeff:str = "(isResMulCoeffPositive ? '+' : '') + toString(_rewardItem.amount)")
		(var resMulCategory:str = "isResMulCoeffPositive ? 'positive' : 'negative'")
		(var headerText:str = "subst('IDS_REWARD_' + _rewardItem.subtype + '_TITLE', [], {_coeff: resMulCoeff})")
		(var attributeIDS:str = "	_rewardItem.subtype == SC.Common.REWARD_SUBTYPE.CREWPOINTSCOEFF	? 'IDS_PARAMS_MODIFIER_CREWEXPFACTOR' :
									_rewardItem.subtype == SC.Common.REWARD_SUBTYPE.FREEXPCOEFF		? 'IDS_PARAMS_MODIFIER_FREEEXPFACTOR' :
									_rewardItem.subtype == SC.Common.REWARD_SUBTYPE.CREDITSCOEFF	? 'IDS_PARAMS_MODIFIER_CREDITSFACTOR'
																									: 'IDS_PARAMS_MODIFIER_SHIPEXPFACTOR'")
		(var attributesPositive:array = "[	{	attributeIDS: attributeIDS,
												measuredValue: resMulCoeff,
												measure: 'IDS_PERCENT',
												category: resMulCategory
											}]")
	)
	(style (width = 340px))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)
	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderWithIconAndText
			_imageUrl = "imageUrl"
			_imageWidth = 80px
			_imageHeight = 80px
			_headerText = "headerText"
		)
		(element TooltipSystemHorizontalDivider)

		(element TooltipSystemParamsModifiersList _attributesPositive="attributesPositive")
	)
)

(def element RewardResourceShipCrewFreeXpCoeffTooltip (_rewardItem:dict)
	(scope
		(var imageUrl:str = "'url:../reward_icons/' + _rewardItem.subtype + '.png'")
		(var isResMulCoeffPositive:bool = "_rewardItem.amount > 0")
		(var resMulCoeff:str = "(isResMulCoeffPositive ? '+' : '') + toString(_rewardItem.amount)")
		(var resMulCategory:str = "isResMulCoeffPositive ? 'positive' : 'negative'")
		(var headerText:str = "subst('IDS_REWARD_' + _rewardItem.subtype + '_TITLE', [], {_coeff: resMulCoeff})")

		(var attributesPositive:array = "[	{	attributeIDS: 'IDS_PARAMS_MODIFIER_SHIPEXPFACTOR',
												measuredValue: resMulCoeff,
												measure: 'IDS_PERCENT',
												category: resMulCategory},
											{	attributeIDS: 'IDS_PARAMS_MODIFIER_CREWEXPFACTOR',
												measuredValue: resMulCoeff,
												measure: 'IDS_PERCENT',
												category: resMulCategory},
											{	attributeIDS: 'IDS_PARAMS_MODIFIER_FREEEXPFACTOR',
												measuredValue: resMulCoeff,
												measure: 'IDS_PERCENT',
												category: resMulCategory}]")
	)
	(style (width = 340px))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)
	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderWithIconAndText
			_imageUrl = "imageUrl"
			_imageWidth = 80
			_imageHeight = 80
			_headerText = "headerText"
		)
		(element TooltipSystemHorizontalDivider)

		(element TooltipSystemParamsModifiersList _attributesPositive="attributesPositive")
	)
)

(def element RewardResourcesPremiumTooltip (_rewardItem:dict)
	(scope
		(struct rewardSubtype = CORRECT_REWARD_RESOURCE_SUBNAME(_subtype = "_rewardItem.subtype"))
		(var imageUrl:str = "'url:../reward_icons/' + rewardSubtype.value + '.png'")
		(var headerText:str = "'IDS_REWARD_' + toUpper(rewardSubtype.value) + '_TITLE'")
		(var statusText:str = "subst('IDS_SUBST_REWARD_PREM_DAYS',[], {_days: _rewardItem.params.text})")
	)
	(style (width = 340px))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER

		(element TooltipSystemHeaderWithIconAndText
			_imageUrl = "imageUrl"
			_imageWidth = 80
			_imageHeight = 80
			_headerText = "headerText"
			_subheaderText = 'IDS_CURRENCY_SUBTYPE'
		)
		(element TooltipSystemHorizontalDivider)

		(element TooltipSystemStatusLine
			_text = "statusText"
		)
	)
)

(def element RewardLootboxTooltip (_rewardItem:dict)
	(scope
		(var isLootboxPremium:bool = "_rewardItem.params.isPremium")
		(var imageUrl:str = "'url:../reward_icons/' + _rewardItem.subtype + '.png'")
		(var headerText:str = "'IDS_REWARD_LOOTBOX_' + toUpper(_rewardItem.subtype) + '_TITLE'")
		(var subheaderText:str = "isLootboxPremium	? 'IDS_LOOTBOX_PREMIUM'
													: 'IDS_LOOTBOX'")
	)
	(style (width = 340px))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(block
			(style (width = "100%") (paddingTop = "-S") (paddingBottom = "-S"))
			
			(element TooltipSystemHeaderWithIconAndText
				_imageUrl = "imageUrl"
				_imageWidth = 80px
				_imageHeight = 80px
				_headerText = "headerText"
				_subheaderText = "subheaderText"
			)
		)
		(element TooltipSystemHorizontalDivider)

		(element TooltipSystemCounterLine
			_title = 'IDS_COUNT'
			_count = "_rewardItem.amount"
			_isAutoWidth = true
		)
	)
)


(def element RewardModernizationTooltip (_rewardItem:dict)
	(scope
		(var descriptionText:str = "tr('IDS_DESC_' + toUpper(_rewardItem.params.item.description))")
		(var isDescriptionVisible:bool = "descriptionText != ' '")
		(var amountText:str = "subst('IDS_REWARD_EARNED_MODERNIZATION', [], {_count: toString(_rewardItem.amount)})")
	)
	(style (width = 340px))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		
		(element RewardContainerTooltipItem
			_reward = "_rewardItem"
			(style (marginTop = 6px) (marginBottom = 9px) (marginLeft = 12px) (marginRight = 12px))
		)

		
		(block
			(bind visible "!_rewardItem.isPRMP")
			(style (width = 100%))
			(element TooltipSystemHorizontalDivider)

			(tf
				(class $InfoBlockIndent)
				(class $TextDefault)
				(bind text "amountText")
			)
		)

		
		(block
			(bind visible "isDescriptionVisible")
			(style (width = 100%))
			(element TooltipSystemHorizontalDivider)

			(tf
				(class $InfoBlockIndent)
				(class $TextDefault)
				(bind text "descriptionText")
			)
		)
	)
)

(def element RewardCollectionTooltip (_rewardItem:dict)
	(style (width = 340px))
	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)
	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element RewardCollectionCardTooltipItem
			_rewardItem = "_rewardItem"
			_isAmountVisible = false
		)
		(element TooltipSystemHorizontalDivider)

		(element TooltipSystemCounterLine
			_title = 'IDS_COUNT'
			_count = "_rewardItem.amount"
			_isAutoWidth = true
		)
	)
)

(def element RewardUnlockTooltip (_rewardItem:dict)
	(scope
		(var rewardNation:str =			"_rewardItem.params.nation")
		(var rewardshipClasses:array =	"_rewardItem.params.shipClasses")
		(var crewFirstNameIDS:str =		"_rewardItem.params.firstNameIDS")
	)
	(style (width = 340px))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		
		(element RewardContainerTooltipItem _reward = "_rewardItem"
			(style (marginTop = 12px) (marginLeft = 12px))
		)
	)
)


(def element RewardUnitTooltip (_rewardItem:dict)
	(scope
		(var iconPath:str = "	_rewardItem.params.item.uiState			?	'url:../modules/icon_module' + _rewardItem.params.item.type + _rewardItem.params.item.uiState + '.png' :
								_rewardItem.params.item.moduleIconName	?	'url:../modules/event/' + _rewardItem.params.item.type + '/icon_module_' + _rewardItem.params.item.moduleIconName + '.png'
																		:	'url:../modules/icon_module' + _rewardItem.params.item.type + '.png'")
		(var headerText:str = "toUpper('IDS_'+ _rewardItem.params.item.name)")
		(var subheaderText:str = "toUpper('IDS_MODULE_TYPE' + _rewardItem.params.item.type)")
	)
	(style (width = 340px))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderWithIconAndText
			_imageUrl =			"iconPath"
			_imageWidth =		60
			_imageHeight =		60
			_headerText =		"headerText"
			_subheaderText =	"subheaderText"
		)
		

		(block
			(bind visible "!_rewardItem.isPRMP")
			(style (width = 100%))
			(element TooltipSystemHorizontalDivider)

			(element TooltipSystemCounterLine
				_title = "tr('IDS_EARNED') + tr('IDS_COLON')"
				_count = "_rewardItem.amount"
				_isAutoWidth = true
			)
		)
	)
)

(def element RewardShipMaterialTooltip (_rewardItem:dict, _imageUrl:str = '', _headerText:str = '')
	(style (width = 340px))
	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderWithIconAndText
			_imageWidth = 80px
			_imageHeight = 80px
			_imageUrl = "_imageUrl"
			_headerText = "_headerText"
		)
		(element TooltipSystemHorizontalDivider)

		(element TooltipSystemPriceTagLine
			_title = 'IDS_COUNT'
			_priceInfo = "{finalPrice: _rewardItem.amount ?: 0, currency: _rewardItem.type}"
			_isAutoWidth = true
		)
	)
)

(def element RewardContainerTooltip (_rewards:array, _tooltipHeader:str, _isReceived:bool=false)

	(style (width = 340px))
	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderSubheaderText
			_headerText = "_tooltipHeader"
		)

		(element TooltipSystemHorizontalDivider)
		(block
			(style (width = "100%"))
			(controller $Instance renderer='TooltipSystemStatusLine'
				(bind enabled "_isReceived")
				(args
					_text = 'IDS_TOOLTIP_REWARD_TAKEN'
					_unifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.CHECK"
				)
			)
		)

		(block
			(style (width = 100%))
			(controller $Instance renderer='TooltipSystemHorizontalDivider' (bind enabled "_isReceived"))
		)
		(block
			(style (width = "100%") (paddingTop = "-S") (paddingBottom = "-S"))

			(controller $Repeat renderer = 'RewardContainerTooltipItem'
				(bind count "_rewards.length")
				(args
					_reward = "$datahub.getEntity(_rewards[$index]).rewardComponent"
				)
			)
		)
	)
)

(def element RewardDummyTooltip (_rewardItem:dict)
	(style (width = 340px))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderWithIconAndText
			_imageUrl =			"'url:../reward_icons/' + _rewardItem.subtype + '.png'"
			_imageWidth =		80px
			_imageHeight =		80px
			_headerText =		"'IDS_REWARD_' + toUpper(_rewardItem.subtype) + '_TITLE'"
		)

		(element TooltipSystemHorizontalDivider)
		(element TooltipSystemDescriptionText
			_descriptionText = "'IDS_REWARD_' + toUpper(_rewardItem.subtype) + '_DESCRIPTION'"
		)
	)
)
