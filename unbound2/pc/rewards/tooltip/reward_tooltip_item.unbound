(def css $DefaultRewardTooltipItemContainer ()
	(width = 100%)
	(minHeight = 80px)
	(flow = "horizontal")
	(align = "middle")
)

(def css $DefaultRewardInTooltipItem ()
	(width = 80px)
	(height = 100%)
	(align = "top|center")
	(marginRight = "M")
)

(def css $SmallRewardTooltipItemContainer ()
	(width = 100%)
	(minHeight = 60px)
	(flow = "horizontal")
	(align = "middle")
)


(def element RewardContainerTooltipItem (_reward:dict)
	(scope
		(var rewardItem:dict = "_reward	?	{   id:			_reward.id,
												amount:		_reward.amount,
												name:		_reward.name,
												type:		_reward.type,
												subtype:	_reward.subtype,
												params:		_reward.params,
												isPRMP:		true }
										:	null")

		(var selectedRenderRewardItem:str = "_reward.type in REWARD_ELEMENT_BY_TYPE ? REWARD_ELEMENT_BY_TYPE[_reward.type].rewardTooltipItem : ''")
		(var isAvailableForRender:bool = "selectedRenderRewardItem && rewardItem")
	)
	(style
		(width = 100%)
		(paddingTop = "S")
		(paddingBottom = "S")
	)

	(controller $Instance
		(bind renderer "selectedRenderRewardItem")
		(bind enabled "isAvailableForRender")
		(args
			_rewardItem = "rewardItem"
			_withTooltip = false
		)
	)
)

(def element RewardContainerTooltipItemAdapter (_entityId:number)
	(scope
		(var rewardEntity:dhEntity =		"getEntity(_entityId)")
		(var rewardComponent:dhComponent =	"rewardEntity.rewardComponent")

		(var rewardItem:dict = "{	id:			rewardComponent.id,
									amount:		rewardComponent.amount,
									name:		rewardComponent.name,
									type:		rewardComponent.type,
									subtype:	rewardComponent.subtype,
									params:		rewardComponent.params,
									isPRMP:		rewardComponent.isPRMP}")
	)
	(style
		(width = 100%)
		(marginRight = "S")
		(marginTop = "S")
	)

	(element RewardContainerTooltipItem
		_reward = "rewardItem"
	)
)

(def element RewardTooltipItemText (_title:str, _description:str = '', _unifiedStatus:str = "SC.Ui_styles.UNIFIED_STATUS.DEFAULT")
	(macro UNIFIED_STATUS_TO_COLOR_AND_ALPHA "_unifiedStatus" "'textColor'" "'textAlpha'")
	(style (width = 100%))

	(tf
		(class $TextDefaultBold18NM)
		(style
			(width = 100%)
			(leading = -4)
			(bind alpha "textAlpha")
			(bind textColor "textColor")
		)
		(bind text "_title")
	)

	(tf
		(bind visible "_description")
		(class $TextDefaultNM)
		(style
			(width = 100%)
			(marginTop = "S")
			(leading = -2)
			(bind alpha "textColor == SC.Ui_styles.SERVICE_COLORS.WHITE ? TC : 1")
			(bind textColor "textColor")
		)
		(bind text "_description")
	)
)




(def element RewardExteriorContainerTooltipItem (_rewardItem:dict)
	(scope
		(var exteriorEntity:dhEntity = "getPrimaryEntity(CC.exteriorConfig, _rewardItem.id)")
		(var exteriorConfig:dhComponent = "exteriorEntity.exteriorConfig")

		(var signalEntity:dhEntity = "getPrimaryEntity(CC.signal, _rewardItem.id)")
		(var ensignEntity:dhEntity = "getPrimaryEntity(CC.ensign, _rewardItem.id)")
		(var ecoBoostEntity:dhEntity = "getPrimaryEntity(CC.ecoBoost, _rewardItem.id)")

		(var shipEntity:dhEntity = "getPrimaryEntity(CC.ship, _rewardItem.params.shipId)")
		(var shipNameIDS:str = "shipEntity ? toUpper(tr(shipEntity.ship.nameIDS)) : ''")

		(var itemName:str = "	exteriorEntity	? toUpper('IDS_' + exteriorConfig.name) :
								signalEntity	? toUpper('IDS_' + signalEntity.signal.name) :
								ensignEntity	? toUpper('IDS_' + ensignEntity.ensign.name) :
								ecoBoostEntity	? _rewardItem.subtype != 'Multiboost'	? toUpper('IDS_' + ecoBoostEntity.ecoBoost.name)
																						: 'IDS_MULTIBOOST_TITLE'
												: ''")

		(var exteriorShipListRestrictions:dhComponent = "exteriorEntity.shipListRestrictions")
		(var ecoBoostShipListRestrictions:dhComponent = "ecoBoostEntity.shipListRestrictions")

		
		(var exteriorLevelFiltersRoman:str ="exteriorShipListRestrictions ? exteriorShipListRestrictions.levelString : ''" (event "exteriorShipListRestrictions.evUpdate"))
		(var doesExteriorHasLevelRestrictions:bool = "exteriorLevelFiltersRoman.length > 0")

		(var ecoboostLevelFiltersRoman:str ="ecoBoostShipListRestrictions ? ecoBoostShipListRestrictions.levelString : ''" (event "ecoBoostShipListRestrictions.evUpdate"))
		(var doesEcoBoostHasLevelRestrictions:bool = "ecoboostLevelFiltersRoman.length > 0")

		(var hasLevelRestrictions:bool = "doesExteriorHasLevelRestrictions || doesEcoBoostHasLevelRestrictions")

		(var signalRarity:number =		"signalEntity	? signalEntity.signal.rarity		: 0")
		(var ecoBoostRarity:number =	"ecoBoostEntity	? ecoBoostEntity.ecoBoost.rarity	: 0")

		(var basicTitleWithShipName:str = "_rewardItem.subtype == SC.Ui_common.REWARD_EXTERIOR_TYPE.MULTIBOOST	? 'IDS_MULTIBOOST_WITH_SHIP_TITLE'
																												: 'IDS_EXTERIOR_NAME_WITH_SHIP'")
		(var basicTitleWithShipLevel:str = "_rewardItem.subtype == SC.Ui_common.REWARD_EXTERIOR_TYPE.MULTIBOOST	? 'IDS_MULTIBOOST_WITH_LEVEL_TITLE'
																												: 'IDS_EXTERIOR_NAME_WITH_LEVEL'")

		(var romanLevel:str = "doesExteriorHasLevelRestrictions	? exteriorLevelFiltersRoman
																: ecoboostLevelFiltersRoman")

		(var title:str = "	_rewardItem.subtype == SC.Ui_common.REWARD_EXTERIOR_TYPE.GLOBALBOOST	? 'IDS_GLOBALBOOST_TITLE' :
							_rewardItem.params.shipId != null										? subst(basicTitleWithShipName, [], {exteriorName: tr(itemName), shipName: shipNameIDS}) :
							hasLevelRestrictions													? subst(basicTitleWithShipLevel, [], {exteriorName: tr(itemName), levelRange: romanLevel})
																									: tr(itemName)")

		(var description:str = "_rewardItem.subtype == SC.Ui_common.REWARD_EXTERIOR_TYPE.FLAGS				? tr('IDS_BATTLE_SIGNAL_RARITY_' + signalRarity) :
								isIn(_rewardItem.subtype, SC.Ui_common.REWARD_EXTERIOR_TYPE.SHIP_PAINT)		? tr('IDS_EXTERIOR_TYPE_' + _rewardItem.subtype) :
								_rewardItem.subtype == SC.Ui_common.REWARD_EXTERIOR_TYPE.ENSIGN				? ensignEntity.ensign.group	? 'IDS_ENSIGN_GROUP_SUBTYPE_' + ensignEntity.ensign.group
																																		: 'IDS_SEASON_ENSIGN' :
								_rewardItem.subtype == SC.Ui_common.REWARD_EXTERIOR_TYPE.CAMOBOOST			? tr('IDS_ECONOMIC_BOOST_TYPE_EXPENDABLE_' + ecoBoostRarity) :
								_rewardItem.subtype == SC.Ui_common.REWARD_EXTERIOR_TYPE.MULTIBOOST ||
								_rewardItem.subtype == SC.Ui_common.REWARD_EXTERIOR_TYPE.GLOBALBOOST		? 'IDS_ECONOMIC_BOOST_TYPE_MULTIBOOST'
																											: itemName + '_DESCRIPTION'")
		(var selectedRenderItem:str = "_rewardItem && _rewardItem.subtype in RENDER_REWARD_EXTERIOR_ITEMS ? RENDER_REWARD_EXTERIOR_ITEMS[_rewardItem.subtype].rewardDefault : ''")
		(var isAvailableForRender:bool = "_rewardItem && selectedRenderItem")
		(var isEcoBoostReward:bool = "'boost' in _rewardItem.subtype")
	)
	(bind class "isEcoBoostReward ? '$DefaultRewardTooltipItemContainer' : '$SmallRewardTooltipItemContainer'")

	(block
		(class $DefaultRewardInTooltipItem)

		(controller $Instance
			(bind enabled "isAvailableForRender")
			(bind renderer "selectedRenderItem")
			(args
				_id = "_rewardItem.id"
				_amount = "_rewardItem.amount"
				_isReward = true
				_params = "_rewardItem.params"
				_withTooltip = false
			)
		)
	)

	(element RewardTooltipItemText
		_title = "title"
		_description = "description"
	)
)


(def element RewardContainerTooltipItemWithSpecialIcon (_rewardItem:dict)
	(scope
		(struct rewardSubtype = CORRECT_REWARD_RESOURCE_SUBNAME(_subtype = "_rewardItem.subtype"))
		(var isEventumReward:bool = "rewardSubtype.value in SC.Common.CURRENCIES.IS_EVENT_CURRENCY")
	)
	(class $DefaultRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element RewardResourceItem
			_rewardItem = "_rewardItem"
			_withTooltip = false
		)
	)

	(element RewardTooltipItemText
		_title = "'IDS_REWARD_' + toUpper(rewardSubtype.value) + '_TITLE'"
		_description = "isEventumReward ? 'IDS_CURRENCY_EVENTUM_SUBTYPE' : 'IDS_CURRENCY_SUBTYPE'"
	)
)


(def element RewardCoeffContainerTooltipItemWithSpecialIcon (_rewardItem:dict)
	(scope
		(struct rewardSubtype = CORRECT_REWARD_RESOURCE_SUBNAME(_subtype = "_rewardItem.subtype"))
		(var isResMulCoeffPositive:bool = "_rewardItem.amount > 0")
		(var resMulCoeff:str = "(isResMulCoeffPositive ? '+' : '') + toString(_rewardItem.amount)")
	)
	(class $DefaultRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element RewardResourceItem
			_rewardItem = "_rewardItem"
			_withTooltip = false
		)
	)

	(element RewardTooltipItemText
		_title = "subst('IDS_REWARD_' + toUpper(rewardSubtype.value) + '_TITLE', [], {_coeff: resMulCoeff})"
		_description = 'IDS_BONUS'
	)
)


(def element RewardModenizationContainerTooltipItem (_rewardItem:dict)
	(class $SmallRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element RewardModernizationItem
			_rewardItem = "_rewardItem"
			_withTooltip = false
		)
	)

	(element RewardTooltipItemText
		_title = "'IDS_TITLE_' + toUpper(_rewardItem.params.item.title)"
		_description = "'IDS_MODERNIZATION_' + SC.Common.UNIFIED_ITEM_RARITY.VALUE_TO_NAME[_rewardItem.params.item.rarity]"
	)
)


(def element RewardCollectionCardTooltipItem (_rewardItem:dict, _isAmountVisible:bool = true)
	(scope
		(var isRandomCollectionItem:bool = "_rewardItem.subtype == SC.Common.REWARD_SUBTYPE.RANDOMCOLLECTIONCARD")
		(var isCollectionCard:bool = "_rewardItem.subtype == SC.Common.REWARD_SUBTYPE.COLLECTIONCARD")
		(var title:str = "isRandomCollectionItem ? 'IDS_COLLECTION_RANDOM_ITEM' : 'IDS_' + _rewardItem.params.item.title")
		(var collectionNameQuotes:str = "tr('IDS_' + _rewardItem.params.collectionName + '_QUOTES')")
		(var description:str = "isRandomCollectionItem || isCollectionCard	? subst('IDS_COLLECTION_NAME', [], { _collectionName: collectionNameQuotes })
																			: 'IDS_ITEM_TYPE_COLLECTION'")
	)
	(class $DefaultRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element RewardCollectionItem
			_rewardItem = "_rewardItem"
			_isAmountVisible = "_isAmountVisible"
		)
	)

	(element RewardTooltipItemText
		_title = "title"
		_description = "description"
	)
)


(def element RewardPersonalExchangeRatesTooltipItem (_rewardItem:dict)
	(class $DefaultRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(block
			(class $DefaultRewardSize)
			(style (bind backgroundImage "'url:../reward_icons/' + _rewardItem.subtype + '.png'"))
		)
	)

	(element RewardTooltipItemText
		_title = "'IDS_PRMP_ITEM_' + toUpper(tr(_rewardItem.subtype))"
	)
)


(def element RewardCampaignStarTooltipItem (_rewardItem:dict)
	(scope
		(var taskEntity:dhEntity =		"getPrimaryEntity(CC.campaignTaskParams, _rewardItem.params.taskId)")
		(var missionEntity:dhEntity =	"getPrimaryEntity(CC.campaignMissionParams, taskEntity.campaignTaskParams.missionID)")
		(var campaignMissionParams:dhComponent = "missionEntity.campaignMissionParams")

		(var campaignEntity:dhEntity =		"getPrimaryEntity(CC.campaignParams, campaignMissionParams.campaignID)")
		(var campaignParams:dhComponent =	"campaignEntity.campaignParams")
		(var campaignNameIDS:str = "'IDS_' + campaignParams.name + '_TITLE'")
		(var subheaderText:str = "tr(subst('IDS_CAMPAIGN_STARS_DESCRIPTION', [], { _campaignName: tr(campaignNameIDS), _missionNumber: campaignMissionParams.uiNumber }))")
	)
	(class $DefaultRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element IconWithAmount
			_width =	80px
			_height =	80px
			_iconPath =	'url:../reward_icons/campaign_star.png'
			_amount =	"_rewardItem.amount"
		)
	)

	(element RewardTooltipItemText
		_title =		'IDS_REWARD_CAMPAIGNSTAR_TITLE'
		_description =	"subheaderText"
	)
)


(def element RewardSseTooltipItem (_rewardItem:dict)
	(class $DefaultRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element RewardCollectionSseItem
			_path = 'url:../reward_icons/sse.png'
		)
	)

	(block
		(style (width = 100%))

		(element RewardTooltipItemText
			_title = "_rewardItem.subtype == SC.Ui_styles.SSE_TYPES.CHALLENGE ? 'IDS_PERSONAL_CHALLENGE' : 'IDS_PERSONAL_BATTLE_TASK'"
			_unifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.CHECK"
		)
	)
)

(def element RewardAchievementTooltipItem (_rewardItem:dict)
	(scope
		(var achievementEntity:dhEntity =	"getPrimaryEntity(CC.achievement, _rewardItem.id)")
		(var achievementInfo:dhComponent =	"achievementEntity.achievementInfo")
		(var typeIDS:str = "achievementInfo ? toUpper('IDS_ACHIEVEMENT_TYPE_' + achievementInfo.uiType) : ''")
	)
	(style (width = 100%))

	(element TooltipSystemHeaderWithIconAndText
		_imageUrl =			"'url:../achievements/icon_achievement_' + achievementInfo.name + '.png'"
		_imageWidth =		80px
		_imageHeight =		80px
		_headerText =		"achievementInfo.nameIDS"
		_headerIconType =	"SC.Ui_styles.TOOLTIP_SYSTEM_HEADER_ICON_TYPE.SIMPLE"
		_subheaderText =	"typeIDS"
	)
)

(def element RewardLootboxTooltipItem (_rewardItem:dict)
	(scope
		(macro FEATURES "21")
		(var isLootboxPremium:bool = "_rewardItem.params.isPremium")
		(var imageUrl:str = "'url:../reward_icons/' + _rewardItem.subtype + '.png'")
		(var amount:number = "_rewardItem.amount ?: 0")
		(var headerText:str = "'IDS_REWARD_LOOTBOX_' + toUpper(_rewardItem.subtype) + '_TITLE_SHORT'")
		(var subheaderText:str = "isLootboxPremium ? 'IDS_LOOTBOX_PREMIUM' : 'IDS_LOOTBOX'")
	)
	(class $DefaultRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element IconWithAmount
			_width = 80px
			_height = 80px
			_iconPath = "imageUrl"
			_amount = "amount"
		)
	)

	(element RewardTooltipItemText
		_title = "headerText"
		_description = "subheaderText"
	)
)

(def element RewardDummyTooltipItem (_rewardItem:dict)
	(style (width = 100%))

	(element TooltipSystemHeaderWithIconAndText
		_imageUrl =			"'url:../reward_icons/' + _rewardItem.subtype + '.png'"
		_imageWidth =		80px
		_imageHeight =		80px
		_headerText =		"'IDS_REWARD_' + toUpper(_rewardItem.subtype) + '_TITLE'"
	)
)

(def element RewardShipComponentTooltipItem (_rewardItem:dict)
	(style
		(width = 100%)
		(align = "middle")
		(flow = "horizontal")
	)

	(element RewardShipComponentItem
		_rewardItem = "_rewardItem"
	)
)

(def element RewardShipMaterialTooltipItem (_rewardItem:dict)
	(scope
		(var shipLevel:number = "_rewardItem.params.shipLevel ?: 0")
		(var iconPath:str = "_rewardItem ? 'url:../reward_icons/' + _rewardItem.type + '_' + shipLevel + '.png' : ''")
		(var title:str = "subst('IDS_CURRENCY_SHIPMATERIAL', [], {_shipLevel: shipLevelsToRoman([shipLevel], true)})")
		(var amount:number = "_rewardItem.amount ?: 0")
	)
	(style
		(width = 100%)
		(align = "middle")
		(flow = "horizontal")
	)
	(block
		(style (marginRight = "M"))
		(element IconWithAmount
			_width = 80px
			_height = 80px
			_iconPath = "iconPath"
			_amount = "amount"
		)
	)
	(element RewardTooltipItemText
		_title = "title"
	)
)

(def element RewardDogTagTooltipItem (_rewardItem:dict, _isClickDisabled:bool = false)
	(scope
		(var dogTagEntity:dhEntity =	"getPrimaryEntity(CC.dogTagComponent, _rewardItem.id)")
		(var gpName:str =				"dogTagEntity.dogTagComponent.gpName" (event "dogTagEntity.dogTagComponent.evUpdate"))
		(var categoryId:number =		"dogTagEntity.dogTagComponent.categoryId" (event "dogTagEntity.dogTagComponent.evUpdate"))

		(var title:str = "tr(toUpper('IDS_DOGTAG_' + gpName + '_NAME'))")
		(var description:str = "tr('IDS_DOGTAG_COMPONENT_TOOLTIP_CATEGORY_' + categoryId)")
	)
	(class $DefaultRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element RewardDogTagItem
			_rewardItem =		"_rewardItem"
			_withTooltip =		false
			_isClickDisabled =	"_isClickDisabled"
		)
	)

	(element RewardTooltipItemText
		_title = "title"
		_description = "description"
	)
)

(def element RewardUnlockTooltipItem (_rewardItem:dict)
	(scope
		(var title:str = "	tr('IDS_REWARD_' + toUpper(tr(_rewardItem.name)) +
							(!_rewardItem.params.nation == ''	? '_' + toUpper(tr(_rewardItem.params.nation))
																: ''))")

		(var description:str = "	tr('IDS_REWARD_' + toUpper(tr(_rewardItem.name)) +
									(!_rewardItem.params.nation == '' 		? '_' + toUpper(tr(_rewardItem.params.nation))
																			: '') +
									(_rewardItem.params.shipClasses.length > 0	? '_' + toUpper(tr(_rewardItem.params.shipClasses[0]))
																				: '')
									+ '_DESCRIPTION')")

	)
	(class $DefaultRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element RewardUnlockItem
			_rewardItem = "_rewardItem"
			_withTooltip = false
		)
	)

	(element RewardTooltipItemText
		_title = "title"
		_description = "description"
	)
)

(def element RewardUnitTooltipItem (_rewardItem:dict)
	(scope
		(var iconPath:str = "	_rewardItem.params.item.uiState			?	'url:../modules/icon_module' + _rewardItem.params.item.type + _rewardItem.params.item.uiState + '.png' :
								_rewardItem.params.item.moduleIconName	?	'url:../modules/event/' + _rewardItem.params.item.type + '/icon_module_' + _rewardItem.params.item.moduleIconName + '.png'
																		:	'url:../modules/icon_module' + _rewardItem.params.item.type + '.png'")

		(var headerText:str = "toUpper('IDS_'+ _rewardItem.params.item.name)")
		(var subheaderText:str = "toUpper('IDS_MODULE_TYPE' + _rewardItem.params.item.type)")
	)
	(class $SmallRewardTooltipItemContainer)

	(block
		(class $DefaultRewardInTooltipItem)

		(element IconWithAmount
			_width =	60px
			_height =	60px
			_iconPath = "iconPath"
			_amount = "_rewardItem.amount"
		)
	)

	(element RewardTooltipItemText
		_title =	"headerText"
		_description = "subheaderText"
	)
)
