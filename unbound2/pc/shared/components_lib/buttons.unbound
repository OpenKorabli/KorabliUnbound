(def constant BUTTON_FOCUS_STATE "{
	UNFOCUSABLE: -1
}")

(def constant TEXT_BUTTON_ALPHA {
	SC.Ui_styles.BUTTON_STATE.DISABLED	: "TS",
	SC.Ui_styles.BUTTON_STATE.SELECTED	: "TC",
	SC.Ui_styles.BUTTON_STATE.DOWN		: "TS",
	SC.Ui_styles.BUTTON_STATE.OVER		: "TA",
	SC.Ui_styles.BUTTON_STATE.UP		: "TC"
})

(def constant IMAGE_BUTTON_ALPHA {
	SC.Ui_styles.BUTTON_STATE.DISABLED	: "TS",
	SC.Ui_styles.BUTTON_STATE.DOWN		: "TS",
	SC.Ui_styles.BUTTON_STATE.OVER		: "TA",
	SC.Ui_styles.BUTTON_STATE.UP		: "TC"
})

(def constant BUTTON_MOUSE_STATE_CT "{
	DEFAULT: 	{	OVER:	{	redMultiplier: 1,	greenMultiplier: 1,	blueMultiplier: 1,	alphaMultiplier: 1,
								redOffset: 15,		greenOffset: 15,	blueOffset: 15,		alphaOffset: 0 },
					DOWN:	{	redMultiplier: 1,	greenMultiplier: 1,	blueMultiplier: 1,	alphaMultiplier: 1,
								redOffset: -15,		greenOffset: -15,	blueOffset: -15,	alphaOffset: 0 },
					UP:		CT_NONE },
	SECONDARY: {	OVER:	{	redMultiplier: 1,	greenMultiplier: 1,	blueMultiplier: 1,	alphaMultiplier: 1.4,
 								redOffset: 0,		greenOffset: 0,		blueOffset: 0,		alphaOffset: 0 },
					DOWN:	{	redMultiplier: 1,	greenMultiplier: 1,	blueMultiplier: 1,	alphaMultiplier: 0.6,
								redOffset: 0,		greenOffset: 0,		blueOffset: 0,		alphaOffset: 0 },
					UP:		CT_NONE }
}")





(def element DefaultButton (_name:str = '',
							_enabled:bool = true,
							_type:str = "SC.Ui_styles.BUTTON_TYPE.DEFAULT",
							_isExternal:bool = false,
							_isDropdown:bool = false,
							_isTransactionBtn:bool = false,
							_icon:str = '',
							_size:number = "SIZE.MEDIUM",
							_width:number = 0,
							_label:str = '',
							_focusIndex:number = "BUTTON_FOCUS_STATE.UNFOCUSABLE",
							_clickInterval:number = 500,
							_defaultFocused:bool = false,
							_dispatchedEv:str = '',
							_dispatchParams:gfx = {},
							_methods:array = [],
							_externalRollover:bool = null,
							_externalMouseDown:bool = null,
							_isGUIEventLocked:bool=false,
							_isIncreasedAccentBtn:bool = false,
							_customSoundSet:str = '')
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(event evOperationsAccountLockedChanged)

		(var accountResourceComponent:dhComponent =	"getSingleComponent(CC.accountResource)")
		(var operationsAccountLocked:bool = "accountResourceComponent.operationsLocked" (event "accountResourceComponent.evOperationsLockChanged"))
		(var isOperationsLocked:bool = "_isTransactionBtn && operationsAccountLocked")
		(var enabled:bool = "_enabled && !isOperationsLocked")

		(var isFocused:bool = false)
		(var isKeyDown:bool = false)

		(var hasMarker:bool = "_isExternal || _isDropdown")

		
		(dispatch evOperationsAccountLockedChanged dir="EventDirection.NONE" delay="0.3" reset=true (bind trigger "operationsAccountLocked"))
		(var showOperationsLock:bool = false)
		(bind showOperationsLock "operationsAccountLocked" init=false watch=false (event "evOperationsAccountLockedChanged"))
		(var isDisabledVisual:bool = "!_enabled || (isOperationsLocked && showOperationsLock)")
		

		(var isDown:bool = "!isDisabledVisual && (_externalMouseDown || mouseDown || isKeyDown)")
		(var isRollover:bool = "!isDisabledVisual && (_externalRollover || rollOver)")

		(var isIconBtn:bool = "_type == SC.Ui_styles.BUTTON_TYPE.ICON || _type == SC.Ui_styles.BUTTON_TYPE.ICON_SECONDARY")
		(var isSecondaryBtn:bool = "_type == SC.Ui_styles.BUTTON_TYPE.SECONDARY || _type == SC.Ui_styles.BUTTON_TYPE.ICON_SECONDARY")
		(var isAutoWidth:bool = "!toBool(_width)")

		(var isFocusEnabled:bool = "_enabled && (_focusIndex != BUTTON_FOCUS_STATE.UNFOCUSABLE) && !isIconBtn")
		
		

		(var focusImage:str = "_type	? 'url:../service_kit/buttons/backgrounds/' + _type + '_focused.png'
										: 'url:../service_kit/buttons/backgrounds/default_focused.png'")

		(var backgroundImage:str = "isDisabledVisual && _type	? 'url:../service_kit/buttons/backgrounds/' + _type + '_disabled.png' :
									_type						? 'url:../service_kit/buttons/backgrounds/' + _type + '.png' :
									isDisabledVisual 			? 'url:../service_kit/buttons/backgrounds/default_disabled.png'
																: 'url:../service_kit/buttons/backgrounds/default.png'")
	
		(var backgroundColorTransform:dict = "	isRollover && !isDown	? isSecondaryBtn	?	BUTTON_MOUSE_STATE_CT.SECONDARY.OVER
																							:	BUTTON_MOUSE_STATE_CT.DEFAULT.OVER :
												isDown					? isSecondaryBtn	?	BUTTON_MOUSE_STATE_CT.SECONDARY.DOWN
																							:	BUTTON_MOUSE_STATE_CT.DEFAULT.DOWN
																		: CT_NONE")

		(var contentAlpha:number = "isDown || isDisabledVisual		? TS :
									isRollover						? 1.1 :
									isSecondaryBtn					? TC
																	: TA")
	)
	(dispatch evClicked dir="EventDirection.NONE" (bind enabled "isKeyDown") (bind trigger "isKeyDown"))

	(bind name "_name ? _name : null")
	
	
	(style
		(bind width "	isIconBtn		? 24px :
						isAutoWidth		? auto
										: _width")

		(bind height "	isIconBtn				? 24px :
						_size == SIZE.LARGE		? 44px :
						_size == SIZE.SMALL		? 24px
												: 32px")

		(backgroundColor = "NO_COLOR")
	)

	(controller $Focus
		tabIndex = "_focusIndex"
		defaultFocus = "_defaultFocused"
		clickFocus = "false"
		clickInterval = "_clickInterval"
		(bind enabled "isFocusEnabled")
		(bind isFocused "$event" init=false on='evFocused')
		(bind isKeyDown "$event && isFocused && enabled" init=false on='evKeyboardClick')
	)

	(block
		(class $FullsizeAbsolute)
		(style
			(hitTest = false)
			(scale9grid = 10)
			(bind backgroundImage "backgroundImage")
		)
		(macro DEFAULT_CONTROL_STATE_ANIMATION_CT
			_colorTransform = "backgroundColorTransform"
			_duration = "0.07"
		)
	)

	(hblock
		(style
			(hitTest = false)
			(align = "middle|center")
			(height = 100%)
			(alpha = "contentAlpha")
			(bind width "isAutoWidth ? auto : 100%")
		)
		(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
			_trigger = "contentAlpha"
			_alpha = "contentAlpha"
		)

		(block
			(macro CONTROL_VISIBLE_STATE_ANIMATION
				_isTrigger = "isFocused && !isDisabledVisual"
				_duration = "0.15"
			)
			(class $FullsizeAbsolute)
			(style
				(scale9grid = 2)
				(bind backgroundImage "focusImage")
			)
		)

		(block
			(bind visible "_label && !isIconBtn")

			(style
				(align = "center|middle")
				(bind width "isAutoWidth ? auto : 100%")
				(bind minWidth "!isAutoWidth	? 0px :
								hasMarker		? 78px
												: 110px")

				(bind paddingLeft "	hasMarker			? 28px :
									_size == SIZE.SMALL	? S
														: SXS")

				(bind paddingRight "hasMarker			? 28px :
									_size == SIZE.SMALL	? S
														: SXS")

				(bind marginTop "_size == SIZE.MEDIUM	? -1px
														: 0px")
			)

			(tf
				(bind visible "_label && !isIconBtn")
				(bind class "	_size == SIZE.LARGE			? _isIncreasedAccentBtn ? '$TextDefaultBold26NM'
																					: '$TextDefaultBold18NM' :
								_size == SIZE.SMALL			? '$TextDefaultBold12NM'
															: '$TextDefaultBoldNM'")

				(style
					(wordWrap = false)
					(bind width "isAutoWidth ? auto : 100%")
					(bind elideMode "!isAutoWidth")
					(bind textAlign "isAutoWidth ? left : center")
				)

				(bind text "_label ? toUpper(tr(_label)) : ''")
			)
		)

		(hblock
			(bind visible "isIconBtn")

			(style
				(height = 24px)
				(width = 24px)
				(bind backgroundImage "isIconBtn ? 'url:../service_kit/buttons/icons/' + _icon + '.png' : ''")
			)
		)

		(block
			(bind visible "!isIconBtn && hasMarker")
			(bind name "_isExternal ? 'externalArrow' : 'dropdownArrow'")

			(class $MiddleVAligned)
			(style
				(position = "absolute")
				(right = "S")
				(height = 14px)
				(width = 14px)
				(bind backgroundImage "_isExternal	? 'swf:../service_kit/buttons/icons_svg/icons_svg.swf:out'
													: 'swf:../service_kit/buttons/icons_svg/icons_svg.swf:down'")
			)
		)
	)

	(macro INPUT
		_btnName = "_name"
		_enabled = "!_isGUIEventLocked"
	)

	(macro MOUSE_HANDLER
		_enabled = "enabled"
		_dispatchedEv = "_dispatchedEv"
		_dispatchParams = "_dispatchParams"
		_methods = "_methods"
		_soundSet = "	_customSoundSet		? _customSoundSet 	:
						_type	 			? 'button_' + _type
											: 'button_default'"
	)
)

(def element ImageButton (	_name:str='', _enabled:bool=true, _mouseDown:bool = false, _width:number=0, _height:number=0, _backgroundImage:str='', _hitAreaMargin:array=[0], _soundSet:str='',
							_dispatchedEv:str='', _dispatchParams:gfx={}, _methods:array=[])
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(var btnWidth:number = "_width ? _width : 50")
		(var btnHeight:number = "_height ? _height : 50")

		(var isDown:bool = "_enabled && (mouseDown || _mouseDown)")
		(var isRollover:bool = "_enabled && rollOver")

		(var state:number = "	!_enabled	? SC.Ui_styles.BUTTON_STATE.DISABLED :
								isDown		? SC.Ui_styles.BUTTON_STATE.DOWN :
								isRollover	? SC.Ui_styles.BUTTON_STATE.OVER
											: SC.Ui_styles.BUTTON_STATE.UP")

		(var contentAlpha:number = "IMAGE_BUTTON_ALPHA[state]")
	)

	(bind name "_name")

	(style
		(alpha = "contentAlpha")
		(backgroundSize = "fill")
		(bind height "btnHeight")
		(bind width "btnWidth")
		(bind backgroundImage "_backgroundImage")
		(bind padding "_hitAreaMargin")
		(macro DESATURATION_DEFAULT "_enabled")
	)
	(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
		_trigger = "contentAlpha"
		_alpha = "contentAlpha"
	)

	(macro INPUT
		_btnName = "_name"
	)

	(macro MOUSE_HANDLER
		_enabled = "_enabled"
		_dispatchedEv = "_dispatchedEv"
		_dispatchParams = "_dispatchParams"
		_methods = "_methods"
		_soundSet = "_soundSet ? _soundSet : 'button_context'"
	)
)

(def constant IMAGE_RADIO_BUTTON_BACKGROUND_ALPHA  "{
	SC.Ui_styles.BUTTON_STATE.UP:					0,
	SC.Ui_styles.BUTTON_STATE.OVER:					0.1,
	SC.Ui_styles.BUTTON_STATE.DOWN:					0.05,
	SC.Ui_styles.BUTTON_STATE.SELECTED:				0.22,
	SC.Ui_styles.BUTTON_STATE.SELECTED_OVER:		0.3,
	SC.Ui_styles.BUTTON_STATE.DISABLED:				0,
	SC.Ui_styles.BUTTON_STATE.SELECTED_DISABLED:	0.045
}")

(def constant IMAGE_RADIO_BUTTON_ICON_ALPHA  "{
	SC.Ui_styles.BUTTON_STATE.UP:					1,
	SC.Ui_styles.BUTTON_STATE.SELECTED:				1,
	SC.Ui_styles.BUTTON_STATE.DISABLED:				0.4,
	SC.Ui_styles.BUTTON_STATE.SELECTED_DISABLED:	0.4
}")

(def element ImageRadioButton (	_statusTooltipData:dict, _name:str='', _enabled:bool=true, _selected:bool=false, _renderElement:str='',
								_renderArgs:dict={}, _soundSet:str='button_context', _dispatchedEv:str='', _dispatchParams:gfx={}, _methods:array=[],
								_size:number = "SIZE.SMALL", _safetyZone:number = "XS")
	(scope
		(struct mouseHandler = MOUSE_HANDLER())

		
		(var backgroundState:number = "	!_enabled && _selected				?	SC.Ui_styles.BUTTON_STATE.SELECTED_DISABLED :
										!_enabled							?	SC.Ui_styles.BUTTON_STATE.DISABLED :
										mouseHandler.mouseDown				?	SC.Ui_styles.BUTTON_STATE.DOWN :
										_selected && mouseHandler.rollOver	?	SC.Ui_styles.BUTTON_STATE.SELECTED_OVER :
										_selected							?	SC.Ui_styles.BUTTON_STATE.SELECTED :
										mouseHandler.rollOver				?	SC.Ui_styles.BUTTON_STATE.OVER
																			:	SC.Ui_styles.BUTTON_STATE.UP ")

		
		(var iconState:number = "	!_enabled && _selected	?	SC.Ui_styles.BUTTON_STATE.SELECTED_DISABLED :
									_selected				?	SC.Ui_styles.BUTTON_STATE.SELECTED :
									_enabled				?	SC.Ui_styles.BUTTON_STATE.UP
															:	SC.Ui_styles.BUTTON_STATE.DISABLED")

		(var buttonBackgroundAlpha:number = "IMAGE_RADIO_BUTTON_BACKGROUND_ALPHA[backgroundState]")
		(var buttonIconAlpha:number = "IMAGE_RADIO_BUTTON_ICON_ALPHA[iconState]")
	)
	(bind name "_name")

	(style
		(align = "center|middle")
		(backgroundColor = "NO_COLOR")
		(bind height "_size == SIZE.SMALL ? 27px : 32px")
		(bind width "_size == SIZE.SMALL ? 39px : 48px")
		(macro DESATURATION_SMALL "_enabled")
	)

	
	(block
		(class $FullsizeAbsolute)
		(style
			(hitTest = false)
			(borderRadius = "XS")
			(backgroundColor = "SC.Ui_styles.SERVICE_COLORS.WHITE")
			(alpha = "buttonBackgroundAlpha")
		)

		(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
			_trigger	= "backgroundState"
			_alpha		= "buttonBackgroundAlpha"
		)
	)

	
	(block
		(class $Fullsize)
		(style
			(hitTest = false)
			(align = "center|middle")
			(alpha = "buttonIconAlpha")
		)

		(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
			_trigger	= "iconState"
			_alpha		= "buttonIconAlpha"
		)

		(controller $Instance
			(bind renderer "_renderElement")
			(bind enabled "_renderElement")
			(args "_renderArgs")
		)
	)

	(block
		(class $FullsizeAbsolute)
		(style (bind padding "-_safetyZone"))

		(macro STRUCT_MOUSE_HANDLER
			_enabled = "_enabled"
			_mouseHandler = "mouseHandler"
			_dispatchedEv = "_dispatchedEv"
			_dispatchParams = "_dispatchParams"
			_methods = "_methods"
			_soundSet = "_soundSet"
		)
	)

	(controller $Tooltip
		(bind enabled "_statusTooltipData")
		(renderer = 'SimpleStatusTooltip')
		(args
			_unifiedStatus = "_statusTooltipData._unifiedStatus"
			_text = "_statusTooltipData._text"
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)
)

(def constant TEXT_SWITCH_TAB_BACKGROUND_ALPHA {
	SC.Ui_styles.BUTTON_STATE.DISABLED	: 0,
	SC.Ui_styles.BUTTON_STATE.SELECTED	: 0.7,
	SC.Ui_styles.BUTTON_STATE.DOWN		: 0.7,
	SC.Ui_styles.BUTTON_STATE.OVER		: 1,
	SC.Ui_styles.BUTTON_STATE.UP		: 0
})

(def constant TEXT_SWITCH_TAB_LABEL_ALPHA "{
	SC.Ui_styles.BUTTON_STATE.DISABLED	: 0.25,
	SC.Ui_styles.BUTTON_STATE.SELECTED	: 1,
	SC.Ui_styles.BUTTON_STATE.DOWN		: 0.45,
	SC.Ui_styles.BUTTON_STATE.OVER		: TA,
	SC.Ui_styles.BUTTON_STATE.UP		: 0.6
}")

(def element TEXT_SWITCH_TABS_BACKGROUND ()
	(style
		(flow = "horizontal")
		(padding = "XXS")
		(backgroundImage = 'url:../service_kit/buttons/tab_bar/bg.png')
		(scale9grid = 4)
	)
)

(def element TextSwitchTab (_label:str='', _size:number="SIZE.MEDIUM", _isReadyBtn:bool=true, _name:str='', _isSelected:bool=false, _isEnabled:bool=true, _selectedClickable:bool=false,
							_width:number=0, _height:number=0, _dispatchedEv:str='', _dispatchParams:gfx={}, _methods:array=[])
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(event stateAnimationStarted)

		(var state:number = "	!_isEnabled		? SC.Ui_styles.BUTTON_STATE.DISABLED :
								_isSelected		? SC.Ui_styles.BUTTON_STATE.SELECTED :
								mouseDown		? SC.Ui_styles.BUTTON_STATE.DOWN :
								rollOver		? SC.Ui_styles.BUTTON_STATE.OVER
												: SC.Ui_styles.BUTTON_STATE.UP")

		(var selectionBGAlpha:number = "TEXT_SWITCH_TAB_BACKGROUND_ALPHA[state]")
		(var labelAlpha:number = "TEXT_SWITCH_TAB_LABEL_ALPHA[state]")

		(var labelColor:number = "	state == SC.Ui_styles.BUTTON_STATE.SELECTED		? _isReadyBtn	? SC.Ui_styles.SERVICE_COLORS.ACCENT_BLUE
																									: SC.Ui_styles.SERVICE_COLORS.RED
																					: SC.Ui_styles.SERVICE_COLORS.WHITE")
	)

	(bind name "_name")

	(style
		(align = "center|middle")
		(backgroundColor = "NO_COLOR")
		(bind height "_height ? _height : 23px")
		(bind width "_width ? _width : 93px")
	)

	(block
		(bind name "_isSelected")
		(class $FullsizeAbsolute)
		(style
			(hitTest = false)
			(scale9grid = [3, 2, 3, 2])
			(alpha = "selectionBGAlpha")
			(bind backgroundImage "_isReadyBtn	? 'url:../service_kit/buttons/text_switcher/over.png'
												: 'url:../service_kit/buttons/text_switcher/over_orange.png'")
		)

		(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA _trigger="state" _alpha="selectionBGAlpha")
	)

	(tf
		(bind class "_size == SIZE.LARGE ? '$TextDefaultBold26NM' : '$TextDefaultBold14NM'")
		(style
			(hitTest = false)
			(width = 100%)
			(textAlign = "center")
			(wordWrap = false)
			(alpha = "labelAlpha")
			(bind textColor "labelColor")
		)
		(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA _trigger="state" _alpha="labelAlpha")

		(bind text "toUpper(_label)")
	)

	(macro MOUSE_HANDLER
		_enabled = "!(!_isEnabled || (!_selectedClickable && _isSelected))"
		_dispatchedEv = "_dispatchedEv"
		_dispatchParams = "_dispatchParams"
		_methods = "_methods"
		_soundSet = "'button_text_switch'"
	)
)

(def element TextButton (_label:str='', _name:str='', _methods:array = [], _dispatchedEv:str='', _dispatchParams:dict = {})
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(var state:number = "	mouseDown	? SC.Ui_styles.BUTTON_STATE.DOWN :
								rollOver	? SC.Ui_styles.BUTTON_STATE.OVER
											: SC.Ui_styles.BUTTON_STATE.UP")

		(var labelAlpha:number = "TEXT_BUTTON_ALPHA[state]")
	)
	(bind name "_name")
	(style (alpha = "labelAlpha"))

	(tf
		(class $TextDefaultNM)
		(bind text "_label")
	)

	(block
		(style
			(position = "absolute")
			(bottom = "-XS")
			(height = 1px)
			(width = 100%)
			(backgroundColor = 0xE6FFFFFF)
		)
	)

	(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
		_trigger="state"
		_alpha="labelAlpha"
	)

	(macro MOUSE_HANDLER
		_methods = "_methods"
		_dispatchedEv = "_dispatchedEv"
		_dispatchParams = "_dispatchParams"
		_soundSet = "'button_context'"
	)
)

(def element ImageWithTextButton (	_imgUrl:str = '',
									_text:str = '',
									_dispatchedEv:str='',
									_isDisabled:bool = false,
									_isBoldText:bool = true,
									_size:number = "SIZE.SMALL")
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(var state:number = "	_isDisabled	? SC.Ui_styles.BUTTON_STATE.DISABLED :
								mouseDown	? SC.Ui_styles.BUTTON_STATE.DOWN :
								rollOver	? SC.Ui_styles.BUTTON_STATE.OVER
											: SC.Ui_styles.BUTTON_STATE.UP")
		(var searchAlpha:number = "IMAGE_BUTTON_ALPHA[state]")
	)

	(macro MOUSE_HANDLER
		_dispatchedEv = "_isDisabled ? null : _dispatchedEv"
	)

	(style
		(flow = "horizontal")
		(align = "middle")
		(alpha = "searchAlpha")
	)

	(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
		_trigger = "state"
		_alpha = "searchAlpha"
	)

	(block
		(style
			(hitTest = false)
			(height = 18px)
			(width = 18px)
			(bind backgroundImage "_imgUrl")
		)
	)

	(tf
		(bind class "_isBoldText	?	_size == SIZE.SMALL	?	'$TextDefaultBoldNM'
															:	'$TextDefaultBold18NM'
									:	_size == SIZE.SMALL	?	'$TextDefaultNM'
															:	'$TextDefault18NM'")
		(style
			(alpha = "TA")
			(bind marginLeft "_isBoldText ? 6px : S")
			(bind marginTop "_isBoldText ? 0px : 3px")
		)
		(bind text "_text")
	)
)