(def constant TAB_BUTTON_DEFAULT_HEIGHT 32)

(def constant TAB_BUTTON_LABEL_ALPHA {
	SC.Ui_styles.BUTTON_STATE.DISABLED	: 0.2,
	SC.Ui_styles.BUTTON_STATE.SELECTED	: "TA",
	SC.Ui_styles.BUTTON_STATE.DOWN		: "TA",
	SC.Ui_styles.BUTTON_STATE.OVER		: "TA",
	SC.Ui_styles.BUTTON_STATE.UP		: "TA"
})

(def constant TAB_BUTTON_LINE_ALPHA {
	SC.Ui_styles.BUTTON_STATE.DISABLED	: 0,
	SC.Ui_styles.BUTTON_STATE.SELECTED	: "TA",
	SC.Ui_styles.BUTTON_STATE.DOWN		: 0.2,
	SC.Ui_styles.BUTTON_STATE.OVER		: 0.5,
	SC.Ui_styles.BUTTON_STATE.UP		: 0
})

(def element TabButton (_label:str='', _isSelected:bool=false, _isDisabled:bool=false, _width:number=0,
						_isNewMarker:bool=false, _isAttentionMarker:bool=false, _newContentCounter:number=0, _image:str='',
						_dispatchedEv:str='', _dispatchParams:gfx={}, _methods:array=[], _tooltipElement:str='SimpleStatusTooltip', _tooltipData:dict={}, _name:str='')
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(var showMarkerNew:bool = "_isNewMarker")
		(var showMarkerAttention:bool = "_isAttentionMarker && !_isNewMarker")
		(var showMarkerCounter:bool = "_newContentCounter > 0 && !showMarkerNew && !showMarkerAttention")

		(var state:number = "	_isDisabled	? SC.Ui_styles.BUTTON_STATE.DISABLED :
								_isSelected	? SC.Ui_styles.BUTTON_STATE.SELECTED :
								mouseDown	? SC.Ui_styles.BUTTON_STATE.DOWN :
								rollOver	? SC.Ui_styles.BUTTON_STATE.OVER
											: SC.Ui_styles.BUTTON_STATE.UP")

		(var labelAlpha:number = "TAB_BUTTON_LABEL_ALPHA[state]")

		(var label:str = "_label ? toUpper(tr(_label)) : ''")

		(var tooltipText:str = "'text' in _tooltipData ? _tooltipData.text : ''")
		(var tooltipUnifiedStatus:str = "'unifiedStatus' in _tooltipData ? _tooltipData.unifiedStatus : SC.Ui_styles.UNIFIED_STATUS.DEFAULT")

		(var selectionState:number = "!_isDisabled		?	_isSelected				? SC.Ui_styles.BUTTON_STATE.SELECTED :
															mouseDown				? SC.Ui_styles.BUTTON_STATE.DOWN :
															rollOver				? SC.Ui_styles.BUTTON_STATE.OVER
																					: SC.Ui_styles.BUTTON_STATE.UP
														:	SC.Ui_styles.BUTTON_STATE.DISABLED")
	)

	(bind name "_name")

	(style
		(align = "center")
		(bind width "_width ? _width : 'auto'")
		(height = "TAB_BUTTON_DEFAULT_HEIGHT")
		(backgroundColor = "NO_COLOR")
	)

	(hblock
		(bind name "_isSelected")

		(style
			(hitTest = false)
			(bind marginLeft "_width ? 0px : MS")
			(bind marginRight "_width ? 0px : MS")
		)

		
		(hblock
			(style (alpha = "labelAlpha"))
			(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
				_trigger = "state"
				_alpha = "labelAlpha"
				_duration = "0.12"
			)
		
			
			(block
				(bind visible "_image")

				(style
					(marginTop = 3px)
					(width = 24px)
					(height = 24px)
					(bind backgroundImage "_image")
				)
			)

			
			(block
				(bind visible "_label")

				(tf
					(class $TextDefaultBoldNM)

					(style
						(marginTop = 10px)
						(wordWrap = false)
						(bind marginLeft "_image ? XS : 0px")
					)

					(bind text "toUpper(tr(_label))")
				)
			)
		)

		
		(block
			(macro DEFAULT_CONTROL_MARKER_ANIMATION "showMarkerNew")
			(style
				(position = "absolute")
				(top = "XXS")
				(bind right "_width ? -XS : -SXS")
			)

			(element MarkerNew)
		)

		
		(block
			(macro DEFAULT_CONTROL_MARKER_ANIMATION "showMarkerAttention")
			(style
				(position = "absolute")
				(top = "XS")
				(right = "-XS")
			)

			(element MarkerAttention)
		)

		
		(block
			(style (position = "absolute") (right = -3px) (top = "XXS"))

			(block
				(macro DEFAULT_CONTROL_MARKER_ANIMATION "showMarkerCounter")
				(style (position = "absolute"))
				
				(element MarkerNew
					_newContentCounter = "_newContentCounter"
				)
			)
		)
	)

	
	(block
		(style
			(position = "absolute")
			(bottom = 0)
			(width = 100%)
		)

		(element TabSelectionStatePanel
			_state = "selectionState"
		)
	)

	(macro MOUSE_HANDLER
		_enabled = "!_isDisabled && !_isSelected"
		_dispatchedEv = "_dispatchedEv"
		_dispatchParams = "_dispatchParams"
		_methods = "_methods"
		_soundSet = "'button_tab'"
	)

	(controller $Tooltip
		(bind enabled "tooltipText && (!_isSelected || _image || _isAttentionMarker)")
		(bind renderer "_tooltipElement")
		(args
			_text = "tooltipText"
			_unifiedStatus = "tooltipUnifiedStatus"
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR "0")
	)
)