(def element HangarItemRenderer (_ownSquadronEntity:dhEntity)
	(scope
		(event evMouseOver)
		(event evMouseOut)

		(var ammoType:number = "_ownSquadronEntity.plane.ammoType")
		(var ammoTypeName:str = "SC.Common.PLANE_AMMO_TYPES.VALUE_TO_NAME[ammoType]")
		(var ammoPostfix:str = "ammoTypeName in SC.Common.PLANE_AMMO_TYPES.SHORT_NAMES ? SC.Common.PLANE_AMMO_TYPES.SHORT_NAMES[ammoTypeName] : ''")
		(var planeType:number = "_ownSquadronEntity.plane.planeType")

		(var hangarComponent:dhComponent = "getPrimaryComponent(CC.hangar, _ownSquadronEntity.ownSquadron.id)")
		(var curPlanesInHangar:number = "hangarComponent.planeCount ?: 0" (event "hangarComponent.evChanged"))
		(var planeIconPath:str = "'swf:../battle_hud/markers/plane_svg/plane_svg.swf:' + PLANE_TYPE_TO_STR[planeType] + ammoPostfix + '_own'")

		(var isRollOver:bool = false)
		(bind isRollOver true init=false (event "evMouseOver"))
		(bind isRollOver false init=false (event "evMouseOut"))
	)

	(style
		(width = 30px)
		(bind marginLeft "$index == 0 ? 16 : 14")
		(align = "center")
	)

	(controller $Tooltip (renderer = 'HangarItemTooltip')
		(args
			_ownSquadronEntity = "_ownSquadronEntity"
		)
		(align="bottom|center")
		(position="border")
		(offset=[0, 20])
		(screenBoundsOffset={left:10, top:30, right:10, bottom:100})
		(macro SIMPLE_TOOLTIP_ANIMATION)
	)


	(block
		(style
			(width = 22px)
			(height = 22px)
			(marginTop = "XS")
			(bind backgroundImage "planeIconPath")
			(bind alpha "(curPlanesInHangar > 0 ? 1 : 0.5)")
		)
	)
	(element PlaneReloadProgressAndAttackersBar "_ownSquadronEntity.ownSquadron.id" "false" "true")


	
	(block
		(style (position = "absolute") (width = 30) (height = 50) (top = -2) (backgroundColor = "NO_COLOR"))
		(dispatch evMouseOver on='rollOver')
		(dispatch evMouseOut on='rollOut')
	)
)


(def element HangarItemTooltip (_ownSquadronEntity:dhEntity)
	(scope
		(var hangarEntity:gfx = "$datahub.getPrimaryEntity(CC.hangar, _ownSquadronEntity.ownSquadron.id)")

		(var hangar:gfx = "hangarEntity.hangar")
		(var planeCount:number = "hangar.planeCount")
		(var maxPlanesInSquadron:number = "_ownSquadronEntity.health.max")
		(var maxPlaneCount:number = "hangar.maxPlaneCount")
		(var timeToRestore:number = "hangar.timeToRestore" (event "hangar.evChanged"))

		(var ammoType:number = "_ownSquadronEntity.plane.ammoType")
		(var ammoTypeName:str = "SC.Common.PLANE_AMMO_TYPES.VALUE_TO_NAME[ammoType]")
		(var ammoPostfix:str = "ammoTypeName in SC.Common.PLANE_AMMO_TYPES.SHORT_NAMES ? SC.Common.PLANE_AMMO_TYPES.SHORT_NAMES[ammoTypeName] : ''")
		(var planeType:number = "_ownSquadronEntity.plane.planeType")
		(var planeIconPath:str = "'swf:../battle_hud/markers/plane_svg/plane_svg.swf:' + PLANE_TYPE_TO_STR[planeType] + ammoPostfix + '_own'")

		(var planesInAttacker:number = "_ownSquadronEntity.ownSquadron.attackerSize")
		(var numAttakers:number = "maxPlanesInSquadron && planesInAttacker ? floor(maxPlanesInSquadron / planesInAttacker) : 0")

		(var tooltipParams:dict ="{
			planeCount: planeCount,
			maxPlanesInSquadron: maxPlanesInSquadron,
			timeToRestore: timeToRestore,
			maxPlaneCount: maxPlaneCount,
			numAttakers: numAttakers,
			planesInAttacker: planesInAttacker
		}" (event "hangar.evChanged"))
	)

	(style (width = "WEAPON_TOOLTIP_WIDTH"))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderWithIconAndText
					_imageUrl = "planeIconPath"
					_imageWidth = 22px
					_imageHeight = 22px
					_headerText = "_ownSquadronEntity.plane.ammoTypeIDS"
		)

		(element TooltipSystemHorizontalDivider)

		(element WeaponBattleTooltipParamsList
					_params="tooltipParams"
					_paramSet="HANGAR_TOOLTIP_PARAMS_SET"
					_entityId="_ownSquadronEntity.id"
		)
	)
)
