(def constant SLOT_RELOAD_FONT_SIZE 27)

(def element SlotReloadBar ()
	(scope
		(var _reloadEntityId:number = -1)
		(var _atWork:bool = false)
		(var _atCharge:bool = false)
		(var _inverted:bool = true)
		(var _remainTime:number = 0)
		(var _showTime:bool = true)
		(var _percentPassed:number = 0)

		(macro HUMAN_READABLE_COUNTDOWN_SCOPE "_remainTime")

		(var fxMargins:number = "(SLOT_FX_SIZE - SLOT_SIZE) / 2")

		(var percentPassed:number = "abs((_atWork && _inverted ? 0 : 1) - _percentPassed)")
		(var progress:number = "percentPassed")
		(var curMaskY:number = "SLOT_SIZE * (1 - progress)")
	)

	(style
		(position = "absolute")
		(top = "-fxMargins")
		(left = "-fxMargins")
		(align = "center|middle")
		(width = "SLOT_FX_SIZE")
		(height = "SLOT_FX_SIZE")
	)

	
	(block
		(class $FullsizeAbsolute)
		(style (backgroundImage = 'url:../battle_hud/weapons_panel/slot/weapon_panel_slot_bg.png'))
	)

	
	(block
		(style
			(position = "absolute")
			(width = "SLOT_SIZE")
			(height = "SLOT_SIZE")
			(top = "fxMargins")
			(left = "fxMargins")
		)

		(block
			(style
				(position = "absolute")
				(top = "-fxMargins")
				(left = "-fxMargins")
			)
			(block
				(style
					(bind backgroundImage "	_atWork 	? 'url:../battle_hud/weapons_panel/slot/weapon_panel_slot_tint_green.png' :
											_atCharge 	? 'url:../battle_hud/weapons_panel/slot/weapon_panel_slot_tint_blue.png'
														: 'url:../battle_hud/weapons_panel/slot/weapon_panel_slot_tint_orange.png'")
				)
			)
		)

		(block
			(style
				(position = "absolute")
				(left = "-fxMargins")
				(bind top "curMaskY")
			)
			(block
				(style
					(bind backgroundImage "	_atWork 	? 'url:../battle_hud/weapons_panel/slot/weapon_panel_slot_bar_green.png' :
											_atCharge	? 'url:../battle_hud/weapons_panel/slot/weapon_panel_slot_bar_blue.png'
														: 'url:../battle_hud/weapons_panel/slot/weapon_panel_slot_bar_orange.png'")
				)
			)
		)

		(block
			(class $FullsizeAbsolute)
			(style
				(backgroundColor = "SC.Ui_styles.SERVICE_COLORS.BLACK")
				(bind top "curMaskY")
			)
			(isMask = true)
		)
	)

	(tf
		(bind visible "_showTime")
		(class $ActionPanelTimerCountdown)
		(style
			(fontSize = "SLOT_RELOAD_FONT_SIZE")
			(bind textColor "	_atWork		? C_ACTIVE :
								_atCharge	? 0xFF07CEFA
											: C_RELOAD")
		)
		(macro TFMouseEnabled value=false)
		(bind text "countdownText")
	)
)