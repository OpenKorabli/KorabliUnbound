



(def element FireModeSwitcher (_ownerEntityId:number=-1)
	(scope
		(var _width:number = "SLOT_SIZE")
		(var _height:number = "SLOT_SIZE")

		(var fireModeEntity:gfx = "$datahub.getPrimaryEntity(CC.visualSlotData, SC.Ships.SHIP_INFO_WEAPON_TYPE.VALUE_TO_NAME[SC.Ships.SHIP_INFO_WEAPON_TYPE.FIRE_MODE] + '_' + DEFAULT_AVATAR_ID)")
		(var visualSlotDataComponent:gfx = "fireModeEntity.visualSlotData")

		(var command:number = "visualSlotDataComponent.commandId")
		(var itemImageUrl:str = "visualSlotDataComponent.iconPath")

		(var selfVehicleEntity:gfx = "$datahub.getSingleEntity(CC.selfVehicle)")
		(var controller:gfx = "selfVehicleEntity.weaponController" (event "selfVehicleEntity.evAdded") (event "selfVehicleEntity.evRemoved"))

		
		(var weaponType:number = "controller	? controller.selectedWeapon
												: SC.Ships.SHIP_WEAPON_TYPES.NONE" (event "controller.evSelectedWeaponChanged"))

		(var drumFireModeEntity:gfx = "$datahub.getSingleEntity(CC.drumFireMode)")
		(var drumFireModeComponent:gfx = "drumFireModeEntity.drumFireMode")
		(var isDrumFireModeActive:bool = "drumFireModeComponent.isActive"  (event "drumFireModeComponent.evIsActiveChanged"))
		(var isArtillery:bool = "weaponType == SC.Ships.SHIP_WEAPON_TYPES.ARTILLERY")
		(var isFireModeEnable:bool = "isDrumFireModeActive && isArtillery")

		(macro STAGE_SIZE)
	)

	(style
		(width = "_width")
		(height = "_height")
		(marginRight = "PANEL_ITEM_MARGIN")
		(marginBottom = "PANEL_HOTKEY_GAP")
		(backgroundColor = "SC.Ui_styles.SERVICE_COLORS.INNER_PANEL")
	)

	(block
		(class $FullsizeAbsolute)

		(macro MOUSE_LMB_EXTERNAL_CALL 'direct.action' "['weaponSlot.pressed', [command]]" "weaponType == SC.Ships.SHIP_WEAPON_TYPES.ARTILLERY")

		(element SlotItem
			_itemImageUrl 	= "itemImageUrl"
			_isSelectable 	= false
			_width 			= "_width"
			_height 		= "_height"
			_isLocked 		= "weaponType != SC.Ships.SHIP_WEAPON_TYPES.ARTILLERY"
			_isSelected 	= "isDrumFireModeActive"
		)

		(controller $Instance renderer='HotkeyIndicator'
			(args
				_commandId 	= "command"
				_toggled 	= "isDrumFireModeActive"
			)
			(exprs
				(style
					(bottom = "-HOTKEY_SIZE[SIZE.MEDIUM] - PANEL_HOTKEY_GAP")
					(hitTest = false)
					(position = "absolute")
					(hcenter = 0px)
				)
			)
		)

		(block
			(class $FullsizeAbsolute)
			(style (backgroundColor = "NO_COLOR"))

			(controller $Tooltip
				(renderer = 'BattleWeaponTooltip')
				(args
					_ammoType = "visualSlotDataComponent.id"
					_entityId = "_ownerEntityId"
				)
				(align = "bottom|center")
				(position = "border")
				(offset = [0, 20])
				(screenBoundsOffset = {left:10, top:30, right:10, bottom:100})
				(macro SIMPLE_TOOLTIP_ANIMATION)
			)
		)
	)
)
