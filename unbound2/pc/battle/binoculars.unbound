(def macro BINOCULAR_APPEAR_ANIMATION ()
	(controller $Animation
		(play	duration="0.3"
				from="{alpha: 0}"
				to="{alpha: 1}"
		)
	)
)

(def element BinocularsBackground (_isVisible:bool=true)
	(scope
		(var cameraEntity:gfx = "$datahub.getSingleEntity(CC.camera)")
		(var isBinocular:bool = "cameraEntity.camera.isBinocular" (event "cameraEntity.camera.evIsBinocularChanged"))
		(var isMaskedBinocular:bool = "cameraEntity.camera.isMaskedBinocular" (event "cameraEntity.camera.evIsMaskedBinocularChanged"))

		(var selfVehicleEntity:gfx = "$datahub.getSingleEntity(CC.selfVehicle)")
		(var isSubmarine:bool = "selfVehicleEntity ? selfVehicleEntity.hasComponent(CC.submarine) : false")

		(var binocularVisible:bool = "isBinocular && isMaskedBinocular")
	)

	(class $FullsizeAbsolute)

	(bind visible "_isVisible")

	(controller $Instance
		(bind renderer "isSubmarine ? 'PeriscopeMode' : 'NormalMode'")
		(bind enabled "binocularVisible")
	)
)

(def element NormalMode () layout=true
	(class $FullsizeAbsolute)

	(macro BINOCULAR_APPEAR_ANIMATION)

	(block
		(style (position = "absolute") (left = 0) (top = 0) (backgroundImage = 'swf:crosshairs.swf:binocular_top_left'))
	)

	(block
		(style (position = "absolute") (left = 50%) (top = 0) (backgroundImage = 'swf:crosshairs.swf:binocular_top'))
	)

	(block
		(style (position = "absolute") (right = 0) (top = 0) (backgroundImage = 'swf:crosshairs.swf:binocular_top_right'))
	)

	(block
		(style (position = "absolute") (left = 0) (bottom = 0) (backgroundImage = 'swf:crosshairs.swf:binocular_bottom_left'))
	)

	(block
		(style (position = "absolute") (left = 50%) (bottom = 0) (backgroundImage = 'swf:crosshairs.swf:binocular_bottom') )
	)

	(block
		(style (position = "absolute") (right = 0) (bottom = 0) (backgroundImage = 'swf:crosshairs.swf:binocular_bottom_right'))
	)
)

(def element PeriscopeMode () layout=true
	(class $FullsizeAbsolute)

	(macro BINOCULAR_APPEAR_ANIMATION)

	(block
		(style
			(position = "absolute") (left = 0) (top = 0) (height = 100%) (width = 50%)
			(backgroundImage = "'url:../battle_hud/binoculars/periscope/periscope_ocular_left.png'")
			(backgroundSize = "fill")
		)
	)

	(block
		(style
			(position = "absolute") (right = 0) (top = 0) (height = 100%) (width = 50%)
			(backgroundImage = "'url:../battle_hud/binoculars/periscope/periscope_ocular_right.png'")
			(backgroundSize = "fill")
		)
	)
)