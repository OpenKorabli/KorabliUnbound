(def constant WEATHER_DESCRIPTION_ITEMS_COUNT_MAP "{
	'PCOW012_Night_Logic'		: 3,
	'PCOW013_1April_Hailstorm'	: 3,
	'PCOW014_1April_Cloudburst'	: 3,
	'PCOW015_1April_IceCrumbs'	: 0,
	'PCOW019_Fog_Logic'			: 3,
	'PCOW020_Snow_Logic'		: 3,
	'PCOW021_Downpour'			: 3,
	'PCOW023_Rain_Greece'		: 3
}")


(def element TaskBattleStats ()
	(scope
		(macro DEFAULT_APPEAR_ANIMATION_SCOPE)

		(var customElementsVisibilityComponent:dhComponent = "getSingleComponent(CC.customElementsVisibility)")
		(var enabledElements:number = "customElementsVisibilityComponent.enabledElements" (event "customElementsVisibilityComponent.evChanged"))
		(var customisedElements:number = "customElementsVisibilityComponent.customisedElements" (event "customElementsVisibilityComponent.evChanged"))

		(var isTrialsDescriptionVisible:bool = "(enabledElements & SC.Battle.CUSTOM_BATTLE_ELEMENTS.TRIALS_DESCR_ON_LOADING) > 0")
		(var isDreadnoughtCustomisation:bool = "(customisedElements & SC.Battle.CUSTOM_BATTLE_ELEMENTS.DREADNOUGHT) > 0")

		(var battleInfoComponent:dhComponent = "getSingleComponent(CC.battleInfo)")
		(var gameModeId:number = "battleInfoComponent.gameModeId")
		(var gameMode:str = "battleInfoComponent.gameMode")

		(var extraDescriptionsCount:number = "	gameModeId == SC.Battle.GAME_MODE.ARMS_RACE 			? 4 :
												gameModeId == SC.Battle.GAME_MODE.PORTAL_2021 			? 4 :
												gameModeId == SC.Battle.GAME_MODE.CONVOY_EVENT 			? 2 :
												gameModeId == SC.Battle.GAME_MODE.CONVOY_AIRSHIP 		? 4 :
												gameModeId == SC.Battle.GAME_MODE.TEAM_BATTLE_ROYALE 	? 2 :
												isDreadnoughtCustomisation 								? 6
																										: 0"
		)
		(var gameModeDescriptionItemsAmount:number = "	gameModeId == SC.Battle.GAME_MODE.ANTI_STANDARD 		? 2:
														gameModeId == SC.Battle.GAME_MODE.ATTACK_DEFENSE 		? 5:
														gameModeId == SC.Battle.GAME_MODE.TEAM_BATTLE_ROYALE 	? 3:
														gameModeId == SC.Battle.GAME_MODE.ARMS_RACE 			? 2:
														gameModeId == SC.Battle.GAME_MODE.PORTAL_2021 			? 1:
														isDreadnoughtCustomisation 								? 1
																												: 0"
		)

		(var localWeatherEntity:dhEntity = "getSingleEntity(CC.localWeather)")
	)

	(style
		(flow = "horizontal")
		(align = "center")

		(bind width "localWeatherEntity != null || extraDescriptionsCount > 0 ? 1000px : 500px")
	)

	(macro DEFAULT_APPEAR_ANIMATION
		_duration 	= 0.15
		_delay 		= 0.15
		_offset 	= 5px
		_isCached 	= true
	)

	
	(block
		(style (width = 100%))

		(hblock
			(style (width = 100%))

			(block
				(block
					(controller $Instance
						(bind renderer "gameModeId == SC.Battle.GAME_MODE.PVE ? 'PVEBattleGoal' : 'PVPBattleGoal'")
					)
				)

				(block
					(style (width = 100%))

					(controller $Instance renderer='GameModeRulesDescription'
						(bind enabled "gameModeDescriptionItemsAmount > 0")
						(args
							_bulletsCount = "gameModeDescriptionItemsAmount"
							_gameModeName = "isDreadnoughtCustomisation ? 'DREADNOUGHT' : gameMode"
						)
					)
				)

				(block
					(bind visible "isTrialsDescriptionVisible")
					(style (marginTop = "M"))

					(controller $Instance renderer='BattleTrialsDescriptionOnLoadingContainer'
						(bind enabled "isTrialsDescriptionVisible")
					)
				)
			)

			(block
				(style
					(width = 400px)
					(marginLeft = 50px)
					(marginBottom = "LS")
				)

				(controller $Instance renderer='GameModeRulesDescriptionWithIconsBlock'
					(bind enabled "extraDescriptionsCount > 0")
					(args
						_bulletsCount = "extraDescriptionsCount"
						_gameModeName = "isDreadnoughtCustomisation ? 'DREADNOUGHT' : gameMode"
					)
				)
			)
		)

		(element TasksList)
	)

	
	(block
		(style
			(width = 450px)
			(marginLeft = 50px)
		)

		(controller $Instance renderer='LocalWeatherDescription'
			(bind enabled "localWeatherEntity != null && extraDescriptionsCount == 0")
		)
	)
)

(def element PVEBattleGoal ()
	(scope
		(var battleInfoComponent:dhComponent = "getSingleComponent(CC.battleInfo)")
	)

	(style
		(width = 500px)
		(marginBottom = "LS")
		(vgap = "MS")
	)

	(tf
		(class $TextDefaultBold28NM)
		(style
			(width = 100%)
			(alpha = "TA")
		)
		(text = 'IDS_PVE_OPERATION_GOAL')
	)

	(tf
		(class $TextDefault20NM)
		(style
			(width = 100%)
			(leading = -3)
			(alpha = "TC")
		)
		(bind text "tr('IDS_' + toUpper(battleInfoComponent.scenario) + '_GOAL')")
	)
)

(def element PVPBattleGoal ()
	(scope
		(var battleInfoComponent:dhComponent = "getSingleComponent(CC.battleInfo)")
		(var gameModeId:number = "battleInfoComponent.gameModeId")
		(var gameModeGoal:str = "	gameModeId in GAME_MODES_YOUR_GOAL 	? 'IDS_YOUR_GOAL' :
									gameModeId in GAME_MODES_JUST_GOAL 	? 'IDS_JUST_GOAL'
																		: 'IDS_TEAM_GOALS'"
		)
	)

	(style
		(width = 500px)
		(marginBottom = "LS")
		(vgap = "MS")
	)

	(tf
		(class $TextDefaultBold28NM)
		(style
			(width = 100%)
			(alpha = "TA")
		)
		(bind text "gameModeGoal")
	)

	(tf
		(class $TextDefault20NM)
		(style
			(width = 100%)
			(leading = -3)
			(alpha = "TC")
		)
		(bind text "battleInfoComponent.gameModeDescription")
	)
)

(def element LocalWeatherDescription ()
	(scope
		(var localWeatherComponent:dhComponent = "getSingleComponent(CC.localWeather)")
		(var gpName:str = "localWeatherComponent.gpName" (event "localWeatherComponent.evChanged"))
		(var weatherBulletsCount:number = "WEATHER_DESCRIPTION_ITEMS_COUNT_MAP[gpName] ?: 0")
	)

	(style
		(width = 100%)
		(vgap = "MS")
		(marginBottom = "LS")
	)

	(tf
		(class $TextDefaultBold28NM)
		(style
			(width = 100%)
			(alpha = "TA")
		)
		(bind text "tr(toUpper('IDS_LOCAL_WEATHER_SHIP_PARAM_HEADER_' + gpName))")
	)

	(tf
		(class $TextDefault20NM)
		(style
			(width = 100%)
			(leading = -3)
			(alpha = "TC")
		)
		(bind text "tr(toUpper('IDS_LOCAL_WEATHER_DESCRIPTION_' + gpName))")
	)

	(block
		(style
			(width = 100%)
			(vgap = "SXS")
		)

		(controller $Repeat renderer='UnorderedListItem'
			(bind count "weatherBulletsCount")
			(args
				_text 				= "'IDS_LOCAL_WEATHER_DESCRIPTION_ITEM_' + toUpper(gpName) + '_'"
				_isUseIndexForIDS 	= true
				_listStyleType 		= '-'
				_textClass 			= '$TextDefault20NM'
			)
		)
	)
)
