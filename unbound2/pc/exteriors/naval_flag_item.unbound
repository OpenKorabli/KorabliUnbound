(def element NavalFlagItem (_navalFlagName:str, _isActionsAvailable:bool)
	(scope
		
		(event evClicked)
		(event evRollOver)
		(event evRollOut)
		(event evMouseDown)
		(event evStageMouseUp)

		(var rollOver:bool = "$event.isOver" init=false watch=false (event "evRollOver") (event "evRollOut"))
		(var mouseDown:bool ="$event.isDown" init=false watch=false (event "evMouseDown") (event "evStageMouseUp"))

		(macro PULL_SHIP_ID)

		(var resourceEntity:dhEntity = "getSingleEntity(CC.accountResource)")
		(var operationsAccountLocked:bool = "resourceEntity.accountResource.operationsLocked" (event "resourceEntity.accountResource.evOperationsLockChanged"))

		(var shipEntity:dhEntity = "getPrimaryEntity(CC.ship, playerShipId)")
		(var playerShipComponent:dhComponent = "shipEntity.ownShip")
		(var currentNavalFlag:str = "shipEntity.ship.currentNavalFlag" (event "shipEntity.ship.evCurrentFlagChanged"))

		(var isNavalFlag:bool = "currentNavalFlag == _navalFlagName")

		(var navalFlag:dhComponent = "getPrimaryComponent(CC.navalFlag, _navalFlagName)")

		(var isShipInBalancer:bool =		"playerShipComponent.lock == SC.Common.OWN_SHIP_LOCK.BALANCER"			(event "playerShipComponent.evUpdateLock"))
		(var isShipReadyForBattle:bool =	"playerShipComponent.lock == SC.Common.OWN_SHIP_LOCK.DIVISION_IS_READY"	(event "playerShipComponent.evUpdateLock"))

		(var clickAction:str = "isShipReadyForBattle || isShipInBalancer || isNavalFlag	? null
																						: SC.Ui_common.EXTERIOR_ACTIONS.CHANGE_NAVAL_FLAG")
	)

	
	(dispatch evClicked			on='leftClick')
	(dispatch evRollOver		on='rollOver'		args="{isOver: true}")
	(dispatch evRollOut			on='rollOut'		args="{isOver: false}")
	(dispatch evMouseDown		on='leftMouseDown'	args="{isDown: true}")
	(dispatch evStageMouseUp	on='stageMouseUp'	args="{isDown: false}")

	(bindcall externalCall "clickAction ? 'inputMapping.onAction' : ''" "[clickAction, { shipID: playerShipId, flagName: _navalFlagName }]" init=false watch=false on='leftClick')

	
	(bindcall externalCall 'sound.playSetSoundDirect' "['button_flag', SoundEvent.OVER]" init=false watch=false (event "evRollOver"))
	(bindcall externalCall 'sound.playSetSoundDirect' "['button_flag', SoundEvent.PRESS]" init=false watch=false (event "evMouseDown"))
	(bindcall externalCall 'sound.playSetSoundDirect' "['button_flag', SoundEvent.CLICK]" init=false watch=false (event "evClicked"))

	(style
		(align = "center|middle")
		(height = "SHIP_CAMOUFLAGE_ITEM_SIZE")
		(width = "SHIP_CAMOUFLAGE_ITEM_SIZE")
	)

	(element ControlBackground
		_mouseDown = "mouseDown"
		_mouseOver = "rollOver"
		_selected = "isNavalFlag"
		_isSelectedStateInteractive = true
	)

	
	(block
		(class $FullsizeAbsolute)
		(style (padding = "-XS"))

		(block
			(class $Fullsize)
			(style (backgroundColor = "NO_COLOR"))
		)
	)

	(block
		(class $ExteriorItemSize)
		(style (bind backgroundImage "'url:../exteriors/ensigns/naval/' + navalFlag.id + '.png'"))
	)

	(controller $Tooltip
		(renderer = 'NavalFlagTooltip')
		(args _navalFlagName = "_navalFlagName")
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)
)

(def element NavalFlagTooltip (_navalFlagName:str)
	(scope
		(macro PULL_SHIP_ID)

		(var shipEntity:dhEntity = "getPrimaryEntity(CC.ship, playerShipId)")
		(var playerShipComponent:dhComponent = "shipEntity.ownShip")

		(var isShipInBalancer:bool =		"playerShipComponent.lock == SC.Common.OWN_SHIP_LOCK.BALANCER"			(event "playerShipComponent.evUpdateLock"))
		(var isShipReadyForBattle:bool =	"playerShipComponent.lock == SC.Common.OWN_SHIP_LOCK.DIVISION_IS_READY"	(event "playerShipComponent.evUpdateLock"))

		(var installedNavalFlagName:str = "shipEntity.ship.currentNavalFlag" (event "shipEntity.ship.evCurrentFlagChanged"))
		(var isInstalled:bool = "installedNavalFlagName == _navalFlagName")

		(var navalFlagEntity:gfx = "$datahub.getPrimaryEntity(CC.navalFlag, _navalFlagName)")

		(var unifiedStatus:str = "isInstalled	? SC.Ui_styles.UNIFIED_STATUS.CHECK
												: SC.Ui_styles.UNIFIED_STATUS.DEFAULT")

		(var mouseInstruction:dict = "	isInstalled				?	null :
										isShipInBalancer		?	{	_unifiedStatus: SC.Ui_styles.UNIFIED_STATUS.ATTENTION,
																		_text: 'IDS_UNABLE_TO_SET_WHILE_IN_BALANCER' } :
										isShipReadyForBattle	?	{	_unifiedStatus: SC.Ui_styles.UNIFIED_STATUS.ATTENTION,
																		_text: 'IDS_SET_UNREADY_DIVISION_FIRST_TO_OPERATE_EXTERIORS' }
																:	{	_unifiedStatus: SC.Ui_styles.UNIFIED_STATUS.MOUSE_LEFT,
																		_text: 'IDS_MOUSE_INSTRUCTION_INSTALL_ENSIGN' }")
	)
	(style (width = 320px))
	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)

	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderWithIconAndText
			_imageUrl= "'url:../exteriors/ensigns/naval/' + navalFlagEntity.navalFlag.id + '.png'"
			_imageWidth = 60px
			_imageHeight = 60px
			_headerText = "'IDS_' + navalFlagEntity.navalFlag.nameIDS"
			_subheaderText = 'IDS_NAVAL_FLAG'
			_headerIconType = "SC.Ui_styles.TOOLTIP_SYSTEM_HEADER_ICON_TYPE.SIMPLE"
		)

		(block
			(style (width = 100%))
			(controller $Instance renderer='TooltipSystemHorizontalDivider' (bind enabled "isInstalled"))
		)

		(block
			(style (width = 100%))
			(controller $Instance renderer='TooltipSystemStatusLine'
				(bind enabled "isInstalled")
				(args
					_unifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.CHECK"
					_text = 'IDS_INSTALLED'
				)
			)
		)

		(element TooltipSystemHorizontalDivider)

		(block
			(style (width = 100%))
			(controller $Instance renderer='TooltipSystemDescriptionText'
				(args
					_descriptionText = "'IDS_' + navalFlagEntity.navalFlag.nameIDS + '_DESCRIPTION'"
				)
			)
		)

		(block
			(style (width = 100%))
			(controller $Instance renderer='TooltipSystemHorizontalDivider' (bind enabled "mouseInstruction"))
		)

		(block
			(style (width = 100%))
			(controller $Instance renderer='TooltipSystemStatusLine'
				(bind enabled "mouseInstruction")
				(args
					_unifiedStatus = "mouseInstruction._unifiedStatus"
					_text = "mouseInstruction._text"
				)
			)
		)
	)
)
