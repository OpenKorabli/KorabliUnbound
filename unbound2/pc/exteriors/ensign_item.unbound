(def constant SHIP_FLAG_ITEM_SIZE 80px)

(def element EnsignItem (_ensignEntity:dhEntity, _isActionsAvailable:bool)
	(scope
		
		(event evClicked)
		(event evRollOver)
		(event evRollOut)
		(event evMouseDown)
		(event evStageMouseUp)

		(var rollOver:bool = "$event.isOver" init=false watch=false (event "evRollOver") (event "evRollOut"))
		(var mouseDown:bool ="$event.isDown" init=false watch=false (event "evMouseDown") (event "evStageMouseUp"))

		(var ensignCanUse:bool = "_ensignEntity.ensign.canUse" (event "_ensignEntity.ensign.evUpdated"))
		(var isInstalled:bool = "_ensignEntity.ensign.isInstalled" (event "_ensignEntity.ensign.evUpdated"))

		(var isNew:bool = "_ensignEntity.hasComponent(CC.newItem)")

		(var clickAction:str = "!_isActionsAvailable	? null :
								isInstalled				? SC.Ui_common.ENSIGN_ACTIONS.UNINSTALL :
								ensignCanUse			? SC.Ui_common.ENSIGN_ACTIONS.INSTALL
														: null")
	)

	(style
		(height = "SHIP_CAMOUFLAGE_ITEM_SIZE")
		(width = "SHIP_CAMOUFLAGE_ITEM_SIZE")
	)

	(element ControlBackground
		_mouseDown = "mouseDown"
		_mouseOver = "rollOver"
		_selected = "isInstalled"
		_isSelectedStateInteractive = true
	)

	(block
		(class $Fullsize)
		(style
			(align = "center|middle")
			(backgroundColor = "NO_COLOR")
		)

		(block
			(class $ExteriorItemSize)
			(style
				(bind backgroundImage "'url:../exteriors/ensigns/' + _ensignEntity.ensign.name + '.png'")
				(bind alpha "ensignCanUse ? 1 : 0.2")
			)
		)
	)

	(block
		(class $FullsizeAbsolute)
		(style (padding = "-XS"))

		(block
			(class $Fullsize)
			(style (backgroundColor = "NO_COLOR"))

			
			(dispatch evClicked on='leftClick')
			(dispatch evRollOver on='rollOver' args="{isOver: true}")
			(dispatch evRollOut on='rollOut' args="{isOver: false}")
			(dispatch evMouseDown on='leftMouseDown' args="{isDown: true}")
			(dispatch evStageMouseUp on='stageMouseUp' args="{isDown: false}")

			(bindcall externalCall "isNew ? 'inputMapping.onAction' : ''" "['makeSeen', { entityId: _ensignEntity.id}]" init=false watch=false on='rollOver')
			(bindcall externalCall "clickAction ? 'inputMapping.onAction' : ''" "[clickAction, { ensignId: _ensignEntity.ensign.id }]" init=false watch=false on='leftClick')
			
			(bindcall externalCall 'sound.playSetSoundDirect' "[clickAction ? 'button_flag' : '', SoundEvent.OVER]" init=false watch=false (event "evRollOver"))
			(bindcall externalCall 'sound.playSetSoundDirect' "[clickAction ? 'button_flag' : '', SoundEvent.PRESS]" init=false watch=false (event "evMouseDown"))
			(bindcall externalCall 'sound.playSetSoundDirect' "[clickAction ? 'button_flag' : '', SoundEvent.CLICK]" init=false watch=false (event "evClicked"))
		)
	)

	(block
		(macro DEFAULT_CONTROL_MARKER_ANIMATION "isNew")
		(style
			(position = "absolute")
			(right = "LS")
			(top = "-XXS")
		)
		(element MarkerNew)
	)

	(controller $Tooltip
		(renderer = 'EnsignTooltip')
		(args
			_id = "_ensignEntity.ensign.id"
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)
)

(def element EnsignItemStatic (_id:number, _amount:number=0, _isReward:bool=false, _params:dict="{}")
	(scope
		(var ensign:dhComponent = "getPrimaryComponent(CC.ensign, _id)")
		(var urlPath:str = "ensign ? 'url:../exteriors/ensigns/' + ensign.name + '.png' : ''")
	)
	(bind name "'EnsignItem_' + ensign.name")

	(class $ExteriorItemSize)
	(style (bind backgroundImage "urlPath"))

	(controller $Tooltip
		(renderer = 'EnsignTooltip')
		(args
			_id = "_id"
			_isReward = "_isReward"
			_noMouseInstructions = true
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)
)

(def element EnsignItemStaticView (_ensignName:str)
	(class $ExteriorItemSize)
	(style (bind backgroundImage "_ensignName ? 'url:../exteriors/ensigns/' + _ensignName + '.png' : ''"))
)
