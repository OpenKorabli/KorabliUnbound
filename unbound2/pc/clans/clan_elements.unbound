(def constant CLAN_LEAGUES "{
	HURRICANE: 0,
	TYPHOON: 1,
	STORM: 2,
	GALE: 3,
	SQUALL: 4
}")


(def element ClanLeagueLogo (_arenaId:number = 0)
	(scope
		(struct clanBattleStageResult = PULL_CLAN_BATTLE_STAGE_RESULTS (_arenaId="_arenaId"))
		(struct clanBattleResult = PULL_CLAN_BATTLE_RESULTS (_arenaId="_arenaId"))
		(var isLeagueId:bool = "clanBattleResult.toLeagueId >= 0")
		(var isPromotionStage:bool = "clanBattleStageResult.stage == SC.Clan.CLAN_BATTLE_STAGE.PROMOTION")
		(var isDemotionStage:bool = "clanBattleStageResult.stage == SC.Clan.CLAN_BATTLE_STAGE.DEMOTION")

		









		(var areDivisionDotsVisible:bool = "	isDemotionStage && !clanBattleStageResult.isProgressFinished ||
												clanBattleResult.toLeagueId == 0 && clanBattleResult.toDivisionId == 1")
		(var isClanBattleStageResultProgress:bool = "clanBattleStageResult.entity && !clanBattleStageResult.isProgressFinished")

		(var progressBarData:dict = "isPromotionStage	?	{	promotionProgress: 360,
																toDivisionId: clanBattleResult.toDivisionId,
																toLeagueId: clanBattleResult.toLeagueId }
														:	{	promotionProgress: 0,
																toDivisionId: clanBattleResult.toDivisionId,
																toLeagueId: clanBattleResult.toLeagueId }")
	)
	(element ClanLeagueLogoTemplate
		_hasEmblemTooltip = true
		_areDivisionDotsVisible = "areDivisionDotsVisible"
		_isStarVisible = "isClanBattleStageResultProgress"
		_leagueId = "clanBattleResult.toLeagueId"
		_toBattleProgres = "clanBattleResult.toRating"
		_rating = "clanBattleResult.toRating"
		_progressBarData = "progressBarData"
	)
)

(def element ClanLeagueLogoTemplate (	_hasEmblemTooltip:bool = false,
										_areDivisionDotsVisible:bool = false,
										_isStarVisible:bool = false,
										_leagueId:number = 0,
										_toDivisionId:number = 0,
										_toBattleProgress:number = 0,
										_rating:number = 0,
										_progressBarData:dict = null)
	(style
		(width = 512px)
		(height = 512px)
	)

	
	(block
		(class $Fullsize)
		(style (backgroundColor = "NO_COLOR"))

		(controller $Tooltip
			(bind enabled "_hasEmblemTooltip")
			(renderer = 'SimpleStatusTooltip')
			(args
				_text = "'IDS_CLAN_LEAGUE_' + _leagueId"
			)
			(macro DEFAULT_TOOLTIP_BEHAVIOUR)
		)
		(element ClanLeagueEmblem
			_leagueId = "_leagueId"
			_areDivisionDotsVisible = "_areDivisionDotsVisible"
			_toDivisionId = "_toDivisionId ?: _progressBarData.toDivisionId"
		)
	)

	
	(block
		(style
			(position = "absolute")
			(top = 156px)
			(left = 135px)
		)
		(controller $Instance renderer='ClanRatingProgressBar'
			(bind enabled "toBool(_progressBarData)")
			(args
				_toLeagueId = "_progressBarData.leagueId"
				_toDivisionId = "_progressBarData.toDivisionId"
				_promotionProgress = "_progressBarData.promotionProgress"
			)
		)
	)

	
	(block
		(class $FullsizeAbsolute)
		(controller $Instance renderer='ClanBattleResultsStarsBlock'
			(bind enabled "_isStarVisible")
			(args
				_toLeagueId = "_leagueId"
				_toBattleProgress = "_toBattleProgress"
			)
		)
		(controller $Instance renderer='ClanBattleRatingBlock'
			(bind enabled "!_isStarVisible")
			(args
				_toLeagueId = "_leagueId"
				_toRating = "_rating"
			)
		)
	)
)

(def element ClanLeagueEmblem (_leagueId:number = 0, _toDivisionId:number = 0, _areDivisionDotsVisible:bool = false)
	(scope
		(var isLeagueId:bool = "_leagueId >= 0")
	)

	(style
		(width = 512px)
		(height = 512px)
	)

	(block
		(class $FullsizeAbsolute)
		(style
			(backgroundSize = "fill")
			(bind backgroundImage "isLeagueId ? 'url:../clans/leagues/cvc_league_' + _leagueId + '.png' : ''")
		)
	)

	(block
		(bind visible "_areDivisionDotsVisible")
		(class $FullsizeAbsolute)
		(style (bind backgroundImage "isLeagueId ? 'url:../clans/leagues/cvc_league_' + _leagueId + '_stub.png' : ''"))
	)

	(block
		(class $MiddleAlignedAbsolutely)
		(style
			(top = 178px)
			(width = 200px)
			(height = 200px)
			(backgroundSize = "cover")
			(bind backgroundImage "toBool(_toDivisionId) ? 'url:../clans/divisions/cvc_division_' + _toDivisionId + '.png' : ''")
		)
		(controller $Tooltip
			(renderer = 'SimpleStatusTooltip')
			(bind enabled "toBool(_toDivisionId)")
			(args
				_text = 'IDS_CLAN_BATTLES_LOGO_DIVISION'
			)
			(macro DEFAULT_TOOLTIP_BEHAVIOUR)
		)
	)
)

(def element ClanRatingProgressBar (_toLeagueId:number = 0, _toDivisionId:number = 0, _promotionProgress:number = 0)
	(scope
		(var currentLeagueColor:number = "	_toLeagueId == CLAN_LEAGUES.HURRICANE	? SC.Clan.CLAN_LEAGUE_COLORS.HURRICANE :
											_toLeagueId == CLAN_LEAGUES.TYPHOON		? SC.Clan.CLAN_LEAGUE_COLORS.TYPHOON :
											_toLeagueId == CLAN_LEAGUES.STORM		? SC.Clan.CLAN_LEAGUE_COLORS.STORM :
											_toLeagueId == CLAN_LEAGUES.GALE		? SC.Clan.CLAN_LEAGUE_COLORS.GALE :
											_toLeagueId == CLAN_LEAGUES.SQUALL		? SC.Clan.CLAN_LEAGUE_COLORS.SQUALL
																					: SC.Clan.CLAN_LEAGUE_COLORS.DEFAULT")
	)

	(style
		(width = 242px)
		(height = 242px)
	)

	(block
		(class $MiddleAlignedAbsolutely)
		(style (top = 122px))

		(controller $Tooltip
			(renderer = 'SimpleStatusTooltip')
			(args
				_text = 'IDS_CLAN_BATTLES_LOGO_RATING'
			)
			(macro DEFAULT_TOOLTIP_BEHAVIOUR)
		)

		(block
			(controller $Sector
				(offset = -90)
				(innerRadius = 110)
				(radius = 122)
				(bind color "currentLeagueColor")
				(bind arc "_promotionProgress")
			)
		)
	)
)

(def element ClanBattleResultsStarsBlock (_toBattleProgress:array = [], _toLeagueId:number = 0)
	(class $Fullsize)

	(block
		(class $FullsizeAbsolute)
		(style
			(hitTest = false)
			(bind backgroundImage "_toLeagueId >= 0 ? 'url:../clans/leagues/cvc_league_' + _toLeagueId + '_ribbon_big.png' : ''")
		)
	)

	(hblock
		(class $MiddleAlignedAbsolutely)
		(style
			(bottom = "MS")
			(gap = "XS")
		)
		(controller $Repeat renderer='ClanBattleResultsStar'
			(bind count "_toBattleProgress.length")
			(args
				_stage = "_toBattleProgress[$index]"
			)
		)
	)
)

(def element ClanBattleResultsStar (_stage:str = '')
	(style
		(width = 70px)
		(height = 70px)
		(alpha = 0.8)
		(bind backgroundImage "'url:../clans/stars/cvc_star_' + _stage + '.png'")
	)
	(controller $Tooltip
		(renderer = 'SimpleStatusTooltip')
		(args
			_text = "'IDS_CLAN_STAR_' + _stage + '_DESCRIPTION'"
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)
)

(def element ClanBattleRatingBlock (_toLeagueId:number = 0, _toRating:number = 0)
	(class $Fullsize)

	(block
		(class $FullsizeAbsolute)
		(style
			(hitTest = false)
			(bind backgroundImage "_toLeagueId >= 0 ? 'url:../clans/leagues/cvc_league_' + _toLeagueId + '_ribbon_small.png' : ''")
		)
	)

	(block
		(class $MiddleAlignedAbsolutely)
		(style (top = 435px))

		(controller $Tooltip
			(renderer = 'SimpleStatusTooltip')
			(args
				_text = 'IDS_CLAN_BATTLES_LOGO_RATING'
			)
			(macro DEFAULT_TOOLTIP_BEHAVIOUR)
		)

		(tf
			(class $TextDefaultBold46NM)
			(style
				(width = 170px)
				(textAlign = "center")
				(alpha = "TA")
			)
			(bind text "_toRating")
		)
	)
)