(def element ModalWindowBuyCollectionObject (_collectionItemId:number)
	(macro MODAL_WINDOW_INIT)
	(macro MODAL_WINDOW_BG)

	(scope
		(var collectionCardEntity:dhEntity = "getPrimaryEntity(CC.collectionCard, _collectionItemId)")
		(var collectionItemName:str = "collectionCardEntity.collectionCard.name")

		(var collectionEntity:dhEntity = "getPrimaryEntity(CC.collectionAlbum, collectionCardEntity.collectionCard.collectionId)")
		(var cardCost:number = "collectionEntity.collectionAlbum.cardCost")
		(var duplicates:number  = "collectionEntity.collectionAlbum.duplicates" (event "collectionEntity.collectionAlbum.evUpdate"))
		(var isPuzzle:bool = "collectionEntity.collectionAlbum.isPuzzle" (event "collectionEntity.collectionAlbum.evUpdate"))

		(var cardName:str = "isPuzzle ? 'IDS_PUZZLE_COLLECTION_OWNED_TOOLTIP_HEADER' : tr('IDS_' + collectionItemName)")
		(var collectionNameQuotes:str = "subst('IDS_COLLECTION_NAME_NO_ENTER', [], { _collectionName: tr('IDS_' + collectionCardEntity.collectionCard.collectionName + '_QUOTES')})")

		(var isBuyAvailable:bool = "duplicates >= cardCost")
		(var duplicateDeficit:number = "cardCost - duplicates")

		(var imageUrl:str = "isPuzzle	?	'url:../bg/puzzle_collection/default_puzzle_card.png'
										:	'url:../collections/object_icons/small/' + collectionItemName + '.png'")
	)

	(block
		(class $EyeLevelAligned)
		(style (width = 500px))

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 0)
			(style (width = 100%))

			(element ModalWindowShortHeader
				_header = 'IDS_CONFIRMATION'
			)
		)

		(hblock
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
			(style
				(align = "middle")
				(width = 468px)
				(margin = "M")
			)

			(block
				(style
					(height = 120px)
					(width = 120px)
					(marginRight = "M")
					(backgroundImage = "imageUrl")
					(backgroundSize = "cover")
				)
			)

			(block
				(style (width = 100%))

				(tf
					(class $TextDefaultBold20NM)
					(style
						(width = 100%)
						(marginBottom = "M")
						(alpha = "TA")
					)
					(text = "cardName")
				)

				(tf
					(class $TextDefaultNM)
					(style
						(width = 100%)
						(alpha = "TC")
					)
					(text = "collectionNameQuotes")
				)
			)
		)

		(block
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 1.5)
			(style
				(width = 100%)
				(marginBottom = "MS")
			)

			(element HorizontalDividerTwoPx)
		)

		
		(block
			(bind visible "isBuyAvailable")
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
			(style
				(align = "center")
				(width = 100%)
				(marginBottom = "MS")
			)

			(tf
				(class $TextDefault26NM)
				(style (alpha = "TA"))
				(bind text "subst('IDS_COLLECTION_EXCHANGE_FOR_DUPLICATES_QUESTION', [], { amount: cardCost}, cardCost)")
			)
		)

		(block
			(bind visible "!isBuyAvailable")
			(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
			(style
				(align = "center")
				(width = 100%)
				(marginBottom = "MS")
			)

			(tf
				(class $TextDefault26NM)
				(style
					(marginBottom = "M")
					(alpha = "TA")
				)
				(bind text "subst('IDS_COLLECTION_NEED_DUPLICATES_FOR_EXCHANGE', [], { amount: cardCost}, cardCost)")
			)

			(element PriceDeficit
				_hideIcon =	true
				_deficit =	"duplicateDeficit"
				_size =	"SIZE.MEDIUM"
				_priceInfo =	"{currency:SC.Common.CURRENCIES.MONEY}"
			)
		)

		(hblock
			(style
				(align = "center")
				(width = 100%)
			)

			(block
				(bind visible "isBuyAvailable")
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 3.5)
				(style (marginRight = "MS"))

				(controller $Instance renderer='DefaultButton'
					(bind enabled "isBuyAvailable")
					(args
						_width = 130px
						_name = 'btn_ok'
						_enabled = "isBuyAvailable"
						_isTransactionBtn = true
						_methods = "[	{	type: 'inputMapping.onRequest',
											name: isPuzzle ? 'closeBuyWindow' : 'showPreviewWindow',
											args: { objID: _collectionItemId }},
										{	type: 'inputMapping.onAction',
											name: 'CollectionProxy.buyCard',
											args: { cardID: _collectionItemId }}]"
						_label = 'IDS_YES'
						_focusIndex = 0
						_defaultFocused = true
					)
				)
			)

			(block
				(macro DEFAULT_MODAL_WINDOW_ANIMATION 4)
				(element DefaultButton
					_width = 130px
					_label = "isBuyAvailable ? 'IDS_NO' : 'IDS_CLOSE_UPPER_CASE'"
					_name = 'btn_cancel'
					_enabled = true
					_focusIndex = "isBuyAvailable ? 1 : 0"
					_defaultFocused = "!isBuyAvailable"
				)
			)
		)
	)
)