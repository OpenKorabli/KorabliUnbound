(def element ModalWindowPlayerProfile ()
	(macro MODAL_WINDOW_INIT)
	(scope
		(var routeEntity:dhEntity = "getPrimaryEntity(CC.route, SC.Ui_windows.ROUTE.PROFILE)")
		(var componentRoute:dhComponent = "routeEntity.route")
		(var profilePage:str = "componentRoute.activeChild" (event "componentRoute.evActiveChildChanged"))

		(var isAccountLevelingPage:bool =	"profilePage == SC.Ui_windows.ROUTE.ACCOUNT_LEVELING")
		(var isAchievementsPage:bool =		"profilePage == SC.Ui_windows.ROUTE.ACHIEVEMENTS")
		(var isRanksPage:bool =				"profilePage == SC.Ui_windows.ROUTE.RANKS")
		(var isRatingBattlesPage:bool =		"profilePage == SC.Ui_windows.ROUTE.RATING")
		(var isCollectionage:bool =			"profilePage == SC.Ui_windows.ROUTE.COLLECTIONS")
		(var isSummaryPage:bool =			"profilePage == SC.Ui_windows.ROUTE.STATS")

		(var renderProfilePage:str = "  isAccountLevelingPage	?	'PlayerProfileAccountPage' :
										isAchievementsPage		?	'PlayerProfileAchievementsPage' :
										isRanksPage				?	'PlayerProfileRanksPage' :
										isRatingBattlesPage		?	'PlayerProfileRatingBattlesPage' :
										isCollectionage			?	'PlayerProfileCollectionPage' :
										isSummaryPage			?	'PlayerProfileSummaryPage'
																:	''")

		
		(var ranksRouteEntity:dhEntity =		"getPrimaryEntity(CC.route, SC.Ui_windows.ROUTE.RANKS)")
		(var rankComponentRoute:dhComponent =	"ranksRouteEntity.route")
		(var rankPage:str =						"rankComponentRoute.activeChild" (event "rankComponentRoute.evActiveChildChanged"))

		(var ratingBattlesSeasonProgress:dhComponent =	"getSingleComponent(CC.ratingBattlesSeasonProgress)")
		(var currentRatingBattleLeague:str =			"ratingBattlesSeasonProgress.leagueName" (event "ratingBattlesSeasonProgress.evLeagueNameChanged"))
		(var initialQualificationBattlesResults:array =	"ratingBattlesSeasonProgress.initialQualificationBattlesResults ?: []" (event "ratingBattlesSeasonProgress.evInitialQualificationBattlesResultsChanged"))
		(var isRatingQualification:bool =				"initialQualificationBattlesResults.length < SC.Common.RATING_BATTLES_CONSTANTS.INITIAL_QUALIFICATION_LENGTH")

		(var bgType:number = "	isRanksPage				? SC.Ui_styles.ANIMATED_BG.RANKS :
								isRatingBattlesPage		? isRatingQualification		? SC.Ui_styles.ANIMATED_BG.PROFILE
																					: SC.Ui_styles.ANIMATED_BG.RATING_BATTLES
														: SC.Ui_styles.ANIMATED_BG.PROFILE")

		(var selectedCategory:str =	"	isRanksPage			? rankPage :
										isRatingBattlesPage	? isRatingQualification ? 'rating_gold'
																					: 'rating_' + toLower(currentRatingBattleLeague)
															: 'profile'")
	)
	(macro HIDE_UI_ON_SHIPOVERVIEW)

	(class $Fullsize)
	(bindcall externalCall 'sound.playSetSoundDirect' "['dock_inset', 'profile']" on='addedToStage')

	
	(block
		(class $FullsizeAbsolute)

		(element ModalWindowAnimatedBackground
			_selectedCategory = "selectedCategory"
			_type = "bgType"
			_hideTime = 0.2
			_hideDelay = 0.2
		)
	)

	
	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)
		(class $MiddleAlignedAbsolutely)
		(style
			(width = 100%)
			(height = 40px)
			(bottom = 0px)
			(paddingLeft = "LM")
			(paddingRight = "LM")
			(align = "center|middle")
		)

		(element ProfilePlayerInfo)
	)

	
	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
		(style (width = 100%))

		(element ModalWindowHeaderFullSize
			_windowName = 'IDS_PROFILE'
			_backButtonText = 'IDS_RETURN_FROM_MODAL_WINDOW_BUTTON'
			_paddingTop = "LS"
			_paddingRight = "MS"
			_paddingLeft = "MS"
			_methods = "[{type: 'inputMapping.onRequest', name: 'goToPort', args: {}}]"
		)
	)

	
	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
		(style
			(position = "absolute")
			(height = 100%)
			(paddingTop = 24%)
			(marginLeft = "{ 1280:XXS, 1920:M }")
		)

		(element ProfileSideTabButtons
			_profilePage = "profilePage"
		)
	)

	
	(block
		(class $Fullsize)
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 3)

		(controller $Instance
			(bind enabled "renderProfilePage")
			(bind renderer "renderProfilePage")
			(reuseElement = true)
		)
	)
)

(def element ProfilePlayerInfo ()
	(scope
		(var summaryHistoryEntity:dhEntity = "getSingleEntity(CC.rankedSeasonHistory)")
		(var statData:dict = "summaryHistoryEntity.dataComponent.data" (event "summaryHistoryEntity.dataComponent.evDataChanged"))
		(var timeLastBattleFormatted:str = "formatTime(statData.basicStats.timeLastBattle ?: 0, 'dd.MM.yyyy, hh:mm.', '', true)")
		(var dateAccountRegistrated:str = "statData.basicStats.registrationDate + '.'")
	)

	(style
		(width = 100%)
		(align = "center")
	)

	(hblock
		(tf
			(class $TextDefault18NM)
			(style
				(alpha = "TS")
				(marginRight = "XS")
			)
			(bind text "tr('IDS_REGISTRATION_DATE') + dateAccountRegistrated")
		)

		(tf
			(bind visible "statData.basicStats.timeLastBattle > 0")
			(class $TextDefault18NM)
			(style (alpha = "TS"))
			(bind text "tr('IDS_LAST_BATTLE') + timeLastBattleFormatted")
		)
	)
)