(def element ModalWindowPVEResults ()
	(macro MODAL_WINDOW_INIT)
	(macro MODAL_WINDOW_BG)
	(scope
		(var battleResultsStructuredEntity:dhEntity = "getSingleEntity(CC.battleResultsStructured)")

		(var private:dict = "battleResultsStructuredEntity.dataComponent.data.personal")
		(var gameData:dict = "battleResultsStructuredEntity.dataComponent.data.game_data")

		(var isWinner:bool = "private.team_id == gameData.winner_team_id")
		(var secondaryTasks:array = "gameData.secondaryTasks ?: []")

		(var operationStatusIDS:str = "isWinner ? 'IDS_PVE_OPERATION_RESULTS_DONE' : 'IDS_PVE_OPERATION_RESULTS_UNDONE'")
		(var iconPath:str = "isWinner ? 'url:../pve/result_screen_bg/pve_victory.png' : 'url:../pve/result_screen_bg/pve_loss.png'")
		(var isSmallScreen:bool = "stageHeight < 900")
	)

	(style (align = "center"))

	
	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 1)
		(style
			(bind width "isSmallScreen ? 250px : 300px")
			(bind height "isSmallScreen ? 250px : 300px")
			(marginTop = "{720:SXS, 1080:XL}")
			(marginBottom = "XS")
		)

		(block
			(class $FullsizeAbsolute)
			(style
				(hitTest = false)
				(scaleX = 1.2)
				(scaleY = 1.2)
				(pivotX = 50%)
				(pivotY = 50%)
				(marginLeft = 50%)
				(marginTop = 50%)
				(backgroundImage = 'url:../animations/spine/selected_battle_type/selected_battle_type.skel')
				(backgroundSize = "fill")
			)
		)

		(block
			(class $Fullsize)
			(style				
				(backgroundImage = "iconPath")
				(backgroundSize = "fill")
			)
		)
	)
	
	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 1.5)
		(style (marginBottom = "LS"))
		(tf
			(bind class "isSmallScreen ? '$TextDefaultBold40NM' : '$TextDefaultBold46NM'")
			(bind text "operationStatusIDS")
		)
	)

	(block
		(style
			(width = 600px)
			(height = 100%)
		)

		(scrollArea
			(class $Fullsize)

			(macro DEFAULT_VERTICAL_SCROLL_PARAMS
				_singleStep = "REWARD_DEFAULT_CARD_SIZE"
			)

			(content
				(style (width = 100%))

				(controller $Repeat renderer='PVETaskResultElement'
					(bind count "secondaryTasks.length")
					(args
						_text="secondaryTasks[$index].text"
						_category="secondaryTasks[$index].category"
						_taskStatus="secondaryTasks[$index].status"
					)
				)
			)
		)
	)

	(block
		(macro DEFAULT_MODAL_WINDOW_ANIMATION 2)
		(style
			(width = 100%)
			(align = "center")
			(marginTop = "LM")
			(marginBottom = "LM")
		)
		(element DefaultButton
			_name = 'btn_cancel'
			_label = 'IDS_NEXT_BUTTON'
			_size = "isSmallScreen ? SIZE.MEDIUM : SIZE.LARGE"
			_width = 180px
			_focusIndex = 0
			_defaultFocused = "true"
		)
	)
)

(def element PVETaskResultElement	(	_text:str,
										_taskStatus:number,
										_category:number
									)
	(macro DEFAULT_MODAL_WINDOW_SCOPE_EVENTS)
	(scope
		(var isTaskCompleted:bool = "_taskStatus == SC.Battle.PVE_TASK_STATUS.SUCCESS")
		(var taskStatusIcon:str = "isTaskCompleted ? 'icon_pve_task_completed' : 'icon_pve_task_not_completed'")
		(var animDelay:number = "1.5 + 1.2*$index")
	)

	(macro DEFAULT_MODAL_WINDOW_ANIMATION_EXPRESSION "animDelay")

	(style
		(width = 100%)
		(flow = "horizontal")
		(marginBottom = "M")
	)

	(block
		(style
			(width = 24px)
			(height = 24px)
			(marginRight = "SXS")
			(backgroundImage = "'swf:../pve/service_icons/service_icons.swf:icon_pve_task_status'")
		)
		(colorTransform = "isTaskCompleted ? CT_ALLY : CT_ENEMY")
	)

	(tf
		(class $TextDefault20NM)
		(style
			(width = 100%)
			(marginTop = 5px)
			(bind alpha "isTaskCompleted ? TC : TS")
		)
		(text = "_text")
	)
)
