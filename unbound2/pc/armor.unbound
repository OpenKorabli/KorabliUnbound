(def constant ARMOR_THICKNESS_EMPTY -1)

(def element ArmorTooltipHub ()
	(scope
		(event evShowArmorTooltip)
		(event evHideArmorTooltip)

		(macro PULL_SHIP_ID)

		(var armorPickEntity:dhEntity =	"getPrimaryEntity(CC.shipArmorPick, viewedShipId)")
		(var armorPick:dhComponent =	"armorPickEntity.shipArmorPick")

		(var armorThickness:number =	"armorPick.thickness ?: ARMOR_THICKNESS_EMPTY"	(event "armorPick.evUpdate"))
		(var isNoArmorShown:bool =		"armorThickness == ARMOR_THICKNESS_EMPTY")
	)

	(dispatch evShowArmorTooltip	(event "armorPick.evUpdate") (bind enabled "!isNoArmorShown"))
	(dispatch evHideArmorTooltip	(event "armorPick.evUpdate") (bind enabled "isNoArmorShown"))

	(controller $Tooltip
		(renderer = 'ArmorTooltip')
		(macro DEFAULT_TOOLTIP_CUSTOM_EVENTS_BEHAVIOUR
			_evShow = "evShowArmorTooltip"
			_evHide = "evHideArmorTooltip"
		)
	)
)

(def element ArmorTooltip ()
	(scope
		(macro PULL_SHIP_ID)

		(var armorPickEntity:dhEntity =	"getPrimaryEntity(CC.shipArmorPick, viewedShipId)")
		(var armorPick:dhComponent =	"armorPickEntity.shipArmorPick")

		(var armorName:str =			"armorPick.armorName"	(event "armorPick.evUpdate"))
		(var armorType:str =			"armorPick.armorType"	(event "armorPick.evUpdate"))
		(var armorThickness:number =	"armorPick.thickness"	(event "armorPick.evUpdate"))

		(var header:str = "tr('IDS_' + toUpper(armorName))")
		(var subheader:str = "tr('IDS_ARMOUR_TYPE_' + armorType)")
		(var attributesNeutral:array = "[{	attributeIDS: 'IDS_SHIP_ARMOUR_THICKNESS_PARAM',
											measuredValue: armorThickness,
											measure: 'IDS_MILLIMETER',
											category: 'neutral' }]")
		(var iconPath:str = "'url:../service_kit/armor_types/preview/armor_' + armorType + '.png'")
	)

	(style (width = "DEFAULT_TOOLTIP_WIDTH"))

	(macro TOOLTIP_SYSTEM_DEFAULT_BACKGROUND)
	(element TOOLTIP_SYSTEM_DEFAULT_CONTAINER
		(element TooltipSystemHeaderWithIconAndText
			_imageUrl =			"iconPath"
			_headerText =		"header"
			_imageWidth = 		40px
			_imageHeight = 		40px
			_subheaderText =	"subheader"
		)

		(element TooltipSystemHorizontalDivider)

		(element TooltipSystemParamsModifiersList
			_attributesNeutral = "attributesNeutral"
		)
	)
)