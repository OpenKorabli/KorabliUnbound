(def constant EVENT_BANNER_WIDTH {
	SMALL:	280px,
	MEDIUM:	280px,
	LARGE:	568px
})

(def constant EVENT_BANNER_HEIGHT {
	SMALL:	48px,
	MEDIUM:	160px,
	LARGE:	160px
})

(def constant EVENT_BANNER_SIZE "{
	SC.Ui_common.TILE_SIZE.S: {	bannerWidth: EVENT_BANNER_WIDTH.SMALL,
								bannerHeight: EVENT_BANNER_HEIGHT.SMALL},
	SC.Ui_common.TILE_SIZE.M: {	bannerWidth: EVENT_BANNER_WIDTH.MEDIUM,
								bannerHeight: EVENT_BANNER_HEIGHT.MEDIUM},
	SC.Ui_common.TILE_SIZE.L: {	bannerWidth: EVENT_BANNER_WIDTH.LARGE,
								bannerHeight: EVENT_BANNER_HEIGHT.LARGE}
}")

(def constant TUTORIAL_BANNER_MAX_LEVEL 14)

(def constant MOTIVATOR_SYMBOLS_MAX 23)

(def constant ACTIVITIES_BANNERS_PIN_OFFSET "-LM")

(def css $EventBanner ()
	(width = 100%)
	(height = 100%)
	(paddingRight = "M")
	(paddingLeft = "M")
	(paddingBottom = "M")
	(align = "bottom")
)

(def css $EventBannerReward ()
	(position = "absolute")
	(right = 0)
	(bottom = 0)
)

(def css $EventSmallBannerProgressBar ()
	(width = 100%)
	(paddingLeft = "-SXS")
	(paddingRight = "-SXS")
	(position = "absolute")
	(bottom = "-M")
)

(def css $EventMediumBannerProgressBar ()
	(width = 100%)
	(marginTop = "SXS")
	(position = "relative")
	(paddingLeft = 0px)
	(paddingRight = 0px)
	(bottom = 0px)
)

(def macro PORT_BANNER_CHANGE_ALPHA_BY_TRIGGER_ANIM (_triggerExpression:expression)
	(alpha = "_triggerExpression ? 0.5 : 1")
	(controller $Animation
		(bindcall play	duration="0.15"
						to="{alpha: 0.5}"
						action="kill"
						easing="Easing.line"
						(bind enabled "_triggerExpression")
		)
		(bindcall play	duration="0.15"
						to="{alpha: 1}"
						action="kill"
						easing="Easing.line"
						(bind enabled "!_triggerExpression")
		)
	)
)

(def macro BANNER_PROGRESS_BAR_BLOCK_POSITION (_size:expression = "SC.Ui_common.TILE_SIZE.S")
	(bind class "_size == SC.Ui_common.TILE_SIZE.S	? '$EventSmallBannerProgressBar'
													: '$EventMediumBannerProgressBar'")
)

(def macro BANNER_MOTIVATOR_BORDER_RADIUS ()
	(bind borderRadiusBottomLeft "!toBool($index) ? S : 0")
	(bind borderRadiusTopLeft "!toBool($index) ? S : 0")
	(bind borderRadiusBottomRight "toBool($index) ? S : 0")
	(bind borderRadiusTopRight "toBool($index) ? S : 0")
)

(def macro MOUSE_HANDLER_BANNER (_methods:expression=[])
	(macro MOUSE_EVENTS_DISPATCHER)
	(macro SOUND_HANDLER "'button_banner'")
	(macro MOUSE_LMB_EXTERNAL_CALL_REPEAT
		_methods = "_methods"
	)
)

(def macro MOTIVATOR_STAGE_SIZES ()
	(macro STAGE_SIZE)
	(var isMediumResolution:bool = "stageHeight < 1080")
	(var isSmallResolution:bool = "stageHeight <= 800")
)

(def struct GET_TILE_INFO (_entityId:number = 0)
	(var tileEntity:dhEntity = "getEntity(_entityId)")
	(var component:dhComponent = "tileEntity.tile")
	(var tileId:str = "component.tileId" (event "component.evChanged"))
	(var tileSize:number = "component.currentTileSize ?: SC.Ui_common.TILE_SIZE.M" (event "component.evChanged"))
)

(def struct GET_TILE_CONTENT_INFO(_entityContentId:number = 0)
	(var tileContentEntity:dhEntity = "getEntity(_entityContentId)")
	(var tileContent:dhComponent = "tileContentEntity.tileContent")
	(var contentId:str = "tileContent.contentId" (event "tileContent.evChanged"))
	(var tileId:str = "tileContent.tileId" (event "tileContent.evChanged"))

	(var tileEntity:dhEntity = "getPrimaryEntity(CC.tile, tileId)")
	(var tile:dhComponent = "tileEntity.tile")
	(var tileSize:number = "tile.currentTileSize ?: SC.Ui_common.TILE_SIZE.M" (event "tile.evChanged"))
)

(def macro DECLARE_SCROLL_TARGET_INDEX (_tipId:expression = 0)
	(dispatch 'evDeclareScrollTargetIndex' dir="EventDirection.UP" on='addedToStage' (bind enabled "_tipId"))
)


(def element EventsDockMainInset ()
	(scope
		(event evSetScrollTargetIndex)
		(event evCanScrollChanged)

		(struct stageSize = STAGE_SIZE())
		(macro CAROUSEL_HEIGHT_SCOPE)
		(var dockHeaderHeight:number = 94)

		(var tiles:dhCollection = "getCollectionByPath(CC.tile, 'visible.sorted')")

		(var scrollTargetIndex:number = -1)
		(bind scrollTargetIndex "$event.value"	init=false watch=false	(event "evSetScrollTargetIndex"))

		(struct guidingBottomBasicOffset =	ADAPTIVE_VERTICAL_SIZE (_minStageHeight =	720px
																	_minValue =			"carouselAreaHeight + SXS"
																	_maxStageHeight =	900px
																	_maxValue =			"carouselAreaHeight + MS"
																	_stageHeight =		"stageSize.height"))
		(struct guidingTopBasicOffset =		ADAPTIVE_VERTICAL_SIZE (_minStageHeight =	720px
																	_minValue =			"dockHeaderHeight + SXS"
																	_maxStageHeight =	900px
																	_maxValue =			"dockHeaderHeight + L"
																	_stageHeight =		"stageSize.height"))
		(struct guidingRightBasicOffset =	ADAPTIVE_HORIZONTAL_SIZE (	_minStageWidth =	1280px
																		_minValue =			"SXS"
																		_maxStageWidth =	1920px
																		_maxValue =			"L"
																		_stageWidth =		"stageSize.width"))
		(var guidingOffsets:dict = "{
				top: guidingTopBasicOffset.value,
				bottom: guidingBottomBasicOffset.value,
				right: guidingRightBasicOffset.value
			}"
		)

		(var scrollAreaTopPoint:number = 0)
		(var scrollAreaHeight:number = 0)

		(var canScroll:bool = "$event ? $event.up || $event.down : true" watch=false (event "evCanScrollChanged"))
	)

	(macro SOUND_DOCK_INSET_HANDLER "SC.Ui_windows.ROUTE.EVENTS")

	(style
		(width = "EVENT_BANNER_WIDTH.LARGE + 10px")
		(height = 100%)
		(marginLeft = "{ 1280: SXS, 1920: L }")
		(paddingTop = "{ 720: SXS, 900: L }")
		(bind paddingBottom "{ 720: carouselAreaHeight + SXS, 900: carouselAreaHeight + MS }")
	)

	(macro DEFAULT_CACHED_SHOW_ANIMATION 1)

	(scrollArea
		(style
			(width = 100%)
			(maxHeight = 100%)
			(backgroundColor = "NO_COLOR")
		)

		(macro DEFAULT_VERTICAL_SCROLL_PARAMS
			_singleStep =				"EVENT_BANNER_HEIGHT.LARGE"
			_wheelScrollAcceleration =	"0.8"
			_isContrastScrollBar =		"true"
			_canScrollChangedEvent =	"'evCanScrollChanged'"
		)

		(bind scrollAreaTopPoint	"round($globalLayoutBounds[1])"	(event "$evLayoutBoundsChanged"))
		(bind scrollAreaHeight		"round($globalLayoutBounds[3])"	(event "$evLayoutBoundsChanged"))
		(bind useMask "canScroll")

		(content
			(style
				(flow = "tile_horizontal")
				(width = 100%)
				(gap = "S")
			)
			(controller $Repeat renderer='EventBannerTileRenderer'
				(bind count "tiles.length")
				(args
					_entityId =				"tiles[$index].id"
					_guidingOffsets =		"guidingOffsets"
					_scrollAreaTopPoint =	"scrollAreaTopPoint"
					_scrollAreaHeight =		"scrollAreaHeight"
				)
			)
		)

		(bindcall scrollTo	animated=true	index="scrollTargetIndex"	watch=false		maxAnimatedDistance=300		(bind trigger "scrollTargetIndex"))
	)
)

(def element EventBannerTileRenderer (_entityId:number = 0, _guidingOffsets:dict = {}, _scrollAreaTopPoint:number = 0, _scrollAreaHeight:number = 0)
	(scope
		(struct tile = GET_TILE_INFO(_entityId="_entityId"))

		(var tileContentCollection:dhCollection = "getCollectionByPath(CC.tileContent, 'available.byTileId.' + tile.tileId + '.sorted')")
		(var tileRenderer:str = "tileContentCollection.length > 1 ? 'EventBannerCarousel' : 'EventBannerSingleItem'")
	)

	(controller $Instance
		(bind renderer "tileRenderer")
		(args
			_entityId = "_entityId"
			_guidingOffsets = "_guidingOffsets"
			_scrollAreaTopPoint = "_scrollAreaTopPoint"
			_scrollAreaHeight = "_scrollAreaHeight"
		)
	)
)

(def element EventBannerCarousel (_entityId:number = 0, _guidingOffsets:dict = {}, _scrollAreaTopPoint:number = 0, _scrollAreaHeight:number = 0)
	(scope
		(event evRadioButtonSelected)
		(event evScrollAreaValueChanged)
		(event evCarouselCanScrollChanged)
		(event evScrollToPrev)
		(event evScrollToNext)
		(event evScrollToBegin)
		(event evScrollToEnd)

		(struct tile = GET_TILE_INFO(_entityId="_entityId"))

		(var tileContentCollection:dhCollection = "getCollectionByPath(CC.tileContent, 'available.byTileId.' + tile.tileId + '.sorted')")
		(var slidersCount:number = "tileContentCollection.length")

		(var tileSlider:dhComponent = "getPrimaryComponent(CC.tileSlider, tile.tileId)")
		(var currentContentIndex:number = "tileSlider.currentContentIndex ?: 0" (event "tileSlider.evCurrentContentIndexChanged"))

		(var selectedIndex:number = "currentContentIndex")
		(bind selectedIndex "$event.index" init=false watch=false (event "evRadioButtonSelected"))
		(bind selectedIndex "selectedIndex - 1" init=false watch=false (event "evScrollToPrev"))
		(bind selectedIndex "selectedIndex + 1" init=false watch=false (event "evScrollToNext"))
	)

	(bindcall externalCall
		'direct.action'
		"['tileSlider.holdIndex', {tileId: tile.tileId}]"
		init=false watch=false
		on='rollOver'
	)

	(bindcall externalCall
		'direct.action'
		"['tileSlider.unholdIndex', {tileId: tile.tileId}]"
		init=false watch=false
		on='rollOut'
	)

	(style
		(bind width "EVENT_BANNER_SIZE[tile.tileSize].bannerWidth")
		(bind height "EVENT_BANNER_SIZE[tile.tileSize].bannerHeight")
		(backgroundColor = "NO_COLOR")
	)

	(scrollArea
		(class $Fullsize)

		(macro DEFAULT_HORIZONTAL_SCROLL_PARAMS
			_singleStep = "EVENT_BANNER_SIZE[tile.tileSize].bannerWidth"
			_scrollDuration = "900"
			_maxScrollingAnimatedDistance = "EVENT_BANNER_SIZE[tile.tileSize].bannerWidth"
			_wheelScrollSpeed = "0"
			_valueChangedEvent = "'evScrollAreaValueChanged'"
			_canScrollChangedEvent = "'evCarouselCanScrollChanged'"
			_isScrollBarVisible = "false"
			_isDrag = "false"
		)
		(repeatController = 'EventBannerCarousel')
		(scrollPerItem = true)

		(content
			(style
				(flow = "horizontal")
				(width = 100%)
			)

			(controller $DynamicRepeat renderer='EventBannerSliderItem' name='EventBannerCarousel'
				(bind count "slidersCount")
				(args
					_entityContentId = "tileContentCollection[$index].id"
					_guidingOffsets = "_guidingOffsets"
					_scrollAreaTopPoint = "_scrollAreaTopPoint"
					_scrollAreaHeight = "_scrollAreaHeight"
				)
				(bind itemWidth "EVENT_BANNER_SIZE[tile.tileSize].bannerWidth")
				(bind itemOffset "EVENT_BANNER_SIZE[tile.tileSize].bannerWidth")
			)
		)

		(bindcall scrollTo index="$event.index" watch=false (event "evRadioButtonSelected"))
		(bindcall scrollTo index="currentContentIndex" watch=false (event "tileSlider.evCurrentContentIndexChanged"))

		(bindcall scrollLeft (event "evScrollToPrev"))
		(bindcall scrollRight (event "evScrollToNext"))

		(bindcall scrollToBegin (event "evScrollToBegin"))
		(bindcall scrollToEnd (event "evScrollToEnd"))
	)

	(block
		(style (position = "absolute"))
		(element BannerScrollButton
			_buttonCarouselName = 'buttonBannerCarouselLeft'
			_direction = "ScrollDirection.LEFT"
			_canScroll = "currentContentIndex != 0"
			_clickDispatchedEv = 'evScrollToPrev'
			_methods = "[
				{
					type: 'direct.action',
					name: 'tileSlider.swipeLeft',
					args: {tileId: tile.tileId}
				}
			]"
		)
	)

	(block
		(style
			(position = "absolute")
			(right = 0px)
		)
		(element BannerScrollButton
			_buttonCarouselName = 'buttonBannerCarouselRight'
			_direction = "ScrollDirection.RIGHT"
			_canScroll = "currentContentIndex != slidersCount-1"
			_clickDispatchedEv = 'evScrollToNext'
			_methods = "[
				{
					type: 'direct.action',
					name: 'tileSlider.swipeRight',
					args: {tileId: tile.tileId}
				}
			]"
		)
	)

	(block
		(style
			(position = "absolute")
			(left = "XS")
			(top = "XS")
			(height = 16px)
			(borderRadius = "S")
			(backgroundColor = "SC.Ui_styles.SERVICE_COLORS.INNER_PANEL")
		)

		(hblock
			(style
				(gap = "S")
				(paddingTop = "XS")
				(paddingLeft = "XS")
				(paddingRight = "XS")
			)

			(controller $Repeat renderer='RadioButton'
				(bind count "slidersCount")
				(args
					_size = "SIZE.SMALL"
					_safetyZone = 8px
					_isSelected = "selectedIndex == $index"
					_dispatchedEv = 'evRadioButtonSelected'
					_dispatchParams = "{ index: $index }"
					_methods = "[
						{
							type: 'direct.action',
							name: 'tileSlider.swipeToIndex',
							args:	{
										tileId: tile.tileId,
										targetIndex: selectedIndex
									}
						}
					]"
				)
			)
		)
	)
)

(def element EventBannerSingleItem (	_entityId:number = 0,
										_guidingOffsets:dict = {},
										_scrollAreaTopPoint:number = 0,
										_scrollAreaHeight:number = 0)
	(scope
		(struct tile = GET_TILE_INFO(_entityId="_entityId"))
		(var tileContentEntity:dhEntity = "getSingleEntity(CC.tileContent, 'available.byTileId.' + tile.tileId)")
	)

	(element EventBannerContentRenderer
		_entityContentId = "tileContentEntity.id"
		_guidingOffsets = "_guidingOffsets"
		_scrollAreaTopPoint = "_scrollAreaTopPoint"
		_scrollAreaHeight = "_scrollAreaHeight"
	)
)

(def element EventBannerSliderItem (	_entityContentId:number = 0,
										_guidingOffsets:dict = {},
										_scrollAreaTopPoint:number = 0,
										_scrollAreaHeight:number = 0)
	(scope
		(struct tileContentInfo = GET_TILE_CONTENT_INFO(_entityContentId="_entityContentId"))

		(struct stageSize = STAGE_SIZE())
		(var guidingTipOffsetRight:number = "stageSize.width - EVENT_BANNER_SIZE[tileContentInfo.tileSize].bannerWidth - 340px + ACTIVITIES_BANNERS_PIN_OFFSET")
	)

	(element EventBannerContentRenderer
		_entityContentId = "_entityContentId"
		_guidingOffsets = "_guidingOffsets"
		_scrollAreaTopPoint = "_scrollAreaTopPoint"
		_scrollAreaHeight = "_scrollAreaHeight"
		_screenOffsetRight = "guidingTipOffsetRight"
	)
)

(def element EventBannerContentRenderer (	_entityContentId:number = 0,
											_guidingOffsets:dict = {},
											_scrollAreaTopPoint:number = 0,
											_scrollAreaHeight:number = 0,
											_screenOffsetRight:number = 0)
	(scope
		(event evDeclareScrollTargetIndex)

		(struct tileContentInfo = GET_TILE_CONTENT_INFO(_entityContentId="_entityContentId"))
		(var isMotivator:bool = "tileContentInfo.contentId == SC.Common.TILE_CONTENT.MOTIVATOR")
		(var bannerRenderer:str = "	tileContentInfo.contentId in BANNERS_CONFIG	? 'EventBannerContentCommon' :
									isMotivator									? 'EventBannerMotivator'
																				: 'EventBannerContentCustom'")

		(var bannerBounds:array =		"$globalLayoutBounds" (event "$evLayoutBoundsChanged"))
		(var bannerTopPoint:number =	"bannerBounds[1]")
		(var bannerHeight:number =		"bannerBounds[3]")

		(var isScrollForGuidingNeeded:bool = "(bannerTopPoint + (bannerHeight / 2)) > (_scrollAreaTopPoint + _scrollAreaHeight)")
	)
	(style
		(bind width "EVENT_BANNER_SIZE[tileContentInfo.tileSize].bannerWidth")
		(bind height "isMotivator ? auto : EVENT_BANNER_SIZE[tileContentInfo.tileSize].bannerHeight")
	)

	(dispatch
		"isScrollForGuidingNeeded ? 'evSetScrollTargetIndex' : ''"
		args="{ value: $index }"
		dir="EventDirection.UP"
		delay=0.5
		(event "evDeclareScrollTargetIndex")
	)

	(bind name "'PortBanner_' + tileContentInfo.contentId")

	(controller $Instance
		(bind renderer "bannerRenderer")
		(args
			_entityContentId = "_entityContentId"
			_guidingOffsets = "_guidingOffsets"
			_screenOffsetRight = "_screenOffsetRight"
		)
	)
)

(def element EventBannerContentCommon (_entityContentId:number = 0, _guidingOffsets:dict = {}, _screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct tileContent = GET_TILE_CONTENT_INFO(_entityContentId="_entityContentId"))

		(var isSmallBanner:bool = "tileContent.tileSize == SC.Ui_common.TILE_SIZE.S")

		(var commonBannerRenderer:str = "tileContent.contentId in BANNERS_CONFIG ? BANNERS_CONFIG[tileContent.contentId].bannerContent : ''")
	)
	(class $Fullsize)

	(macro MOUSE_HANDLER_BANNER)

	(element EventBannerTileBackground
		_entityContentId = "_entityContentId"
		_rollOver = "rollOver"
		_mouseDown = "mouseDown"
	)

	(controller $Instance
		(bind enabled "commonBannerRenderer != ''")
		(bind renderer "commonBannerRenderer")
		(args
			_size = "tileContent.tileSize"
			_guidingOffsets = "_guidingOffsets"
			_screenOffsetRight = "_screenOffsetRight"
			_bannerHeight = "EVENT_BANNER_SIZE[tileContent.tileSize].bannerHeight"
		)
	)

	(controller $Tooltip
		(bind enabled "toBool(BANNERS_CONFIG[tileContent.contentId].tooltip) && commonBannerRenderer != ''")
		(bind renderer "BANNERS_CONFIG[tileContent.contentId].tooltip")
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)
)

(def element EventBannerContentCustom (_entityContentId:number = 0, _guidingOffsets:dict = {})
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct tileContentInfo = GET_TILE_CONTENT_INFO(_entityContentId="_entityContentId"))

		(var route:str = "tileContentInfo.tileContent.route ?: ''" (event "tileContentInfo.tileContent.evChanged"))
		(var url:str = "tileContentInfo.tileContent.url ?: ''" (event "tileContentInfo.tileContent.evChanged"))
		(var skipURLTranslation:bool = "!isIn(url, SC.Ui_windows.GUI_URL.ALL)")
		(var mainText:str = "tileContentInfo.tileContent.mainText ?: ''" (event "tileContentInfo.tileContent.evChanged"))
		(var tooltipText:str = "tileContentInfo.tileContent.tooltipText ?: ''" (event "tileContentInfo.tileContent.evChanged"))

		(var isSmallBanner:bool = "tileContentInfo.tileSize == SC.Ui_common.TILE_SIZE.S")
	)
	(class $Fullsize)

	(macro MOUSE_HANDLER_BANNER
		_methods = "[{
			type: 'inputMapping.onAction',
			name: 'navigateTo',
			args: {	route: route,
					data: url ? { url: url, skipURLTranslation: skipURLTranslation} : null}
		}]"
	)

	(element EventBannerTileBackground
		_entityContentId = "_entityContentId"
		_rollOver = "rollOver"
		_mouseDown = "mouseDown"
		_isWithTitle = "toBool(mainText)"
	)

	(controller $Tooltip
		(renderer = 'SimpleStatusTooltip')
		(args
			_unifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.MOUSE_LEFT"
			_text = "tooltipText"
		)
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
	)

	(block
		(class $EventBanner)

		(element EventBannerTitle
			_title = "mainText"
			_size = "tileContentInfo.tileSize"
			_hasIcon = "toBool(url)"
		)
	)

	(block
		(bind visible "toBool(url)")
		(style
			(position = "absolute")
			(right = 0)
			(bottom = 0)
			(width = 48px)
			(height = 48px)
			(backgroundImage = 'url:../events/banners/icons/link.png')
			(borderRadiusBottomRight = "S")
			(bind borderRadiusTopRight "isSmallBanner ? S : 0px")
		)
	)
)

(def element EventBannerBattlePass (	_size:number = "SC.Ui_common.TILE_SIZE.S",
										_guidingOffsets:dict = {},
										_bannerHeight:number = 0,
										_screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(var unclaimedRewardsCollection:dhCollection = "getCollectionByPath(CC.battlePassReward, 'unclaimedRewards')")
		(var hasReward:bool = "unclaimedRewardsCollection.length > 0")

		(var battlePassCurrentLevelEntity:dhEntity = "getSingleEntity(CC.battlePassCurrentLevel)")
		(var battlePassLevel:dhComponent = "battlePassCurrentLevelEntity.battlePassLevel")
		(var curLevel:number = "battlePassLevel.level" (event "battlePassLevel.evChanged"))

		(var mainProgressionCollection:dhCollection = "getCollectionByPath(CC.battlePassLevel, 'mainProgression')")
		(var mainProgressionLength:number = "mainProgressionCollection.length ?: 0")

		(var battlePassPostProgressionLevelComponent:dhComponent = "battlePassCurrentLevelEntity.battlePassPostProgressionLevel")
		(var countCompleted:number = "battlePassPostProgressionLevelComponent.countCompleted" (event "battlePassPostProgressionLevelComponent.evChanged"))
		(var level:number = "countCompleted ? curLevel + countCompleted : curLevel")
		(var isPostProgression:bool = "battlePassPostProgressionLevelComponent != null")


		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.BATTLEPASS_SEASON_FINISH_FREE,
																											SC.Context_guiding_tip.TIP_TYPE.BATTLEPASS_SEASON_FINISH_PAID,
																											SC.Context_guiding_tip.TIP_TYPE.BATTLEPASS_EVENT_START ]"))
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(macro MOUSE_HANDLER_BANNER
		_methods = "[
			{	type: 'inputMapping.onAction',
				name: 'navigateTo',
				args: { route: SC.Ui_windows.ROUTE.BATTLE_PASS }
			}
		]"
	)

	(hblock
		(class $EventBanner)

		(element EventBannerTitle
			_title = 'IDS_DOCK_BANNER_BATTLEPASS'
			_size = "_size"
			_hasIcon = "hasReward"
		)

		(block
			(controller $Instance renderer = 'DefaultDividedCounter'
				(bind enabled "!hasReward && !isPostProgression")
				(args
					_curValue = "curLevel-1"
					_maxValue = "mainProgressionLength"
					_doNotAlphaOnZeroCurValue = true
					_curValueTextClass = '$TextDefaultBold22NM'
				)
			)

			(controller $Instance renderer = 'EventBannerCounter'
				(bind enabled "!hasReward && isPostProgression")
				(args
					_count = "level-1"
				)
			)
		)
	)

	(block
		(class $EventBannerReward)
		(controller $Instance renderer = 'EventBannerIcon'
			(bind enabled "hasReward")
			(args
				_icon = 'url:../service_kit/port_banner/icon_banner_reward.png'
				_isAnimated = "hasReward"
				_size = "_size"
			)
		)
	)

	(controller $Instance renderer='EventBannerMarkers'
		(bind enabled "hasReward")
		(args
			_isRewardMarker = "hasReward"
			_size = "_size"
		)
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"SXS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetRight =	"_screenOffsetRight"
			_screenOffsetLeft =		"_guidingOffsets.right + EVENT_BANNER_SIZE[_size].bannerWidth + ACTIVITIES_BANNERS_PIN_OFFSET"
		)
	)
)

(def element EventBannerStrategicActions (	_size:number = "SC.Ui_common.TILE_SIZE.S",
											_guidingOffsets:dict = {},
											_bannerHeight:number = 0,
											_screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(var strategicActionsEntity:dhEntity = "getSingleEntity(CC.strategicActionsEvent)")
		(var strategicActionsEventComponent:dhComponent = "strategicActionsEntity.strategicActionsEvent")

		(var isTerritoryAvailable:bool = "strategicActionsEventComponent.selectedTerritory == 0" (event "strategicActionsEventComponent.evChanged"))

		(var state:number = "strategicActionsEventComponent.state" (event "strategicActionsEventComponent.evStateChanged"))

		(var isAnyRewardClaim:bool = "strategicActionsEventComponent.isAnyRewardClaim" (event "strategicActionsEventComponent.evChanged"))

		(var isActive:bool =				"state == SC.Common.STRATEGIC_ACTIONS_EVENT_STATE.ACTIVE")
		(var isCompleted:bool =				"state == SC.Common.STRATEGIC_ACTIONS_EVENT_STATE.COMPLETED")
		(var isFinishedWithResults:bool =	"state == SC.Common.STRATEGIC_ACTIONS_EVENT_STATE.FINISHED_WITH_RESULTS")

		(var bannerDescription:str = "isActive && isTerritoryAvailable && !isAnyRewardClaim	? 'IDS_STRATEGIC_ACTIONS_BANNER_TEXT_TERRITORY' : ''")

		(var hasReward:bool = "isAnyRewardClaim && !isFinishedWithResults")

		(var isNew:bool = "strategicActionsEntity.hasComponent(CC.newItem)")
		(var isNewMarkerVisible:bool = "isNew && !isAnyRewardClaim && !isFinishedWithResults")
		(var isActionMarker:bool = "isActive && isTerritoryAvailable && !isAnyRewardClaim")

		(var isSmallBanner:bool = "_size == SC.Ui_common.TILE_SIZE.S")
		(var isDisableState:bool = "isSmallBanner && (isCompleted && !isAnyRewardClaim || isFinishedWithResults)")


		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.STRATEGIC_ACTIONS_EVENT,
																											SC.Context_guiding_tip.TIP_TYPE.STRATEGIC_ACTIONS_TASK_CHANGED,
																											SC.Context_guiding_tip.TIP_TYPE.STRATEGIC_ACTIONS_TERRITORY_COMPLETED ]"))

		(var shouldDeactivateStrategicChain:bool = "checkedTipId.value && activeTip.chainId != SC.Context_guiding_tip.TIP_CHAIN_ID.STRATEGIC_ACTIONS_TERRITORY_COMPLETED")
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(macro PORT_BANNER_CHANGE_ALPHA_BY_TRIGGER_ANIM
		_triggerExpression = "isDisableState"
	)

	(macro MOUSE_HANDLER_BANNER
		_methods = "[
			{
				type: 'inputMapping.onRequest',
				name: isFinishedWithResults ? 'showStrategicActionsResults' : '',
				args: {}
			},
			{
				type: 'inputMapping.onRequest',
				name: isFinishedWithResults ? '' : 'enterStrategicActions',
				args: {}
			},
			{
				type: 'inputMapping.onAction',
				name: isNew ? 'makeSeen' : '',
				args: { entityId: strategicActionsEntity.id }
			},
			{
				type: 'inputMapping.onAction',
				name: shouldDeactivateStrategicChain ? 'deactivateTipChain' : '',
				args: { tip_chain_id: activeTip.chainId}
			}
		]"
	)

	(block
		(class $EventBanner)

		(element EventBannerTitle
			_title = 'IDS_STRATEGIC_ACTIONS_COMMON_EVENT_TITLE'
			_size = "_size"
			_hasIcon = "hasReward"
		)
	)

	(block
		(class $EventBannerReward)
		(controller $Instance renderer = 'EventBannerIcon'
			(bind enabled "hasReward")
			(args
				_icon = 'url:../service_kit/port_banner/icon_banner_reward.png'
				_isAnimated = true
				_size = "_size"
			)
		)
	)

	(controller $Instance renderer='EventBannerMarkers'
		(bind enabled "isNewMarkerVisible || hasReward || isActionMarker")
		(args
			_isActionMarker = "isActionMarker"
			_isNewMarker = "isNewMarkerVisible"
			_isRewardMarker = "hasReward"
			_text = 'IDS_STRATEGIC_ACTIONS_BANNER_TEXT_TERRITORY'
			_size = "_size"
		)
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"SXS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetRight =	"_screenOffsetRight"
			_screenOffsetLeft =		"_guidingOffsets.right + EVENT_BANNER_SIZE[_size].bannerWidth + ACTIVITIES_BANNERS_PIN_OFFSET"
		)
	)
)

(def element EventBannerRepairDock (	_size:number = "SC.Ui_common.TILE_SIZE.S",
										_guidingOffsets:dict = {},
										_bannerHeight:number = 0,
										_screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(var repairDockDataEntity:dhEntity = "getSingleEntity(CC.repairDockData)")
		(var isRepairDockDataNew:bool = "repairDockDataEntity.hasComponent(CC.newItem)")

		(struct markerData = PULL_MARKER_NEW(_groupName = "SC.Ui_common.CONTENT_MARKER_GROUPS.REPAIR_DOCK"))
		(var hasReadyToRepairShip:bool = "markerData.markerType == SC.Ui_common.CONTENT_MARKER_TYPE.CALL_TO_ACTION")

		(var newShipComponentsEntity:dhEntity = "getPrimaryEntity(CC.newContent, SC.Common.CONTENT_CATEGORY.SHIP_COMPONENTS)")
		(var newShipComponentsCount:number = "newShipComponentsEntity.newContent.count ?: 0" (event "newShipComponentsEntity.newContent.evCountChanged"))
		(var isNewShipsMarkerVisible:bool = "newShipComponentsCount > 0")

		(var newExchangeableShipsEntity:dhEntity = "getPrimaryEntity(CC.newContent, SC.Common.CONTENT_CATEGORY.EXCHANGEABLE_SHIP)")
		(var newExchangeableShipsCount:number = "newExchangeableShipsEntity.newContent.count ?: 0" (event "newExchangeableShipsEntity.newContent.evCountChanged"))
		(var isNewExchangeableShipsMarkerVisible:bool = "newExchangeableShipsCount > 0")

		(var isNewMarkerVisible:bool = "isRepairDockDataNew || isNewShipsMarkerVisible || isNewExchangeableShipsMarkerVisible")

		(var exchangeableShips:dhCollection = "getCollectionByPath(CC.exchangeableShip, 'sorted')")

		(var shipComponentCollection:dhCollection = "getCollectionByPath(CC.shipComponent, 'sorted')")
		(var shipsCount:number = "shipComponentCollection.length")

		(var isInactive:bool = "shipsCount == 0 && !isNewMarkerVisible && exchangeableShips.length == 0")
		(var isSmallBanner:bool = "_size == SC.Ui_common.TILE_SIZE.S")
		(var isDisableState:bool = "isSmallBanner && isInactive")

		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.SHIP_SHARDS_INTRO_WITH_SHIP_MATERIAL,
																											SC.Context_guiding_tip.TIP_TYPE.SHIP_SHARDS_INTRO_WITH_SHIP_COMPONENT,
																											SC.Context_guiding_tip.TIP_TYPE.SHIP_SHARDS_FIRST_REPAIR_INTRO,
																											SC.Context_guiding_tip.TIP_TYPE.SHIP_SHARDS_MATERIALS_EXCHANGE_INTRO ]"))
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(macro PORT_BANNER_CHANGE_ALPHA_BY_TRIGGER_ANIM
		_triggerExpression = "isDisableState"
	)

	(macro MOUSE_HANDLER_BANNER
		_methods = "[
			{
				type: 'inputMapping.onAction',
				name: 'navigateTo',
				args: { route: SC.Ui_windows.ROUTE.REPAIR_DOCK }
			},
			{
				type: isRepairDockDataNew ? 'inputMapping.onAction' : '',
				name: 'makeSeen',
				args: { entityId: repairDockDataEntity.id }
			}
		]"
	)

	(hblock
		(class $EventBanner)
		(element EventBannerTitle
			_title = 'IDS_DOCK_BANNER_REPAIR_DOCK'
			_size = "_size"
			_hasIcon = "isNewMarkerVisible || hasReadyToRepairShip"
		)

		(block
			(controller $Instance renderer = 'EventBannerCounter'
				(bind enabled "!isInactive")
				(args
					_count = "shipsCount"
				)
			)
		)
	)

	(controller $Instance renderer='EventBannerMarkers'
		(bind enabled "isNewMarkerVisible || hasReadyToRepairShip")
		(args
			_isNewMarker = "isNewMarkerVisible"
			_isActionMarker = "hasReadyToRepairShip"
			_text = 'IDS_SHIP_SHARDS_BANNER_MARKER_REPAIR'
			_size = "_size"
		)
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"XS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetRight =	"_screenOffsetRight"
			_screenOffsetLeft =		"_guidingOffsets.right + EVENT_BANNER_SIZE[_size].bannerWidth + ACTIVITIES_BANNERS_PIN_OFFSET"
		)
	)
)

(def constant ARC_EVENT_SIDE_NEUTRAL -1)
(def constant ARC_EVENT_STATE_FINISHED 4)

(def element EventBannerArcEvent (	_size:number = "SC.Ui_common.TILE_SIZE.S",
									_guidingOffsets:dict = {},
									_bannerHeight:number = 0,
									_screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(struct serverTime = SERVER_TIME())

		(var arcEventEntity:dhEntity = "getSingleEntity(CC.arcEvent)")
		(var arcEventComponent:dhComponent = "arcEventEntity.arcEvent")
		(var playerArcEventInfoComponent:dhComponent = "arcEventEntity.playerArcEventInfo")

		(var arcEventstate:number =		"arcEventComponent.state" (event "arcEventComponent.evEventStateChanged"))
		(var primeTimeFinishTime:number =	"arcEventComponent.finishPrimeAt" (event "arcEventComponent.evEventStateChanged"))
		(var playerSideId:number =			"playerArcEventInfoComponent.sideId" (event "playerArcEventInfoComponent.evSideChanged"))

		(var isEventFinished:bool = "arcEventstate == ARC_EVENT_STATE_FINISHED")
		(var isSideNeutral:bool = "playerSideId == ARC_EVENT_SIDE_NEUTRAL")
		(var isPrimeTimeActive:bool = "primeTimeFinishTime - serverTime.value > 0")

		(var playerProgressEntity:dhEntity =			"getPrimaryEntity(CC.progressWithRewards, 'personal' + playerSideId)")
		(var progressWithRewardsComponent:dhComponent =	"playerProgressEntity.progressWithRewards")

		(var activeIndex:number =			"progressWithRewardsComponent.activeIndex	?: 0" (event "progressWithRewardsComponent.evChanged"))
		(var personalProgress:number =		"progressWithRewardsComponent.pointsCurrent	?: 0" (event "progressWithRewardsComponent.evChanged"))
		(var personalProgressArray:array =	"progressWithRewardsComponent.pointsArray	?: []" (event "progressWithRewardsComponent.evChanged"))

		
		(var personalRewardIndex:number =	"activeIndex - 1")
		(var personalProgressArrayMaxIndex:number = "personalProgressArray.length - 1")
		(var isPersonalRewardIndex:bool = "personalRewardIndex >= 0")

		(var personalProgressPoints:number = "personalProgressArray[0] ?: 1")
		(var pointsTillNextRewardTotal:number =	"isPersonalRewardIndex ? personalProgressArray[personalRewardIndex + 1] : personalProgressPoints")
		(var lastReceivedRewardPoints:number =	"isPersonalRewardIndex ? personalProgressArray[personalRewardIndex] : 0")
		(var hasReceivedAllRewards:bool =		"isPersonalRewardIndex && personalRewardIndex == personalProgressArrayMaxIndex")

		(var personalProgressBarValue:number = "hasReceivedAllRewards ? 1 : personalProgress/pointsTillNextRewardTotal")
		(var pointsTillNextRewardRemaining:number = "pointsTillNextRewardTotal - personalProgress")

		(var substText:str = "pointsTillNextRewardRemaining ? subst('IDS_ARC_EVENT_PORT_STATUS_POINTS_TILL_NEXT_REWARD', [], { _pointsNext: pointsTillNextRewardRemaining }, pointsTillNextRewardRemaining) : ''")

		(var isSmallBanner:bool = "_size == SC.Ui_common.TILE_SIZE.S")
		(var isDisableState:bool = "isSmallBanner && hasReceivedAllRewards")
		(var isProgressBarVisible:bool = "	(isSmallBanner && personalProgressBarValue > 0 || !isSmallBanner) &&
											!isEventFinished && !isSideNeutral && !hasReceivedAllRewards && isPrimeTimeActive")

		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.RVR_AVAILABLE,
																											SC.Context_guiding_tip.TIP_TYPE.RVR_NEW_STAGE ]"))
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(macro PORT_BANNER_CHANGE_ALPHA_BY_TRIGGER_ANIM
		_triggerExpression = "isDisableState"
	)

	(macro MOUSE_HANDLER_BANNER
		_methods = "[
			{
				type: 'inputMapping.onRequest',
				name:	isEventFinished ? 'arcEventShowResults' :
						isSideNeutral	? 'arcEventChooseSide'
										: 'arcEventShowMainScreen',
				args: {}
			},
			{
				type: 'inputMapping.onAction',
				name: 'setPromoSkipped',
				args: { splashScreenName: SC.Ui_common.SPLASH_SCREEN_TYPE.RVR }
			}
		]"
	)

	(block
		(class $EventBanner)

		(element EventBannerTitle
			_title = 'IDS_ARC_EVENT_COMMON_EVENT_TITLE'
			_size = "_size"
			_hasIcon = "!hasReceivedAllRewards && isSmallBanner || isSideNeutral"
		)

		(block
			(bind visible "isProgressBarVisible")
			(bind class "_size == SC.Ui_common.TILE_SIZE.S	? '$EventSmallBannerProgressBar'
															: '$EventMediumBannerProgressBar'")

			(controller $Instance renderer='BannerProgressBarBlock'
				(bind enabled "isProgressBarVisible")
				(args
					_bannerSize = "_size"
					_progress = "personalProgressBarValue"
					_text = "substText"
				)
			)
		)
	)

	(block
		(style
			(hitTest = false)
			(position = "absolute")
			(right = "XS")
			(top = "isSideNeutral ? XXS : 0")
		)

		(controller $Instance renderer='ArcEventSideStereotype'
			(bind enabled "!hasReceivedAllRewards && isSmallBanner")
			(args
				_sideId = "playerSideId"
			)
		)
	)

	(controller $Instance renderer='EventBannerMarkers'
		(bind enabled "isSideNeutral")
		(args
			_isActionMarker = "isSideNeutral"
			_text = 'IDS_ARC_EVENT_COMMON_STATUS_CHOOSE_SIDE'
			_size = "_size"
		)
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"SXS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetRight =	"_screenOffsetRight"
			_screenOffsetLeft =		"_guidingOffsets.right + EVENT_BANNER_SIZE[_size].bannerWidth + ACTIVITIES_BANNERS_PIN_OFFSET"
		)
	)
)

(def element RatingBattlesBanner (_size:number = "SC.Ui_common.TILE_SIZE.S")
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(var ratingBattlesSeasonProgress:dhComponent = "getSingleComponent(CC.ratingBattlesSeasonProgress)")
		(var initialQualificationBattlesResults:array = "ratingBattlesSeasonProgress.initialQualificationBattlesResults ?: []" (event "ratingBattlesSeasonProgress.evInitialQualificationBattlesResultsChanged"))
		(var isQualification:bool = "ratingBattlesSeasonProgress != null && initialQualificationBattlesResults.length < SC.Common.RATING_BATTLES_CONSTANTS.INITIAL_QUALIFICATION_LENGTH")

		(struct markerData = PULL_MARKER_NEW(_groupName = "SC.Ui_common.CONTENT_MARKER_GROUPS.RATING_PASSED"))
		(var isCallToActionMarkerVisible:bool = "markerData.markerType == SC.Ui_common.CONTENT_MARKER_TYPE.CALL_TO_ACTION")
	)
	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))


	(macro MOUSE_HANDLER_BANNER
		_methods = "[{
				type: 'inputMapping.onAction',
				name: 'navigateTo',
				args: {	route: SC.Ui_windows.ROUTE.RATING,
						data: { isPortBannerClicked: true }}
					}]"
	)

	(hblock
		(class $EventBanner)
		(element EventBannerTitle
			_title = 'IDS_DOCK_BANNER_RATING'
			_size = "_size"
		)

		(block
			(controller $Instance renderer = 'DefaultDividedCounter'
				(bind enabled "isQualification")
				(args
					_curValue = "initialQualificationBattlesResults.length"
					_maxValue = "SC.Common.RATING_BATTLES_CONSTANTS.INITIAL_QUALIFICATION_LENGTH"
					_doNotAlphaOnZeroCurValue = true
					_curValueTextClass = '$TextDefaultBold22NM'
				)
			)
		)
	)

	(controller $Instance renderer='EventBannerMarkers'
		(bind enabled "markerData.isVisible")
		(args
			_isActionMarker = "isCallToActionMarkerVisible"
			_text = 'IDS_RATING_BATTLES_ACTION_MARKER_QUALIFICATION'
			_size = "_size"
		)
	)
)

(def element EventBannerSnowflakes (	_size:number = "SC.Ui_common.TILE_SIZE.S",
										_guidingOffsets:dict = {},
										_bannerHeight:number = 0,
										_screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(var bonustagSeasonEntity:dhEntity = "getSingleEntity(CC.bonusTagSeason, 'snowflakeSeasonCollection')")
		(var bonusTagSeasonComponent:dhComponent = "bonustagSeasonEntity.bonusTagSeason")

		(var bonusSnowflakesCount:number = "bonusTagSeasonComponent.bonusSnowflakes" (event "bonusTagSeasonComponent.evChanged"))
		(var bannerState:number = "bonusTagSeasonComponent.bannerState" (event "bonusTagSeasonComponent.evBannerStateChanged"))

		(var isInactive:bool = "bonusSnowflakesCount == 0 || bannerState == SC.Ui_common.SNOWFLAKES_BANNER_STATE.INACTIVE")

		(var isNewMarkerVisible:bool = "bonustagSeasonEntity.hasComponent(CC.newItem)")

		(var isSmallBanner:bool = "_size == SC.Ui_common.TILE_SIZE.S")
		(var isDisableState:bool = "isSmallBanner && !isNewMarkerVisible && isInactive")


		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.SNOWFLAKES_EVENT_START,
																											SC.Context_guiding_tip.TIP_TYPE.SNOWFLAKES_EVENT_FINISH ]"))
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(macro PORT_BANNER_CHANGE_ALPHA_BY_TRIGGER_ANIM
		_triggerExpression = "isDisableState"
	)

	(macro MOUSE_HANDLER_BANNER
		_methods = "[
			{
				type: 'inputMapping.onRequest',
				name: 'showSnowflakesModal',
				args: {}
			},
			{
				type: 'inputMapping.onAction',
				name: isNewMarkerVisible ? 'makeSeen' : '',
				args: { entityId: bonustagSeasonEntity.id }
			}
		]"
	)

	(hblock
		(class $EventBanner)

		(element EventBannerTitle
			_title = 'IDS_DOCK_BANNER_SNOWFLAKES'
			_size = "_size"
		)

		(block
			(controller $Instance renderer='EventBannerCounter'
				(bind enabled "bonusSnowflakesCount > 0")
				(args
					_count = "bonusSnowflakesCount"
				)
			)
		)
	)

	(controller $Instance renderer='EventBannerMarkers'
		(bind enabled "isNewMarkerVisible")
		(args
			_isNewMarker = "isNewMarkerVisible"
			_size = "_size"
		)
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"SXS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetRight =	"_screenOffsetRight"
			_screenOffsetLeft =		"_guidingOffsets.right + EVENT_BANNER_SIZE[_size].bannerWidth + ACTIVITIES_BANNERS_PIN_OFFSET"
		)
	)
)

(def element RankBattlesBanner (_size:number = "SC.Ui_common.TILE_SIZE.S")
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct rankInfo = PULL_BANNER_COMMON_RANK_INFO())
		(struct serverTime = SERVER_TIME())

		(var rankSeasonEntity:dhEntity = "getSingleEntity(CC.rankSeason)")
		(var rankSeasonFinishTime:number = "rankSeasonEntity.timeOfBattleEvent.finishTime ?: 0" (event "rankSeasonEntity.timeOfBattleEvent.evChanged"))
		(var isSeasonFinished:bool = "floor(rankSeasonFinishTime - serverTime.value) <= 0")

		(struct markerData = PULL_MARKER_NEW(_groupName = "SC.Ui_common.CONTENT_MARKER_GROUPS.RANKS"))
		(var isNewMarkerVisible:bool = "markerData.markerType == SC.Ui_common.CONTENT_MARKER_TYPE.NEW")
		(var isCallToActionMarkerVisible:bool = "markerData.markerType == SC.Ui_common.CONTENT_MARKER_TYPE.CALL_TO_ACTION")
	)
	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(macro PORT_BANNER_CHANGE_ALPHA_BY_TRIGGER_ANIM
		_triggerExpression = "isSeasonFinished"
	)

	(macro MOUSE_HANDLER_BANNER
		_methods = "[
			{
				type: 'inputMapping.onAction',
				name: 'navigateTo',
				args: {	route: SC.Ui_windows.ROUTE.RANKS,
						data: { isPortBannerClicked: true }}
			},
			{
				type: 'inputMapping.onAction',
				name: isCallToActionMarkerVisible ? 'ServerUIDataUSS.setCallToActionMarkerSeen' : '',
				args: { markerId: SC.Ui_common.CALL_TO_ACTION_MARKERS.RANKED_QUALIFICATION_AVAILABLE }
			}
		]"
	)

	(hblock
		(class $EventBanner)
		(element EventBannerTitle
			_title = 'IDS_DOCK_BANNER_RANK_BATTLES'
			_size = "_size"
		)

		(block
			(controller $Instance renderer = 'DefaultDividedCounter'
				(bind enabled "rankInfo.isQualification")
				(args
					_curValue = "rankInfo.currentStars"
					_maxValue = "rankInfo.totalStars"
					_doNotAlphaOnZeroCurValue = true
					_curValueTextClass = '$TextDefaultBold22NM'
				)
			)
		)
	)

	(controller $Instance renderer='EventBannerMarkers'
		(bind enabled "markerData.isVisible")
		(args
			_isNewMarker = "isNewMarkerVisible"
			_isActionMarker = "isCallToActionMarkerVisible"
			_text = 'IDS_RANK_BATTLES_ACTION_MARKER_QUALIFICATION'
			_size = "_size"
		)
	)
)

(def element EventBannerShipyard (	_size:number = "SC.Ui_common.TILE_SIZE.S",
									_guidingOffsets:dict = {},
									_bannerHeight:number = 0,
									_screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(var shipyardBannerStateEntity:dhEntity = "getSingleEntity(CC.shipyardBannerState)")
		(var shipyardBannerStateComponent:dhComponent = "shipyardBannerStateEntity.shipyardBannerState")

		(var selectedShipId:number = "shipyardBannerStateComponent.selectedShipId" (event "shipyardBannerStateComponent.evUpdate"))
		(var shipyardProgressbar:dict = "shipyardBannerStateComponent.progressbar" (event "shipyardBannerStateComponent.evUpdate"))
		(var rewardsAvailable:bool = "shipyardBannerStateComponent.availableRewards > 0" (event "shipyardBannerStateComponent.evUpdate"))
		(var boosterAvailable:bool = "shipyardBannerStateComponent.boosterAvailable" (event "shipyardBannerStateComponent.evUpdate"))
		(var isActiveState:bool = "shipyardBannerStateComponent.type != 'finished'" (event "shipyardBannerStateComponent.evUpdate"))

		(var shipLevel:number = "shipyardProgressbar.shipLevel")
		(var curPoints:number = "shipyardProgressbar.points")
		(var maxPoints:number = "shipyardProgressbar.pointsMax ?: 0")

		(var shipyardStepProgress:number = "maxPoints ? curPoints / maxPoints : 0")
		(var isShipyardMaxProgressReached:bool = "curPoints == maxPoints && maxPoints > 0")
		(var shipyardStep:str = "	shipLevel == 0	? 'IDS_SHIPYARD_PREPARE_LEVEL_BANNER'
													: subst('IDS_SHIPYARD_LEVEL_BANNER', [], { _level: shipLevel })")

		(var shipComponent:dhComponent = "getPrimaryComponent(CC.ship, selectedShipId)")
		(var bannerTitle:str = "selectedShipId	? subst('IDS_DOCK_BANNER_SHIPYARD_WITH_SHIP', [], { _shipName: toUpper(tr(shipComponent.nameIDS))})
												: 'IDS_SHIPYARD_COMMON_EVENT_TITLE'")

		(var isSmallBanner:bool = "_size == SC.Ui_common.TILE_SIZE.S")
		(var isProgressBarVisible:bool = "	isActiveState && !isShipyardMaxProgressReached &&
											(isSmallBanner && curPoints > 0 || !isSmallBanner)")
		(var isDescriptionBlockVisible:bool = "isShipyardMaxProgressReached && !isSmallBanner")


		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[ SC.Context_guiding_tip.TIP_TYPE.SHIPYARD_INTRO ]"))
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(macro MOUSE_HANDLER_BANNER
		_methods = "[
			{
				type: 'inputMapping.onAction',
				name: 'navigateTo',
				args: { route: SC.Ui_windows.ROUTE.SHIPYARD }
			},
			{
				type: 'inputMapping.onAction',
				name: 'shipyardBannerClicked',
				args: {}
			}
		]"
	)

	(block
		(class $EventBanner)
		(element EventBannerTitle
			_title = "bannerTitle"
			_size = "_size"
			_hasIcon = "rewardsAvailable"
		)

		(block
			(bind visible "isProgressBarVisible")
			(bind class "_size == SC.Ui_common.TILE_SIZE.S	? '$EventSmallBannerProgressBar'
															: '$EventMediumBannerProgressBar'")

			(controller $Instance renderer='BannerProgressBarBlock'
				(bind enabled "isProgressBarVisible")
				(args
					_bannerSize = "_size"
					_progress = "shipyardStepProgress"
					_text = "shipyardStep"
				)
			)
		)

		(block
			(bind visible "isDescriptionBlockVisible")
			(class $EventMediumBannerProgressBar)
			(controller $Instance renderer='BannerItemDescription'
				(bind enabled "isDescriptionBlockVisible")
				(args
					_description = 'IDS_SHIPYARD_FINAL_LEVEL_BANNER'
				)
			)
		)
	)

	(block
		(class $EventBannerReward)
		(controller $Instance renderer = 'EventBannerIcon'
			(bind enabled "rewardsAvailable")
			(args
				_icon = 'url:../service_kit/port_banner/icon_banner_reward.png'
				_isAnimated = "rewardsAvailable"
				_size = "_size"
			)
		)
	)

	(controller $Instance renderer='EventBannerMarkers'
		(bind enabled "!toBool(selectedShipId) || boosterAvailable || rewardsAvailable")
		(args
			_isActionMarker = "!toBool(selectedShipId)"
			_text = 'IDS_CHOOSE_SHIP'
			_isRewardMarker = "rewardsAvailable"
			_isDiscountMarker = "boosterAvailable"
			_size = "_size"
		)
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"SXS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetRight =	"_screenOffsetRight"
			_screenOffsetLeft =		"_guidingOffsets.right + EVENT_BANNER_SIZE[_size].bannerWidth + ACTIVITIES_BANNERS_PIN_OFFSET"
		)
	)
)

(def element EventBannerProspectiveEvent (	_size:number = "SC.Ui_common.TILE_SIZE.S",
											_guidingOffsets:dict = {},
											_bannerHeight:number = 0,
											_screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(var prospectiveEventBannerStateEntity:dhEntity = "getSingleEntity(CC.prospectiveEventBannerState)")
		(var prospectiveEventBannerStateComponent:dhComponent = "prospectiveEventBannerStateEntity.prospectiveEventBannerState")
		(var url:str = "prospectiveEventBannerStateComponent.url" (event "prospectiveEventBannerStateComponent.evUrlChanged"))

		(var isSmallBanner:bool = "_size == SC.Ui_common.TILE_SIZE.S")
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(macro MOUSE_HANDLER_BANNER
		_methods = "[
			{
				type: 'inputMapping.onAction',
				name: 'navigateTo',
				args: {	route: SC.Ui_windows.ROUTE.ARMORY,
						data: { url: url,
								isPrmp: true,
								authorization: 'auth_wows' }}
			}
		]"
	)

	(block
		(class $EventBanner)
		(element EventBannerTitle
			_title = 'IDS_DOCK_BANNER_KEY_TARGET'
			_size = "_size"
			_hasIcon = "isSmallBanner"
		)
	)

	(block
		(class $EventBannerReward)
		(controller $Instance renderer = 'EventBannerIcon'
			(bind enabled "isSmallBanner")
			(args
				_icon = 'url:../service_kit/port_banner/icon_banner_key_target.png'
			)
		)
	)
)

(def element EventBannerCasualCvc (	_size:number = "SC.Ui_common.TILE_SIZE.S",
									_guidingOffsets:dict = {},
									_bannerHeight:number = 0,
									_screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(var selfPlayerEntity:dhEntity = "getSingleEntity(CC.accountSelf)")
		(var selfPlayerDbId:number = "selfPlayerEntity.accountSimple.dbId")
		(var cwInfoEntity:dhEntity = "getPrimaryEntity(CC.clanWarsInfo, selfPlayerDbId)")

		(var clanWarsInfoComponent:dhComponent = "cwInfoEntity.clanWarsInfo")

		(var stage:str =							"clanWarsInfoComponent.stage" (event "clanWarsInfoComponent.evChanged"))
		(var attemptsLeft:number =					"clanWarsInfoComponent.attemptsLeft" (event "clanWarsInfoComponent.evChanged"))
		(var isPlayerParticipating:bool =			"clanWarsInfoComponent.playerParticipate" (event "clanWarsInfoComponent.evChanged"))
		(var isPlayerMissPreparation:bool =			"clanWarsInfoComponent.playerMissPreparation" (event "clanWarsInfoComponent.evChanged"))
		(var clanMaxPreparationProgress:number =	"clanWarsInfoComponent.clanMaxPreparationProgress" (event "clanWarsInfoComponent.evChanged"))
		(var clanPreparationProgress:number =		"clanWarsInfoComponent.clanPreparationProgress" (event "clanWarsInfoComponent.evChanged"))

		(var isAwardStage:bool =			"stage == SC.Ui_common.CVC_PORT_BANNER_STAGE.REWARDING")
		(var isWarStage:bool =				"stage == SC.Ui_common.CVC_PORT_BANNER_STAGE.WAR")
		(var isQualificationStage:bool =	"stage == SC.Ui_common.CVC_PORT_BANNER_STAGE.PREPARATION")

		(var hasAttempts:bool = "attemptsLeft > 0")
		(var isQualificationDone:bool = "clanPreparationProgress != 0 && clanMaxPreparationProgress == clanPreparationProgress")
		(var isQualificationActive:bool = "isQualificationStage && !isQualificationDone")
		(var isQualificationFailed:bool = "!isQualificationStage && !isQualificationDone")

		(var isPlayerParticipateWarStage:bool = "isWarStage && !isPlayerParticipating && !isPlayerMissPreparation")
		(var isNoActiveAttempts:bool = "isQualificationDone && !isWarStage && !isAwardStage && !isPlayerMissPreparation")

		(var isProgressBarVisible:bool = "isQualificationActive && clanPreparationProgress > 0")
		(var isActionMarker:bool = "isPlayerParticipateWarStage && hasAttempts && isQualificationDone")

		(var isSmallBanner:bool = "_size == SC.Ui_common.TILE_SIZE.S")
		(var isDisableState:bool = "isQualificationFailed ||
									isWarStage && !hasAttempts ||
									isPlayerMissPreparation ||
									isAwardStage")
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(macro PORT_BANNER_CHANGE_ALPHA_BY_TRIGGER_ANIM
		_triggerExpression = "isSmallBanner && isDisableState"
	)

	(macro MOUSE_HANDLER_BANNER
		_methods = "[{	type: 'inputMapping.onAction',
						name: 'navigateTo',
						args: {	route: SC.Ui_windows.ROUTE.CLAN,
								data: { url: SC.Ui_windows.GUI_URL.CLAN_WARS_IN_GAME } }
					}]"
	)

	(hblock
		(class $EventBanner)

		(element EventBannerTitle
			_title = 'IDS_DOCK_BANNER_CASUAL_CVC'
			_size = "_size"
			_hasIcon = "isNoActiveAttempts"
		)

		(block
			(bind visible "isProgressBarVisible")
			(macro BANNER_PROGRESS_BAR_BLOCK_POSITION _size = "_size")
			(controller $Instance renderer='BannerProgressBarBlock'
				(bind enabled "isProgressBarVisible")
				(args
					_bannerSize = "_size"
					_progress = "clanPreparationProgress / clanMaxPreparationProgress"
				)
			)
		)

		(block
			(controller $Instance renderer='EventBannerCounter'
				(bind enabled "isWarStage && !isDisableState")
				(args
					_count = "attemptsLeft"
				)
			)
		)
	)

	(block
		(class $EventBannerReward)

		(controller $Instance renderer = 'EventBannerIcon'
			(bind enabled "isNoActiveAttempts")
			(args
				_icon = 'url:../service_kit/port_banner/icon_banner_battle_attempt_inactive.png'
				_size = "_size"
			)
		)
	)

	(controller $Instance renderer='EventBannerMarkers'
		(bind enabled "isActionMarker")
		(args
			_isActionMarker = "isActionMarker"
			_text = 'IDS_MARKER_ENABLE_TRIES_COUNT'
			_size = "_size"
		)
	)
)

(def element EventBannerTutorial (	_size:number = "SC.Ui_common.TILE_SIZE.S",
									_guidingOffsets:dict = {},
									_bannerHeight:number = 0,
									_screenOffsetRight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(macro GET_PREF_NUMBER 'prefCountTutorClick' "'ui.tutorialBannerClicksCount'")
		(macro GET_PREF_BOOL 'isTutorialBannerShown' "'ui.tutorialBannerShown'")

		(struct activeTip =			PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =		SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[ SC.Context_guiding_tip.TIP_TYPE.TUTORIAL_START ]"))
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(bindcall externalCall
		"checkedTipId.value ? 'inputMapping.onAction' : ''"
		"[ 'deactivateTipChain', { tip_chain_id: SC.Context_guiding_tip.TIP_CHAIN_ID.TUTORIAL_START } ]"
		watch=false
		on='leftClick')
	(bindcall externalCall
		"isTutorialBannerShown ? '' : 'direct.action'"
		"[ 'option.set', { preferenceId: 'ui.tutorialBannerShown', newValue: true } ]"
		watch=false
		on=addedToStage
	)

	(macro MOUSE_HANDLER_BANNER
		_methods = "[
			{
				type: 'inputMapping.onAction',
				name: 'navigateTo',
				args: {	route: SC.Ui_windows.ROUTE.OVERLAY_BROWSER,
						data: {'url': SC.Ui_windows.GUI_URL.GUIDES_IN_GAME} }
			},
			{
				type: 'direct.action',
				name: 'option.set',
				args: { preferenceId: 'ui.tutorialBannerClicksCount', newValue: prefCountTutorClick + 1 }
			}
		]"
	)

	(block
		(class $EventBanner)
		(element EventBannerTitle
			_title = 'IDS_DOCK_BANNER_VIDEO_TUTORIALS'
			_size = "_size"
		)
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"XS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetRight =	"_screenOffsetRight"
			_screenOffsetLeft =		"_guidingOffsets.right + EVENT_BANNER_SIZE[_size].bannerWidth + ACTIVITIES_BANNERS_PIN_OFFSET"
			_hasAssistant =			true
		)
	)
)

(def element EventBannerMotivator (_guidingOffsets:dict = {})
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(var motivatorTasks:dhCollection = "getCollectionByPath(CC.sseCore, 'motivator.sorted')")
		(var sseCoreEntity:dhEntity = "motivatorTasks.getEntityAtIndex(0)")
		(var sseCore:dhComponent = "sseCoreEntity.sseCore")
		(var statusesCore:array = "sseCore.statuses ?: []" (event "sseCore.evStatusesChanged"))
		(var isClaimed:bool = "sseCore.isClaimed" (event "sseCore.evChanged"))
		(var isManualRewardClaim:bool = "	sseCoreEntity.sseChain.claimRewards ||
											sseCoreEntity.sseEpic.claimRewards ||
											sseCoreEntity.sseTask.claimRewards")

		(var isMotivatorStatusDone:bool = "	(isIn(SC.Sse.SSE_STATUSES.DONE, statusesCore) && !isManualRewardClaim) ||
											isManualRewardClaim && isClaimed ||
											isIn(SC.Sse.SSE_STATUSES.LOCKED_BY_TIME, statusesCore) ||
											isIn(SC.Sse.SSE_STATUSES.LOCKED_BECAUSE_NOT_PRIME_TIME, statusesCore)")

		(var motivatorTasksCounter:number = "isMotivatorStatusDone ? 1 : min(SC.Sse.SSE_MOTIVATION_BANNER.ACTIVE_TASKS_ON_BANNER_MAX, motivatorTasks.length)")

		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.SSE_MOTIVATOR_PIN_INTRO,
																											SC.Context_guiding_tip.TIP_TYPE.SSE_MOTIVATOR_WEEKLY_TASK_COMPLETED ]"))
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(style
		(gap = "S")
		(flow = "horizontal")
		(width = "EVENT_BANNER_WIDTH.LARGE")
		(bind height "isMotivatorStatusDone ? EVENT_BANNER_HEIGHT.SMALL : EVENT_BANNER_HEIGHT.LARGE")
	)

	(controller $Repeat renderer='SseMotivatorSubBannerItem'
		(bind count "motivatorTasksCounter")
		(args
			_sseId = "motivatorTasks[$index].id"
			_guidingOffsets = "_guidingOffsets"
			_isMotivatorDoneStateView = "motivatorTasksCounter == 1 || isMotivatorStatusDone"
		)
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"SXS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
		)
	)
)

(def element SseMotivatorSubBannerItem (	_sseId:number = 0,
											_bannerHeight:number = 0,
											_isMotivatorDoneStateView:bool = false,
											_guidingOffsets:dict = {})
	(scope
		(event evSubBannerItemClicked)

		(macro HIGH_CONTRAST_DATA_SCOPE)
		(macro MOTIVATOR_STAGE_SIZES)

		(macro MOUSE_HANDLER_SCOPE)
		(macro MOUSE_HANDLER_SCOPE "'button_'")
		(macro MOUSE_HANDLER_SCOPE "'icon_pinned_'")

		(var sseEntity:dhEntity = "getEntity(_sseId)")
		(var sseCore:dhComponent = "sseEntity.sseCore")
		(var sseTask:dhComponent = "sseEntity.sseTask")
		(var isEpicTask:bool = "sseTask.epicId != null")
		(var sseTaskId:str = "isEpicTask ? sseTask.epicId : sseCore.id" (event "sseCore.evChanged"))
		(var sseCategoryId:str = "sseCore.tag ?: ''" (event "sseCore.evChanged"))
		(var isTaskHighlighted:bool = "sseCore.isMotivationHighlighted" (event "sseCore.evChanged"))
		(var statusesCore:array = "sseCore.statuses ?: []" (event "sseCore.evStatusesChanged"))
		(var isClaimed:bool = "sseCore.isClaimed" (event "sseCore.evChanged"))
		(var isActive:bool = "isIn(SC.Sse.SSE_STATUSES.ACTIVE, statusesCore)")

		(var isManualRewardClaim:bool = "	sseEntity.sseChain.claimRewards ||
											sseEntity.sseEpic.claimRewards ||
											sseEntity.sseTask.claimRewards")
		(var isClaimButtonVisible:bool = "!isActive && isManualRewardClaim && !isClaimed")

		(var isTaskCompletedBlock:bool = "	(isIn(SC.Sse.SSE_STATUSES.DONE, statusesCore) && !isManualRewardClaim) ||
											isManualRewardClaim && isClaimed ||
											isIn(SC.Sse.SSE_STATUSES.LOCKED_BY_TIME, statusesCore) ||
											isIn(SC.Sse.SSE_STATUSES.LOCKED_BECAUSE_NOT_PRIME_TIME, statusesCore)")
		(var elementName:str = "isTaskCompletedBlock ? 'SseMotivatorTaskCompleted' : 'SseMotivatorTaskActive'")
		(var isAnimationEnabled:bool = "isTaskHighlighted && !isTaskCompletedBlock")

		(var isPinnedTask:bool = "toBool(sseCore.pinnedAt)" (event "sseCore.evChanged"))

		(var bgState:number = " mouseDown	? SC.Ui_styles.BUTTON_STATE.DOWN :
								rollOver	? SC.Ui_styles.BUTTON_STATE.OVER
											: SC.Ui_styles.BUTTON_STATE.UP")

		(var isSseOpenEnded:bool =	"sseEntity.hasComponent(CC.sseOpenEnded)")
		(var route:str = "isSseOpenEnded ? SC.Ui_windows.ROUTE.SSE_OPEN_ENDED : 'sse_' + sseCategoryId ")
		(struct activeTip =	PULL_ACTIVE_GUIDING_TIP())
	)

	(dispatch evSubBannerItemClicked dir="EventDirection.DOWN" on='leftClick')
	(bindcall externalCall
		"activeTip.chainId == SC.Context_guiding_tip.TIP_CHAIN_ID.SSE_MOTIVATOR_INTRO ? 'inputMapping.onAction' : ''"
		"[ 'deactivateTipChain', { tip_chain_id: SC.Context_guiding_tip.TIP_CHAIN_ID.SSE_MOTIVATOR_INTRO } ]"
		watch=false
		(event "evSubBannerItemClicked")
	)
	(bindcall externalCall
		"activeTip.chainId == SC.Context_guiding_tip.TIP_CHAIN_ID.SSE_MOTIVATOR_COMPLETED ? 'inputMapping.onAction' : ''"
		"[ 'deactivateTipChain', { tip_chain_id: SC.Context_guiding_tip.TIP_CHAIN_ID.SSE_MOTIVATOR_COMPLETED } ]"
		watch=false
		(event "evSubBannerItemClicked")
	)

	(style
		(height = 100%)
		(bind width "_isMotivatorDoneStateView ? EVENT_BANNER_WIDTH.LARGE : EVENT_BANNER_WIDTH.MEDIUM")
	)

	(macro MOUSE_HANDLER_BANNER
		_methods = "icon_pinned_rollOver || button_rollOver	? []
															: [
																{
																	type: 'inputMapping.onAction',
																	name: 'navigateTo',
																	args: { route: route }
																},
																{
																	type: 'inputMapping.onAction',
																	name: 'SSEProxyCommonUSS.selectItem',
																	args: { itemId: sseTaskId }
																}
															]"
	)

	(element MotivatorTaskCardBackground
		_isFromPort = true
		_bgState = "bgState"
	)

	(block
		(bind visible "isAnimationEnabled")
		(class $FullsizeAbsolute)
		(style
			(hitTest = false)
			(borderRadius = "S")
			(backgroundImage = 'url:../animations/spine/sse/motivator/sse_motivator_bg.skel')
			(backgroundSize = "fill")
		)
		(controller $Spine
			(bind enabled "isAnimationEnabled")
		)
	)

	(block
		(bind visible "isTaskCompletedBlock && !_isMotivatorDoneStateView")
		(style
			(position = "absolute")
			(right = 0)
			(width = 280px)
			(height = 160px)
			(backgroundImage = 'url:../sse/motivator/task_completed.png')
			(borderRadius = "S")
		)
	)

	(block
		(class $Fullsize)
		(style
			(paddingTop = "M")
			(paddingLeft = "M")
			(paddingRight = "M")
			(paddingBottom = "SXS")
		)

		(controller $Instance
			(bind renderer "elementName")
			(args
				_sseId = "_sseId"
				_isMotivatorDoneStateView = "_isMotivatorDoneStateView"
				_guidingOffsets = "_guidingOffsets"
				_isClaimButtonVisible = "isClaimButtonVisible"
			)
		)
	)

	
	(block
		(class $FullsizeAbsolute)
		(style (backgroundColor = "NO_COLOR"))

		(controller $Tooltip
			(renderer = 'SseMotivatorBannerTooltip')
			(bind enabled "!isTaskCompletedBlock")
			(args
				_sseId = "_sseId"
				_isRewardChoice = "isManualRewardClaim"
			)
			(macro DEFAULT_TOOLTIP_BEHAVIOUR)
		)

		(controller $Tooltip
			(renderer = 'SseMotivatorCompletedTaskBannerTooltip')
			(bind enabled "isTaskCompletedBlock")
			(args
				_sseId = "_sseId"
				_isMotivatorDoneStateView = "_isMotivatorDoneStateView"
				_isRewardChoice = "isManualRewardClaim"
			)
			(macro DEFAULT_TOOLTIP_BEHAVIOUR)
		)
	)

	(block
		(macro MOUSE_EVENTS_DISPATCHER "'button_'")

		(style
			(position = "absolute")
			(bottom = "S")
			(left = "M")
		)

		(controller $Instance renderer='DefaultButton'
			(bind enabled "isClaimButtonVisible")
			(args
				_label = 'IDS_SSE_CLAIM_REWARD'
				_size = "SIZE.SMALL"
				_width = 140px
				_focusIndex = 1
				_methods = "[
								{	type: 'inputMapping.onRequest',
									name: 'showSseClaimWindow',
									args: { sseId: _sseId }
								}
							]"
			)
		)
	)

	
	(block
		(macro MOUSE_EVENTS_DISPATCHER "'icon_pinned_'")

		(style
			(position = "absolute")
			(top = "XXS")
			(right = "XXS")
			(backgroundColor = "NO_COLOR")
		)

		(controller $Tooltip
			(renderer='SimpleStatusTooltip')
			(args
				_text = 'IDS_SSE_MOTIVATOR_UNPIN_HINT'
				_unifiedStatus = "SC.Ui_styles.UNIFIED_STATUS.MOUSE_LEFT"
			)
			(macro DEFAULT_TOOLTIP_BEHAVIOUR)
		)

		(controller $Instance renderer='SsePinnedTaskIcon'
			(bind enabled "isPinnedTask")
			(args
				_isFromMotivator = true
				_sseId = "sseCore.id"
				_isPinShown = "icon_pinned_rollOver"
			)
		)

		(macro CLICK_HANDLER
			_prefix = "'icon_pinned_'"
			_methods = "[
				{
					type: 'inputMapping.onAction',
					name: 'SSEProxyCommonUSS.unpinSSEElement',
					args: { sseID: sseCore.id }
				}
			]"
		)
	)
)

(def element SseMotivatorTaskActive (	_sseId:number = 0,
										_guidingOffsets:dict = {},
										_bannerHeight:number = 0,
										_isClaimButtonVisible:bool = false)
	(scope
		(event evSubBannerItemClicked)
		(event evDeactivateTip)

		(macro MOUSE_HANDLER_SCOPE)
		(macro MOTIVATOR_STAGE_SIZES)

		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(struct sseMotivator = GET_MOTIVATOR_INFO(_sseId = "_sseId"))

		(var taskDescriptionData:dict = "sseMotivator.conditions.taskDescriptionData" (event "sseMotivator.conditions.evConditionSetChanged"))
		(var isSingleBattle:bool = "sseMotivator.conditions.isSingleBattle" (event "sseMotivator.conditions.evConditionSetChanged"))

		(var sseTaskRewards:array = "sseMotivator.infoSourceComponent.rewards ?: []" (event "sseMotivator.infoSourceComponent.evChanged"))
		(var rewardEntity:dhEntity = "getEntity(sseTaskRewards[0])")
		(var reward:dict = "{	id: rewardEntity.rewardComponent.id,
								amount: rewardEntity.rewardComponent.amount,
								name: rewardEntity.rewardComponent.name,
								type: rewardEntity.rewardComponent.type,
								subtype: rewardEntity.rewardComponent.subtype,
								params: rewardEntity.rewardComponent.params,
								isPRMP: rewardEntity.rewardComponent.isPRMP }")

		(var isPinnedTask:bool = "toBool(sseMotivator.core.pinnedAt)" (event "sseMotivator.core.evChanged"))

		(var progressSourceEntityId:number = "sseMotivator.isChain ? sseMotivator.coreEntity.id : _sseId")

		(var isProgressVisible:bool = "	!_isClaimButtonVisible && (
										!sseMotivator.entity.hasComponent(CC.sseOpenEnded) ||
										sseMotivator.isChain ||
										sseMotivator.isEpic)")

		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[ SC.Context_guiding_tip.TIP_TYPE.SSE_MOTIVATOR_TASK_CHANGED ]"))
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(dispatch evDeactivateTip (event "evSubBannerItemClicked") (bind enabled "sseMotivator.sseTaskId == activeTip.targetId"))

	(bindcall externalCall
		"'inputMapping.onAction'"
		"[ 'deactivateTipChain', { tip_chain_id: SC.Context_guiding_tip.TIP_CHAIN_ID.SSE_MOTIVATOR_TASK_CHANGED } ]"
		watch=false
		(event "evDeactivateTip")
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(hblock
		(style
			(width = 100%)
			(marginBottom = "S")
			(bind paddingRight "sseMotivator.isChain	? 20px :
								isPinnedTask			? XS
														: 0px")
		)

		(tf
			(class $TextDefaultBold14NM)
			(style
				(maxWidth = 100%)
				(marginRight = "S")
				(alpha = "TA")
				(wordWrap = false)
				(elideMode = true)
			)
			(bind text "toUpper(sseMotivator.nameToDisplay)")
		)

		(block
			(controller $Instance renderer='EventBannerDividedCounter'
				(bind enabled "sseMotivator.isChain")
				(args
					_currentValue = "sseMotivator.progressCurrent"
					_maxValue = "sseMotivator.progressMax"
				)
			)
		)
	)

	(hblock
		(class $Fullsize)
		(style (bind paddingBottom "	isProgressVisible		? XS :
										_isClaimButtonVisible	? L
																: 0px"))

		(element SseTaskDescriptionMotivator
			_sseId = "_sseId"
		)

		(block
			(style
				(hitTest = false)
				(width = 90px)
				(height = 85px)
				(marginRight = -6px)
				(align = "center|middle")
			)

			(controller $Instance renderer='RewardItem'
				(bind enabled "sseMotivator.rewards.length == 1 && !sseMotivator.isClaimRewardState")
				(args
					_isBattlePassSmallIconView = true
					_withTooltip = false
					_reward = "reward"
				)
			)

			(controller $Instance renderer='SseRewardCategory'
				(bind enabled "sseMotivator.rewards.length > 1 || sseMotivator.isClaimRewardState")
				(args
					_isMotivatorView = true
					_sseEntityId = "_sseId"
				)
			)
		)
	)

	(block
		(style (width = 100%))
		(controller $Instance renderer='SseProgress'
			(bind enabled "isProgressVisible")
			(args
				_sseEntityId = "progressSourceEntityId"
				_conditionId = "sseMotivator.conditionId"
			)
		)
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && sseMotivator.sseTaskId == activeTip.targetId && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"SXS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
		)
	)
)

(def element SseMotivatorTaskCompleted (	_sseId:number = 0,
											_bannerHeight:number = 0,
											_isMotivatorDoneStateView:bool = false,
											_guidingOffsets:dict = {})
	(scope
		(struct routeEventsData = ROUTE_MENU_DATA(_route = "SC.Ui_windows.ROUTE.EVENTS"))

		(var sseMotivatorCollection:dhCollection = "getCollection(CC.sseCore)")
		(var sseMotivatorComingSoonCollection:dhCollection = "getCollection(CC.sseCore).getChildByPath('motivator.withMotivationPriority.comingSoon.sorted')"
																									(event "sseMotivatorCollection.evChildAdded")
																									(event "sseMotivatorCollection.evChildRemoved")
																									(event "sseMotivatorCollection.evChildUpdated"))

		(var sseEntity:dhEntity =	"getEntity(_sseId)")
		(var statuses:array =		"sseEntity.sseCore.statuses ?: []" (event "sseEntity.sseCore.evStatusesChanged"))
		(var weekly:bool =			"sseEntity.sseRefresh.weekly" (event "sseEntity.sseRefresh.evChanged"))
		(var isChain:bool =			"sseEntity && sseEntity.hasComponent(CC.sseChain)")
		(var currentTaskId:str =	"isChain ? sseEntity.sseChain.currentTaskId : ''")
		(var sseCoreEntity:dhEntity = "getPrimaryEntity(CC.sseCore, currentTaskId)")

		(var isTaskLockedByTime:bool = "isIn(SC.Sse.SSE_STATUSES.LOCKED_BY_TIME, statuses)")
		(var sseName:str = "_isMotivatorDoneStateView	? 'IDS_SSE_MOTIVATOR_TASKS_COMPLETED' :
							weekly						? 'IDS_SSE_MOTIVATOR_BP_WEEKLY_TASKS_COMPLETED'
														: 'IDS_SSE_MOTIVATOR_BP_DAILY_TASKS_COMPLETED'")
		(var sseStatusId:number = "	_isMotivatorDoneStateView	? sseMotivatorComingSoonCollection[0].id :
									isChain						? isTaskLockedByTime ? _sseId : sseCoreEntity.id
																: _sseId")

		(struct activeTip =		PULL_ACTIVE_GUIDING_TIP())
		(struct checkedTipId =	SAFE_CHECK_ACTIVE_TIP_ID(_tipId = "activeTip.tipId"		_validValues = "[	SC.Context_guiding_tip.TIP_TYPE.SSE_MOTIVATOR_DAILY_TASK_COMPLETED ]"))
	)

	(macro DECLARE_SCROLL_TARGET_INDEX
		_tipId = "checkedTipId.value"
	)

	(class $Fullsize)
	(style
		(align = "middle")
		(bind marginLeft "_isMotivatorDoneStateView ? 0px : M")
		(bind flow "_isMotivatorDoneStateView ? horizontal : vertical")
	)

	(tf
		(bind class "_isMotivatorDoneStateView ? '$TextDefaultBold22NM' : '$TextDefaultBold18NM'")
		(style
			(bind marginRight "_isMotivatorDoneStateView ? MS : 0px")
			(bind marginBottom "_isMotivatorDoneStateView ? 3px : S")
			(alpha = "TA")
		)
		(bind text "sseName")
	)

	(element SseMotivatorTimeStatus
		_sseId =			"sseStatusId"
		_isSseMotivator =	true
	)

	(controller $Instance renderer='GuidingTipHub'
		(bind enabled "checkedTipId.value && routeEventsData.isActive")
		(args
			_tipId =				"checkedTipId.value"
			_tipPositioning =		"TIP_POSITION_RIGHT"
			_offsetX =				"SXS"
			_pointerOffset =		"ACTIVITIES_BANNERS_PIN_OFFSET"
			_isHideOnBounds =		true
			_keepOnNotFit =			false
			_modalWindowName =		"SC.Ui_windows.WINDOWS.DOCK"
			_screenOffsetTop =		"_guidingOffsets.top - (EVENT_BANNER_HEIGHT.LARGE / 2)"
			_screenOffsetBottom =	"_guidingOffsets.bottom - (EVENT_BANNER_HEIGHT.LARGE / 2)"
		)
	)
)


(def element EventBannerPromoReward (_size:number = "SC.Ui_common.TILE_SIZE.S", _guidingOffsets:dict = {}, _bannerHeight:number = 0)
	(scope
		(macro MOUSE_HANDLER_SCOPE)

		(var promoRewardCollection:dhCollection = "getCollectionByPath(CC.accountPromoRewardBanner, 'upcoming.sorted')")

		(var promoRewardEntity:dhEntity = "promoRewardCollection.getEntityAtIndex(0)")
		(var accountPromoRewardBannerComponent:dhComponent = "promoRewardEntity.accountPromoRewardBanner")

		(var promoRewardBattles:number =	"accountPromoRewardBannerComponent.battles" (event "accountPromoRewardBannerComponent.evChanged"))
		(var promoRewardLevel:number =		"accountPromoRewardBannerComponent.level" (event "accountPromoRewardBannerComponent.evChanged"))
		(var promoRewardImageSmall:str =	"accountPromoRewardBannerComponent.imageSmall" (event "accountPromoRewardBannerComponent.evChanged"))

		(var promoImageEntity:dhEntity =		"getPrimaryEntity(CC.externalImage, promoRewardImageSmall)")
		(var promoImageComponent:dhComponent =	"promoImageEntity.externalImage")
		(var isImageLoaded:bool =				"promoImageComponent.isLoaded" (event "promoImageComponent.evIsLoadedChanged"))
		(var promoImageUrl:str =				"isImageLoaded ? 'img://embedded:byteImage?url=' + promoImageComponent.url : ''")

		(var accountLevelPointsEntity:dhEntity = "getSingleEntity(CC.accountLevelPoints)")
		(var accountLevelPointsComponent:dhComponent = "accountLevelPointsEntity.accountLevelPoints")
		(var currentPoints:number = "accountLevelPointsComponent.currentLevelPoints" (event "accountLevelPointsComponent.evCurrentLevelPointsChanged"))
		(var battlesToPromoReward:number = "(promoRewardBattles - currentPoints) ?: 0")
	)

	(class $Fullsize)
	(style (backgroundColor = "NO_COLOR"))

	(block
		(name = 'promoRewardBannerImage')

		(class $FullsizeAbsolute)
		(style
			(borderRadius = "S")
			(backgroundSize = "crop")
			(bind backgroundImage "promoImageUrl")
		)
	)

	(macro MOUSE_HANDLER_BANNER
		_methods = "[{
			type: 'inputMapping.onAction',
			name: 'navigateTo',
			args: {	route: SC.Ui_windows.ROUTE.ACCOUNT_LEVELING,
					data: { promoRewardBattles: promoRewardBattles,
							promoRewardLevel: promoRewardLevel,
							isPortBannerClicked: true,
							rewardTypeReason: AL_REWARD_TYPE_PROMO } }
		}]"
	)

	(controller $Tooltip
		(renderer = 'SimpleStatusTooltip')
		(macro DEFAULT_TOOLTIP_BEHAVIOUR)
		(args
			_unifiedStatus=" SC.Ui_styles.UNIFIED_STATUS.MOUSE_LEFT"
			_text='IDS_PROMO_REWARD_BANNER_MOVE_TO_REWARD_MOUSE_INSTRUCTION'
		)
	)

	(block
		(class $EventBanner)

		(tf
			(name = 'promoRewardBannerBattlesCounter')
			(class $TextDefaultBoldNM)
			(style (alpha = "TA"))
			(bind text "subst('IDS_BATTLES_TO_NEXT_STEP', [], { battles: battlesToPromoReward }, battlesToPromoReward)")
		)
	)
)
