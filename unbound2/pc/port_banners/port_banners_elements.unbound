(def constant EVENT_MARKER_TYPE {
	NEW: 'new',
	ACTION: 'action',
	REWARD: 'reward',
	COUNTER: 'counter',
	DISCOUNT: 'discount'
})

(def constant CT_BANNER_ROLL_OVER {
	redMultiplier: 1,
	greenMultiplier: 1,
	blueMultiplier: 1,
	alphaMultiplier: 1,
	redOffset: 20,
	greenOffset: 20,
	blueOffset: 20,
	alphaOffset: 0
})

(def constant CT_BANNER_DOWN {
	redMultiplier: 1,
	greenMultiplier: 1,
	blueMultiplier: 1,
	alphaMultiplier: 1,
	redOffset: -20,
	greenOffset: -20,
	blueOffset: -20,
	alphaOffset: 0
})

(def constant SCROLL_BUTTON_BG_ALPHA {
	SC.Ui_styles.BUTTON_STATE.OVER : 0.5,
	SC.Ui_styles.BUTTON_STATE.UP : 0.7,
	SC.Ui_styles.BUTTON_STATE.DOWN : 1
})

(def element EventBannerTileBackground (_entityContentId:number = 0, _rollOver:bool = false, _mouseDown:bool = false, _isWithTitle:bool = true)
	(scope
		(var tileContentEntity:dhEntity = "getEntity(_entityContentId)")
		(var tileContent:dhComponent = "tileContentEntity.tileContent")
		(var contentId:str = "tileContent.contentId" (event "tileContent.evChanged"))
		(var tileId:str = "tileContent.tileId" (event "tileContent.evChanged"))

		(var tile:dhComponent = "getPrimaryComponent(CC.tile, tileId)")
		(var tileSize:number = "tile.currentTileSize ?: SC.Ui_common.TILE_SIZE.M" (event "tile.evChanged"))

		(var hasNoImage:bool = "	!toBool(contentId) ||
									tileSize == SC.Ui_common.TILE_SIZE.S ||
									isIn(contentId, [SC.Common.TILE_CONTENT.ACCOUNT_LEVELING, SC.Common.TILE_CONTENT.PROMO_REWARD])")
	)
	(class $FullsizeAbsolute)

	(controller $Instance renderer='EventBannerTileBackgroundImage'
		(bind enabled "!hasNoImage")
		(args
			_entityContentId = "_entityContentId"
			_rollOver = "_rollOver"
			_mouseDown = "_mouseDown"
			_isWithTitle = "_isWithTitle"
		)
	)
	(controller $Instance renderer='EventBannerBackgroundNoImage'
		(bind enabled "hasNoImage")
		(args
			_rollOver = "_rollOver"
			_mouseDown = "_mouseDown"
		)
	)
)

(def element EventBannerTileBackgroundImage (_entityContentId:number = 0, _rollOver:bool = false, _mouseDown:bool = false, _isWithTitle:bool = true)
	(scope
		(macro MOUSE_HANDLER_SCOPE)
		(macro HIGH_CONTRAST_DATA_SCOPE)

		(struct tileContentInfo = GET_TILE_CONTENT_INFO(_entityContentId="_entityContentId"))

		(var externalImageKey:str = "tileContentInfo.tileSize == SC.Ui_common.TILE_SIZE.M	? tileContentInfo.tileContent.smallImageUrl
																							: tileContentInfo.tileContent.bigImageUrl" (event "tileContentInfo.tileContent.evChanged"))

		(var externalImageEntity:dhEntity = "getPrimaryEntity(CC.externalImage, externalImageKey)")
		(var externalImageComponent:dhComponent = "externalImageEntity.externalImage")
		(var isImageLoaded:bool = "externalImageComponent.isLoaded" (event "externalImageComponent.evIsLoadedChanged"))
		(var externalImageUrl:str = "isImageLoaded ? 'img://embedded:byteImage?url=' + externalImageComponent.url : ''")

		(var defaultImageUrl:str = "'url:../events/banners/' + tileContentInfo.contentId + '_' + SC.Ui_common.TILE_SIZE.VALUE_TO_NAME[tileContentInfo.tileSize] + '.png'")

		(var bgImage:str = "externalImageUrl ?: defaultImageUrl")

		(var colorTransform:dict = "	_rollOver && !_mouseDown	? CT_BANNER_ROLL_OVER :
										_mouseDown					? CT_BANNER_DOWN
																	: CT_NONE")
	)
	(macro MOUSE_EVENTS_DISPATCHER)
	(class $FullsizeAbsolute)

	(element DockWidgetBackground
		_roundSize = "SIZE.MEDIUM"
	)

	(block
		(class $FullsizeAbsolute)
		(style
			(bind backgroundImage "bgImage")
			(backgroundSize = "cover")
			(borderRadius = "S")
		)
	)

	(block
		(bind visible "_isWithTitle")

		(class $FullsizeAbsolute)
		(style
			(backgroundImage = 'url:../events/banners/banner_blackout.png')
			(backgroundSize = "fill")
			(borderRadius = "S")
		)
	)

	(macro DEFAULT_CONTROL_STATE_ANIMATION_CT
		_colorTransform = "colorTransform"
	)
)

(def element EventBannerBackgroundNoImage (_rollOver:bool = false, _mouseDown:bool=false)
	(scope
		(macro MOUSE_HANDLER_SCOPE)
		(var bgState:number = " _mouseDown	? SC.Ui_styles.BUTTON_STATE.DOWN :
								_rollOver	? SC.Ui_styles.BUTTON_STATE.OVER
											: SC.Ui_styles.BUTTON_STATE.UP")
	)
	(macro MOUSE_EVENTS_DISPATCHER)
	(class $FullsizeAbsolute)

	(element DockWidgetBackground
		_roundSize = "SIZE.MEDIUM"
	)
	(element DockTTXWidgetMenuItemBackground
		_state = "bgState"
		_borderRadius = "S"
	)
)

(def element MotivatorTaskCardBackground (	_isFromPort:bool = false,
											_bgState:number = "SC.Ui_styles.BUTTON_STATE.DISABLED")
	(class $FullsizeAbsolute)

	(block
		(class $FullsizeAbsolute)
		(controller $Instance renderer='DockWidgetBackground'
			(bind enabled "_isFromPort")
			(args
				_roundSize = "SIZE.MEDIUM"
			)
		)
	)

	(block
		(bind visible "!_isFromPort")
		(class $FullsizeAbsolute)
		(style
			(backgroundColor = "SC.Ui_styles.SERVICE_COLORS.DARK_BLUE")
			(borderRadius = "S")
			(alpha = 0.6)
		)
	)

	(block
		(class $FullsizeAbsolute)
		(style
			(backgroundColor = "SC.Ui_styles.SERVICE_COLORS.WHITE")
			(borderRadius = "S")
			(alpha = "SSE_CARD_HOVER_THUMB_ALPHA[_bgState]")
		)
		(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
			_trigger = "_bgState"
			_alpha = "SSE_CARD_HOVER_THUMB_ALPHA[_bgState]"
		)
	)
)

(def element BannerItemDescription (_description:str, _isStateOwn:bool)
	(style (width = 100%))
	(tf
		(class $TextDefaultNM)
		(style
			(multiline = false)
			(leading = -2)
			(width = 100%)
			(bind alpha "_isStateOwn ? 1 : TA")
			(bind textColor "_isStateOwn ? SC.Ui_styles.SERVICE_COLORS.YELLOW : SC.Ui_styles.SERVICE_COLORS.WHITE")
		)
		(bind text "_description")
	)
)

(def element BannerProgressBarBlock (	_bannerSize:number = "SC.Ui_common.TILE_SIZE.M",
										_progress:number = 0,
										_text:str = '',
										_curValue:number = 0,
										_maxValue:number = 0)
	(scope
		(var isSmallBanner:bool = "_bannerSize == SC.Ui_common.TILE_SIZE.S")
	)
	(style (width = 100%))

	(element DefaultProgressBar
		_width = "isSmallBanner ? 100% : 200px"
		_progress = "_progress"
	)

	(block
		(style
			(width = 100%)
			(bind marginTop "!isSmallBanner ? XS : 0px")
		)

		(controller $Instance renderer='BannerProgressBarDescription'
			(bind enabled "!isSmallBanner")
			(args
				_text = "_text"
				_curValue = "_curValue"
				_maxValue = "_maxValue"
			)
		)
	)
)

(def element BannerProgressBarDescription (_text:str, _curValue:number = 0, _maxValue:number = 0)
	(style
		(width = 100%)
		(flow = "horizontal")
	)

	(tf
		(class $TextDefaultNM)
		(style (alpha = "TA"))
		(bind text "_text")
	)

	(block
		(controller $Instance renderer = 'DefaultDividedCounter'
			(bind enabled "toBool(_maxValue)")
			(args
				_curValue = "_curValue"
				_maxValue = "_maxValue"
				_doNotAlphaOnZeroCurValue = true
				_curValueTextClass = '$TextDefaultNM'
			)
		)
	)
)

(def element EventBannerIcon (_icon:str = '', _isAnimated:bool = false, _size:number = "SC.Ui_common.TILE_SIZE.S")
	(scope
		(var animationSize:number = "_size == SC.Ui_common.TILE_SIZE.S ? SC.Ui_common.TILE_SIZE.S : SC.Ui_common.TILE_SIZE.M")
		(var bgAnimation:str = "'url:../animations/spine/event_banners/reward_' + SC.Ui_common.TILE_SIZE.VALUE_TO_NAME[animationSize] + '.skel'")
	)
	(block
		(bind visible "_isAnimated")
		(style
			(hitTest = false)
			(position = "absolute")
			(right = 0)
			(bottom = 0)
			(width = 200px)
			(backgroundSize = "cover")
			(bind backgroundImage "bgAnimation")
			(bind height "_size == SC.Ui_common.TILE_SIZE.S	? EVENT_BANNER_HEIGHT.SMALL
															: EVENT_BANNER_HEIGHT.LARGE")
		)
		(controller $Spine
			(bind enabled "_isAnimated")
		)
	)
	(block
		(style
			(width = 32px)
			(height = 32px)
			(marginBottom = "S")
			(marginRight = "S")
			(backgroundSize = "cover")
			(bind backgroundImage "_icon")
		)
	)
)

(def element EventBannerTitle (	_title:str = '',
								_textClass:str = '$TextDefaultBold22NM',
								_size:number = "SC.Ui_common.TILE_SIZE.M",
								_hasIcon:bool = false,
								_isMultiline:bool = true,
								_isWordWrap:bool = true,
								_isElide:bool = true)
	(style
		(width = 100%)
		(bind paddingRight "_hasIcon ? MS : 0px")
	)
	(tf
		(bind class "_textClass")
		(style
			(alpha = "TA")
			(width = 100%)
			(bind maxHeight "_size == SC.Ui_common.TILE_SIZE.S ? EVENT_BANNER_HEIGHT.SMALL : 72px")
			(bind multiline "_isMultiline")
			(bind wordWrap "_isWordWrap")
			(bind elideMode "_isElide")
		)
		(bind text "_title")
	)
)

(def element EventBannerCounter (_count:number = 0, _textClass:str = '$TextDefaultBold22NM')
	(tf
		(bind class "_textClass")
		(style (alpha = "TA"))
		(bind text "_count ? formatSeparator(_count) : ''")
	)
)

(def element EventBannerDividedCounter (_currentValue:number = 0, _maxValue:number = 0)
	(style (flow = "horizontal"))
	(tf
		(class $TextDefaultBold14NM)
		(style (alpha = "TA"))
		(bind text "formatSeparator(_currentValue)")
	)
	(tf
		(class $TextDefault14NM)
		(style (alpha = "TS"))
		(bind text "' /' + formatSeparator(_maxValue)")
	)
)

(def element EventBannerMarkers (	_isTimerMarker:bool = false,
									_isActionMarker:bool = false,
									_isRewardMarker:bool = false,
									_isNewMarker:bool = false,
									_isDiscountMarker:bool = false,
									_text:str = '',
									_size:number = "SC.Ui_common.TILE_SIZE.M")
	(style
		(flow = "horizontal")
		(gap = "XS")
		(position = "absolute")
		(right = "XS")
		(bind top "_size == SC.Ui_common.TILE_SIZE.S ? -6px : XS")
	)

	(block
		(controller $Instance renderer='EventBannerMarker'
			(bind enabled "_isRewardMarker && _size != SC.Ui_common.TILE_SIZE.S")
			(args
				_type = "EVENT_MARKER_TYPE.REWARD"
			)
		)
	)
	(block
		(controller $Instance renderer='EventBannerMarker'
			(bind enabled "_isActionMarker && !_isRewardMarker")
			(args
				_type = "EVENT_MARKER_TYPE.ACTION"
				_text = "_text"
			)
		)
	)
	(block
		(controller $Instance renderer='EventBannerMarker'
			(bind enabled "_isNewMarker && !(_isRewardMarker || _isActionMarker)")
		)
	)
	(block
		(controller $Instance renderer = 'EventBannerMarker'
			(bind enabled "_isDiscountMarker")
			(args
				_type = "EVENT_MARKER_TYPE.DISCOUNT"
			)
		)
	)
)

(def element EventBannerMarker (_type:str = "EVENT_MARKER_TYPE.NEW", _newContentCounter:number = null, _text:str = '')
	(scope
		(var isNewMarker:bool = "_type == EVENT_MARKER_TYPE.NEW")
		(var isActionMarker:bool = "_type == EVENT_MARKER_TYPE.ACTION")
		(var isRewardMarker:bool = "_type == EVENT_MARKER_TYPE.REWARD")
		(var isDiscountMarker:bool = "_type == EVENT_MARKER_TYPE.DISCOUNT")
	)
	(style
		(hitTest = false)
		(padding = [7px, 6px])
		(bind backgroundColor "	isNewMarker							? 0xFFD20020 :
								isActionMarker						? SC.Ui_styles.SERVICE_COLORS.ACCENT_BLUE :
								isRewardMarker || isDiscountMarker	? SC.Ui_styles.SERVICE_COLORS.YELLOW
																	: 0xFFD20020")
		(borderRadius = 6)
	)
	(tf
		(class $TextDefaultBold12NMWithoutShadow)
		(style
			(antiAliasType = "ANTI_ALIAS_NAMES.ADVANCED")
			(bind textColor "isNewMarker	? 0xFFF7E1D9 : 0xFF2D2E2E")
		)
		(bind text "	isRewardMarker			? 'IDS_MARKER_REWARD' :
						isDiscountMarker		? 'IDS_PERCENT' :
						isNewMarker				? 'IDS_MARKER_NEW' :
						isActionMarker			? toUpper(tr(_text)) :
						_newContentCounter == 0	? '1'
												: toString(_newContentCounter)")
	)
)

(def element SseTaskDescriptionMotivator (_sseId:number)
	(scope
		(var sseEntity:dhEntity = "getEntity(_sseId)")
		(var sseOpenEndedComponent:dhComponent = "sseEntity.sseOpenEnded")
		(var sseChainComponent:dhComponent = "sseEntity.sseChain")
		(var sseEpicComponent:dhComponent = "sseEntity.sseEpic")
		(var sseCoreComponent:dhComponent = "sseEntity.sseCore")

		(var isSseOpenEnded:bool = "sseOpenEndedComponent != null")

		(var isEpic:bool = "sseEpicComponent != null")

		(var isChain:bool = "sseChainComponent != null")
		(var currentTaskId:str = "isChain ? sseChainComponent.currentTaskId : ''" (event "sseChainComponent.evChanged"))
		(var sseCoreEntity:dhEntity = "getPrimaryEntity(CC.sseCore, currentTaskId)")
		(var sseTask:dhComponent = "isChain ? sseCoreEntity.sseTask : sseEntity.sseTask")
		(var taskConditions:array = "sseTask.conditions ?: []" (event "sseTask.evChanged"))
		(var conditionId:number = "taskConditions[0]")
		(var sseConditionEntity:dhEntity = "getEntity(conditionId)")
		(var sseConditionsComponent:dhComponent = "sseConditionEntity.sseConditions")
		(var taskDescriptionData:dict = "sseConditionsComponent.taskDescriptionData" (event "sseConditionsComponent.evConditionSetChanged"))
		(var taskCategory:str = "sseConditionsComponent.conditionCategory")

		(var statuses:array = "sseCoreComponent.statuses ?: []" (event "sseCoreComponent.evStatusesChanged"))
		(var isChainClaimRewardState:bool = "sseChainComponent.claimRewards && isIn(SC.Sse.SSE_STATUSES.DONE, statuses)")

		(var taskDescriptionDisplayName:str = "	isEpic					? 'IDS_SSE_COMPLETE_TASKS_IN_EPIC' :
												isSseOpenEnded			? 'IDS_SSE_CONDITION_CATEGORY_DESCRIPTION_' + taskCategory + '_FULL' :
												isChainClaimRewardState	? 'IDS_SSE_COMPLETE_TASKS_IN_CHAIN'
																		: taskDescriptionData.ids")

		(var achievements:array = "taskDescriptionData.achievements ?: []")
		(var achievementType:str = "taskDescriptionData.achievementType ?: ''")
		(var achievementCount:number = "taskDescriptionData.maxProgress ?: 0")

		(var isAchievementTypeTask:bool = "achievementType && achievementType != 'battle_any'")

		(var achievementTypeText:str = "isAchievementTypeTask	? subst('IDS_PL_SSE_CONDITIONS_ACHIEVEMENT_DESC_' + achievementType,
																		[], {count: achievementCount}, achievementCount)
																: ''")
	)

	(class $Fullsize)

	(tf
		(class $TextDefaultNM)
		(style
			(width = 100%)
			(maxHeight = 100%)
			(marginTop = "S")
			(elideMode = true)
			(multiline = true)
			(wordWrap = true)
			(alpha = "TA")
		)
		(bind text "taskDescriptionDisplayName")
	)

	(htile
		(bind visible "achievements")

		(style
			(width = 100%)
			(marginTop = "S")
			(vgap = "S")
		)

		(controller $Repeat renderer='AchievementItem'
			(bind enabled "achievements")
			(bind count "achievements.length")
			(args
				_isTextUnderlined = false
				_achievementEntityId = "achievements[$index]"
				_achievementsLen = "achievements.length"
			)
		)
	)
)

(def element BannerScrollButton (	_canScroll:bool,
									_buttonCarouselName:str,
									_clickDispatchedEv:str,
									_clickDispatchedParams:dict = {},
									_methods:array = [],
									_direction:number = "ScrollDirection.LEFT")
	(scope
		(struct mouseHandler = MOUSE_HANDLER())

		(var isLeft:bool = "_direction == ScrollDirection.LEFT")
		(var bgIconPath:str = "	isLeft	? 'url:../events/banners/slider/bg_arrow_left.png'
										: 'url:../events/banners/slider/bg_arrow_right.png'")
		(var iconPath:str = "	isLeft	? 'url:../service_kit/buttons/carousel_arrows/arrow_left.png'
										: 'url:../service_kit/buttons/carousel_arrows/arrow_right.png'")
		(var iconColorTransform:dict = "!_canScroll 										? CT_CANT_SCROLL :
										mouseHandler.rollOver && !mouseHandler.mouseDown	? CT_ROLL_OVER :
										mouseHandler.mouseDown								? CT_DOWN
																							: CT_SCROLL_IDLE")
		(var bgState:number = "	mouseHandler.mouseDown || !_canScroll	? SC.Ui_styles.BUTTON_STATE.DOWN :
								mouseHandler.rollOver					? SC.Ui_styles.BUTTON_STATE.OVER
																		: SC.Ui_styles.BUTTON_STATE.UP")
		(var bgAlpha:number = "SCROLL_BUTTON_BG_ALPHA[bgState]")
	)
	(name = "_buttonCarouselName")

	(style
		(width = 32px)
		(height = 160px)
	)

	(block
		(class $FullsizeAbsolute)
		(style
			(bind alpha "bgAlpha")
			(bind backgroundImage "bgIconPath")
		)
		(macro DEFAULT_CONTROL_STATE_ANIMATION_ALPHA
			_trigger = "bgState"
			_alpha = "bgAlpha"
		)
	)

	(block
		(macro STRUCT_MOUSE_HANDLER
			_mouseHandler = "mouseHandler"
			_soundSet = "'button_secondary'"
			_methods = "_methods"
		)
		(dispatch
			"_clickDispatchedEv"
			args ="_clickDispatchedParams"
			dir = "EventDirection.UP"
			(bind enabled "_canScroll")
			(event "mouseHandler.evClicked")
		)

		(class $Fullsize)
		(style
			(align = "center|middle")
			(backgroundColor = "NO_COLOR")
		)

		(block
			(style
				(hitTest = false)
				(height = 18px)
				(width = 12px)
				(backgroundImage = "iconPath")
			)
			(macro DEFAULT_CONTROL_STATE_ANIMATION_CT
				_colorTransform = "iconColorTransform"
			)
		)
	)
)